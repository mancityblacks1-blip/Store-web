<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>QR Menu | ÙØ®Ù… + Dashboard (Frontend Only)</title>

  <!-- Optional QR library (frontend-only) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <style>
    :root{
      --bg:#070b18;
      --card:rgba(255,255,255,.05);
      --card2:rgba(255,255,255,.035);
      --text:#ecf1ff;
      --muted:#a7b4dd;
      --line:rgba(255,255,255,.10);
      --accent:#7c6bff;
      --accent2:#6ef0ff;
      --gold:#ffd36c;
      --good:#7cffb2;
      --bad:#ff6b6b;
      --shadow: 0 18px 50px rgba(0,0,0,.42);
      --shadow2: 0 10px 30px rgba(0,0,0,.30);
      --radius:20px;
      --radius2:16px;
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Kufi Arabic", "Noto Sans Arabic", sans-serif;
    }
    [data-theme="light"]{
      --bg:#f6f7fb;
      --card:rgba(16,20,38,.04);
      --card2:rgba(16,20,38,.03);
      --text:#0f1322;
      --muted:#5a678a;
      --line:rgba(16,20,38,.10);
      --shadow: 0 18px 50px rgba(16,20,38,.12);
      --shadow2: 0 10px 30px rgba(16,20,38,.10);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 15% 0%, rgba(110,240,255,.12), transparent 55%),
        radial-gradient(900px 650px at 85% 10%, rgba(124,107,255,.16), transparent 55%),
        radial-gradient(850px 650px at 50% 100%, rgba(255,211,108,.08), transparent 55%),
        var(--bg);
      overflow-x:hidden;
    }

    /* Top bar */
    .topbar{
      position:sticky; top:0; z-index:30;
      backdrop-filter: blur(12px);
      background: linear-gradient(180deg, rgba(0,0,0,.35), rgba(0,0,0,0));
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    [data-theme="light"] .topbar{
      background: linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,.55));
      border-bottom:1px solid rgba(16,20,38,.08);
    }
    .topbarInner{
      max-width:1200px;
      margin:0 auto;
      padding:12px 14px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
      min-width:0;
      flex:1;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 16px 34px rgba(124,107,255,.22);
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo:before{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.40), transparent 55%);
      transform: rotate(12deg);
    }
    .brandText{min-width:0}
    .brandText b{display:block; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .brandText span{display:block; font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}

    .actions{display:flex; gap:8px; flex-wrap:wrap}
    .btn{
      border:none; cursor:pointer; user-select:none;
      padding:10px 12px;
      border-radius:14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:white;
      font-weight:800;
      box-shadow: 0 12px 26px rgba(124,107,255,.22);
      transition:.15s ease;
      display:inline-flex; align-items:center; gap:10px;
      white-space:nowrap;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0) scale(.99); }
    .btn.secondary{
      background: rgba(255,255,255,.05);
      color: var(--text);
      border:1px solid var(--line);
      box-shadow:none;
      font-weight:700;
    }
    .btn.ghost{
      background: transparent;
      border:1px solid var(--line);
      color: var(--text);
      box-shadow:none;
      font-weight:700;
    }
    .pill{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--muted);
      padding:10px 12px;
      border-radius:999px;
      font-size:12px;
      display:inline-flex; align-items:center; gap:8px;
      user-select:none;
    }
    .dot{
      width:8px;height:8px;border-radius:999px;
      background: var(--good);
      box-shadow: 0 0 0 3px rgba(124,255,178,.18);
    }

    /* Layout */
    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:14px;
      display:grid;
      grid-template-columns: 1fr 360px;
      gap:14px;
    }
    @media (max-width: 980px){
      .wrap{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .cardHead{
      padding:14px 14px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    [data-theme="light"] .cardHead{ border-bottom:1px solid rgba(16,20,38,.08); }
    .cardHead b{ font-size:14px; }
    .cardHead span{ font-size:12px; color:var(--muted); }

    .hero{
      padding:16px 14px;
      display:flex;
      gap:14px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .heroLeft{
      min-width: 240px;
      flex:1;
    }
    .heroTitle{
      font-size:22px;
      margin:0 0 6px;
      letter-spacing:.2px;
    }
    .heroSub{
      margin:0;
      color:var(--muted);
      line-height:1.7;
      font-size:13px;
    }
    .heroBadges{margin-top:12px; display:flex; gap:8px; flex-wrap:wrap}

    .qrBox{
      width:160px;
      height:160px;
      border-radius: 18px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      display:grid;
      place-items:center;
      padding:10px;
      box-shadow: var(--shadow2);
    }
    .qrCanvas{ width:140px; height:140px; border-radius:12px; background:#fff; }

    /* Controls */
    .controls{
      padding:12px 14px 14px;
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    .input, .select, .textarea{
      width:100%;
      border-radius: 14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 12px 12px;
      outline:none;
      font-size:13px;
      transition:.15s ease;
    }
    .input:focus, .select:focus, .textarea:focus{
      box-shadow: 0 0 0 3px rgba(124,107,255,.20);
      border-color: rgba(124,107,255,.40);
    }
    .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .row > *{ flex: 1; min-width: 160px; }
    .small{ font-size:12px; color:var(--muted); }
    .divider{
      height:1px;
      background: rgba(255,255,255,.08);
      margin: 10px 0;
    }
    [data-theme="light"] .divider{ background: rgba(16,20,38,.08); }

    /* Categories */
    .cats{
      padding: 0 14px 14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .catBtn{
      cursor:pointer;
      user-select:none;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color: var(--muted);
      padding:10px 12px;
      border-radius: 999px;
      font-size:12px;
      transition:.15s ease;
      display:inline-flex; gap:8px; align-items:center;
    }
    .catBtn.active{
      color: var(--text);
      border-color: rgba(255,211,108,.35);
      background: linear-gradient(135deg, rgba(255,211,108,.18), rgba(124,107,255,.10));
    }

    /* Grid items */
    .grid{
      padding: 0 14px 16px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width: 560px){ .grid{ grid-template-columns: 1fr; } }

    .item{
      border:1px solid var(--line);
      border-radius: var(--radius2);
      background: rgba(255,255,255,.03);
      overflow:hidden;
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
      position:relative;
    }
    .itemImg{
      height:140px;
      background: linear-gradient(135deg, rgba(124,107,255,.18), rgba(110,240,255,.10));
      display:flex; align-items:center; justify-content:center;
      color: rgba(255,255,255,.85);
      font-weight:900;
      letter-spacing:.8px;
      border-bottom:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      position:relative;
    }
    .itemImg img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
      filter: saturate(1.05) contrast(1.02);
    }
    .itemBody{ padding:12px 12px 10px; }
    .itemName{ font-weight:900; margin:0 0 4px; font-size:14px; }
    .itemDesc{ margin:0 0 10px; color:var(--muted); font-size:12px; line-height:1.6; min-height: 38px; }
    .itemFooter{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .price{
      font-weight:1000;
      font-size:14px;
      color: var(--gold);
      letter-spacing:.2px;
      white-space:nowrap;
    }
    .badge{
      font-size:11px;
      padding:6px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      white-space:nowrap;
    }

    /* Right panel */
    .sidePad{ padding:14px; }
    .sideBlock{
      border:1px solid var(--line);
      border-radius: 18px;
      background: rgba(255,255,255,.03);
      padding:12px;
      margin-bottom:12px;
    }
    .sideBlock b{ display:block; margin-bottom:8px; font-size:13px; }
    .sideBlock .small{ line-height:1.6; }

    /* Admin */
    .adminWrap{
      max-width:1200px;
      margin:0 auto;
      padding:14px;
      display:none;
    }
    .adminGrid{
      display:grid;
      grid-template-columns: 420px 1fr;
      gap:14px;
    }
    @media (max-width: 980px){ .adminGrid{ grid-template-columns: 1fr; } }

    .table{
      width:100%;
      border-collapse: collapse;
      overflow:hidden;
      border-radius: 16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
    }
    .table th, .table td{
      padding:10px 10px;
      border-bottom:1px solid rgba(255,255,255,.08);
      font-size:12px;
      text-align:right;
      vertical-align:top;
    }
    [dir="ltr"] .table th, [dir="ltr"] .table td{ text-align:left; }
    .table th{ color: var(--muted); font-weight:900; }
    .table tr:last-child td{ border-bottom:none; }
    .miniBtn{
      cursor:pointer;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding:8px 10px;
      border-radius: 12px;
      font-size:12px;
      user-select:none;
      transition:.15s ease;
      white-space:nowrap;
    }
    .miniBtn:hover{ transform: translateY(-1px); }
    .miniBtn.danger{ border-color: rgba(255,107,107,.30); background: rgba(255,107,107,.10); }

    .toast{
      position: fixed;
      left: 16px;
      bottom: 16px;
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;
      border-radius: 14px;
      font-size:12px;
      color:#fff;
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition:.2s ease;
      backdrop-filter: blur(10px);
      z-index:80;
      max-width:min(520px, 92vw);
    }
    .toast.show{ opacity:1; transform: translateY(0); }

    /* Hide/show pages */
    .pageMenu{ display:block; }
    .pageAdmin{ display:none; }

    /* Tiny shine */
    .shine{
      position:absolute;
      inset:-60%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), transparent 55%);
      transform: rotate(12deg);
      pointer-events:none;
      filter: blur(1px);
    }
  </style>
</head>

<body id="root" data-theme="dark">

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="topbarInner">
      <div class="brand">
        <div class="logo"><div class="shine"></div></div>
        <div class="brandText">
          <b id="brandName">LuxeQR Menu</b>
          <span id="brandSub">Menu ÙØ§Ø®Ø± + QR + Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… (Ø¨Ø¯ÙˆÙ† Backend)</span>
        </div>
      </div>

      <div class="actions">
        <span class="pill"><span class="dot"></span><span id="onlineTxt">Live</span></span>
        <button class="btn ghost" id="langBtn">AR / EN</button>
        <button class="btn secondary" id="themeBtn">â˜€ï¸</button>
        <button class="btn secondary" id="goAdminBtn">Dashboard</button>
      </div>
    </div>
  </div>

  <!-- MENU PAGE -->
  <div class="wrap pageMenu" id="menuPage">
    <div class="card">
      <div class="hero">
        <div class="heroLeft">
          <h1 class="heroTitle" id="heroTitle">Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹ Ù…Ù†ÙŠÙˆ Ø§Ù„Ù…Ø·Ø¹Ù…</h1>
          <p class="heroSub" id="heroSub">
            Ø§Ù…Ø³Ø­ Ø§Ù„Ù€ QR Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†ÙÙƒ. Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….
          </p>
          <div class="heroBadges">
            <span class="pill">âœ¨ <span id="badgeLux">ÙØ®Ù…</span></span>
            <span class="pill">ğŸ“± <span id="badgeMobile">Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„</span></span>
            <span class="pill">âš¡ <span id="badgeFast">Ø³Ø±ÙŠØ¹</span></span>
          </div>
        </div>

        <div class="qrBox">
          <canvas id="qrCanvas" class="qrCanvas" width="140" height="140"></canvas>
        </div>
      </div>

      <div class="controls">
        <div class="row" style="width:100%">
          <input class="input" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù..." />
          <select class="select" id="typeFilter">
            <option value="all">Ø§Ù„ÙƒÙ„</option>
            <option value="restaurant">Ù…Ø·Ø¹Ù…</option>
            <option value="cafe">ÙƒØ§ÙÙŠÙ‡</option>
            <option value="both">Ø§Ù„Ø§ØªÙ†ÙŠÙ†</option>
          </select>
          <select class="select" id="sortBy">
            <option value="featured">ØªØ±ØªÙŠØ¨ Ù…Ù…ÙŠØ²</option>
            <option value="priceAsc">Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ù‚Ù„</option>
            <option value="priceDesc">Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ø¹Ù„Ù‰</option>
            <option value="nameAsc">Ø§Ù„Ø§Ø³Ù…: A-Z</option>
          </select>
        </div>
      </div>

      <div class="cats" id="cats"></div>
      <div class="grid" id="grid"></div>
    </div>

    <!-- Side -->
    <div class="card">
      <div class="cardHead">
        <div>
          <b id="infoTitle">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</b><br/>
          <span id="infoSub">ØªÙˆØ§ØµÙ„ / Ø¹Ù†ÙˆØ§Ù† / Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„</span>
        </div>
        <span class="pill">â­ <span id="ratingTxt">4.8</span></span>
      </div>

      <div class="sidePad">
        <div class="sideBlock">
          <b id="restNameLabel">Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†</b>
          <div class="small" id="restNameValue">Luxe Restaurant & Cafe</div>
          <div class="divider"></div>
          <div class="small" id="restDescValue">Ø£ÙƒÙ„ ÙØ§Ø®Ø± + Ù‚Ù‡ÙˆØ© Ù…Ù…ÙŠØ²Ø©. Ø¬ÙˆØ¯Ø© + Ù†Ø¸Ø§ÙØ© + ØªØ¬Ø±Ø¨Ø© Ø£Ù†ÙŠÙ‚Ø©.</div>
        </div>

        <div class="sideBlock">
          <b id="contactLabel">ØªÙˆØ§ØµÙ„</b>
          <div class="small" id="contactValue">ğŸ“ 0100-000-0000</div>
          <div class="small" id="whatsValue">ğŸ’¬ WhatsApp: 0100-000-0000</div>
          <div class="divider"></div>
          <div class="small" id="addrValue">ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø´Ø§Ø±Ø¹ Ù…Ø«Ø§Ù„ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</div>
          <div class="small" id="hoursValue">â° 10:00 Øµ - 2:00 Øµ</div>

          <div class="divider"></div>
          <div class="row">
            <button class="btn secondary" id="callBtn">Ø§ØªØµØ§Ù„</button>
            <button class="btn" id="waBtn">ÙˆØ§ØªØ³Ø§Ø¨</button>
          </div>
        </div>

        <div class="sideBlock">
          <b id="tipsLabel">Ù…Ù„Ø§Ø­Ø¸Ø©</b>
          <div class="small" id="tipsValue">
            Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØºÙŠÙŠØ±. Ù„Ùˆ Ù…Ø´ Ù„Ø§Ù‚ÙŠ ØµÙ†ÙØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø®ØªØ§Ø± Ù‚Ø³Ù….
          </div>
          <div class="divider"></div>
          <button class="btn ghost" id="copyLinkBtn">Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ÙŠÙˆ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ADMIN PAGE -->
  <div class="adminWrap pageAdmin" id="adminPage">
    <div class="card" style="margin-bottom:14px;">
      <div class="cardHead">
        <div>
          <b id="adminTitle">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</b><br/>
          <span id="adminSub">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ / Ø­Ø°Ù Ø§Ù„Ø£ØµÙ†Ø§Ù ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø± (Ù…Ø­Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Backend)</span>
        </div>
        <div class="actions">
          <button class="btn secondary" id="backToMenuBtn">Ø§Ù„Ù…Ù†ÙŠÙˆ</button>
          <button class="btn ghost" id="lockBtn">Ù‚ÙÙ„</button>
        </div>
      </div>

      <div class="controls">
        <div class="row" style="width:100%">
          <input class="input" id="pinInput" placeholder="PIN Ù„Ù„Ø¯Ø®ÙˆÙ„ (Ø§ÙØªØ±Ø§Ø¶ÙŠ: 1234)" />
          <button class="btn" id="unlockBtn">Ø¯Ø®ÙˆÙ„</button>
          <button class="btn secondary" id="changePinBtn">ØªØºÙŠÙŠØ± PIN</button>
        </div>
        <div class="small" id="pinHint">
          Ù„Ùˆ ÙØªØ­Øª Dashboard Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯: Ù„Ø§Ø²Ù… ØªØ³ØªÙˆØ±Ø¯ Ù…Ù„Ù JSON Ø£Ùˆ ØªØ¯Ø®Ù„ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ù„Ø£Ù†Ù‡Ø§ LocalStorage).
        </div>
      </div>
    </div>

    <div class="adminGrid">
      <div class="card">
        <div class="cardHead">
          <div>
            <b id="settingsTitle">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙƒØ§Ù†</b><br/>
            <span id="settingsSub">Ø§Ø³Ù…/ÙˆØµÙ/ØªÙˆØ§ØµÙ„/Ø³Ø§Ø¹Ø§Øª/ØªÙ‚ÙŠÙŠÙ…</span>
          </div>
        </div>

        <div class="sidePad">
          <div class="sideBlock">
            <b>Ø§Ù„Ø¹Ø±Ø¨ÙŠ</b>
            <input class="input" id="nameAr" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù† (AR)" />
            <textarea class="textarea" id="descAr" placeholder="ÙˆØµÙ (AR)" rows="3"></textarea>
          </div>

          <div class="sideBlock">
            <b>English</b>
            <input class="input" id="nameEn" placeholder="Place name (EN)" />
            <textarea class="textarea" id="descEn" placeholder="Description (EN)" rows="3"></textarea>
          </div>

          <div class="sideBlock">
            <b>Contact</b>
            <input class="input" id="phone" placeholder="Phone e.g. 0100..." />
            <input class="input" id="whatsapp" placeholder="WhatsApp e.g. 0100..." />
            <input class="input" id="address" placeholder="Address" />
            <input class="input" id="hours" placeholder="Hours e.g. 10:00 - 2:00" />
            <div class="row">
              <input class="input" id="rating" placeholder="Rating e.g. 4.8" />
              <select class="select" id="currency">
                <option value="EGP">EGP</option>
                <option value="SAR">SAR</option>
                <option value="AED">AED</option>
                <option value="USD">USD</option>
              </select>
            </div>
            <button class="btn" id="saveSettingsBtn">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          </div>

          <div class="sideBlock">
            <b>Data</b>
            <div class="row">
              <button class="btn secondary" id="exportBtn">ØªØµØ¯ÙŠØ± JSON</button>
              <button class="btn secondary" id="importBtn">Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON</button>
              <input type="file" id="importFile" accept="application/json" style="display:none" />
            </div>
            <div class="divider"></div>
            <button class="btn ghost" id="resetAllBtn">Reset ÙƒØ§Ù…Ù„ (Ø®Ø·Ø±)</button>
          </div>

        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <div>
            <b id="itemsTitle">Ø§Ù„Ø£ØµÙ†Ø§Ù</b><br/>
            <span id="itemsSub">Ø£Ø¶Ù ØµÙ†Ù Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ø¹Ø¯Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯</span>
          </div>
        </div>

        <div class="sidePad">
          <div class="sideBlock">
            <b id="addEditTitle">Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„</b>

            <div class="row">
              <select class="select" id="itemType">
                <option value="both">Ù…Ø·Ø¹Ù… + ÙƒØ§ÙÙŠÙ‡</option>
                <option value="restaurant">Ù…Ø·Ø¹Ù…</option>
                <option value="cafe">ÙƒØ§ÙÙŠÙ‡</option>
              </select>

              <select class="select" id="itemCategory"></select>
            </div>

            <div class="divider"></div>

            <b style="margin-top:8px; display:block">Ø§Ù„Ø¹Ø±Ø¨ÙŠ</b>
            <input class="input" id="itemNameAr" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù (AR)" />
            <textarea class="textarea" id="itemDescAr" placeholder="ÙˆØµÙ (AR)" rows="2"></textarea>

            <div class="divider"></div>

            <b style="margin-top:8px; display:block">English</b>
            <input class="input" id="itemNameEn" placeholder="Item name (EN)" />
            <textarea class="textarea" id="itemDescEn" placeholder="Description (EN)" rows="2"></textarea>

            <div class="divider"></div>

            <div class="row">
              <input class="input" id="itemPrice" placeholder="Ø§Ù„Ø³Ø¹Ø± (Ø±Ù‚Ù…)" inputmode="decimal" />
              <input class="input" id="itemImage" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" />
            </div>

            <div class="row">
              <button class="btn" id="saveItemBtn">Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù</button>
              <button class="btn secondary" id="clearFormBtn">ØªÙØ±ÙŠØº</button>
            </div>

            <div class="small" id="formHint">
              Ù„Ùˆ Ù…Ø´ Ø¹Ø§ÙŠØ² ØµÙˆØ±ØŒ Ø³ÙŠØ¨ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ÙØ§Ø¶ÙŠ ÙˆÙ‡ÙŠØ¸Ù‡Ø± ÙƒØ§Ø±Øª ÙØ®Ù… Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©.
            </div>
          </div>

          <div class="sideBlock">
            <b>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</b>
            <div class="row" style="margin-bottom:10px;">
              <input class="input" id="adminSearch" placeholder="Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£ØµÙ†Ø§Ù..." />
              <select class="select" id="adminCatFilter"></select>
            </div>

            <table class="table" id="itemsTable"></table>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="toast" id="toast">ØªÙ… âœ…</div>

<script>
(() => {
  const $ = (s) => document.querySelector(s);

  // ---------- Storage Keys ----------
  const LS_KEY = "luxe_qr_menu_v1";
  const PIN_KEY = "luxe_qr_pin_v1";
  const THEME_KEY = "luxe_qr_theme";
  const LANG_KEY = "luxe_qr_lang";

  // ---------- Helpers ----------
  const uid = () => "id_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
  const clamp = (n,a,b)=>Math.max(a,Math.min(b,n));
  const toast = $("#toast");
  const showToast = (msg="ØªÙ… âœ…") => {
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove("show"), 1400);
  };

  const fmtPrice = (value, currency, lang) => {
    const num = Number(value || 0);
    const map = { EGP:"Ø¬.Ù…", SAR:"Ø±.Ø³", AED:"Ø¯.Ø¥", USD:"$" };
    const suffix = map[currency] || currency;
    const formatted = (lang === "en")
      ? num.toLocaleString("en-US", { maximumFractionDigits: 2 })
      : num.toLocaleString("ar-EG", { maximumFractionDigits: 2 });
    return lang === "en" ? `${suffix} ${formatted}` : `${formatted} ${suffix}`;
  };

  // ---------- Default Data ----------
  const defaultState = () => ({
    meta:{
      name:{ ar:"Luxe Restaurant & Cafe", en:"Luxe Restaurant & Cafe" },
      desc:{
        ar:"Ø£ÙƒÙ„ ÙØ§Ø®Ø± + Ù‚Ù‡ÙˆØ© Ù…Ù…ÙŠØ²Ø©. Ø¬ÙˆØ¯Ø© + Ù†Ø¸Ø§ÙØ© + ØªØ¬Ø±Ø¨Ø© Ø£Ù†ÙŠÙ‚Ø©.",
        en:"Fine dining + signature coffee. Quality, cleanliness, and an elegant experience."
      },
      phone:"0100-000-0000",
      whatsapp:"0100-000-0000",
      address:"Ø´Ø§Ø±Ø¹ Ù…Ø«Ø§Ù„ØŒ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©",
      hours:"10:00 Øµ - 2:00 Øµ",
      rating:"4.8",
      currency:"EGP"
    },
    categories:[
      { id:"starters",  name:{ar:"Ù…Ù‚Ø¨Ù„Ø§Øª", en:"Starters"} },
      { id:"mains",     name:{ar:"Ø£Ø·Ø¨Ø§Ù‚ Ø±Ø¦ÙŠØ³ÙŠØ©", en:"Main Courses"} },
      { id:"sandwiches",name:{ar:"Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª", en:"Sandwiches"} },
      { id:"desserts",  name:{ar:"Ø­Ù„ÙˆÙŠØ§Øª", en:"Desserts"} },
      { id:"coffee",    name:{ar:"Ù‚Ù‡ÙˆØ©", en:"Coffee"} },
      { id:"drinks",    name:{ar:"Ù…Ø´Ø±ÙˆØ¨Ø§Øª", en:"Drinks"} },
    ],
    items:[
      {
        id:uid(),
        type:"restaurant",
        categoryId:"starters",
        name:{ ar:"Ø¨Ø·Ø§Ø·Ø³ ÙƒØ±Ø§Ù†Ø´ÙŠ", en:"Crispy Fries" },
        desc:{ ar:"ØªÙˆØ§Ø¨Ù„ Ø®Ø§ØµØ© + ØµÙˆØµ Ø§Ø®ØªÙŠØ§Ø±Ùƒ.", en:"Signature spices + your choice of sauce." },
        price:79,
        image:""
      },
      {
        id:uid(),
        type:"restaurant",
        categoryId:"mains",
        name:{ ar:"Ø³ØªÙŠÙƒ ØµÙˆØµ ÙÙ„ÙÙ„", en:"Pepper Steak" },
        desc:{ ar:"Ù…Ø³ØªÙˆÙ‰ Ø§Ø³ØªÙˆØ§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø·Ù„Ø¨.", en:"Cooked to your preference." },
        price:399,
        image:""
      },
      {
        id:uid(),
        type:"cafe",
        categoryId:"coffee",
        name:{ ar:"Ù„Ø§ØªÙŠÙ‡ ÙØ§Ù†ÙŠÙ„Ø§", en:"Vanilla Latte" },
        desc:{ ar:"Ø­Ù„ÙŠØ¨ Ù…Ø®Ù…Ù„ÙŠ + ÙØ§Ù†ÙŠÙ„Ø§.", en:"Velvety milk + vanilla." },
        price:95,
        image:""
      },
      {
        id:uid(),
        type:"both",
        categoryId:"desserts",
        name:{ ar:"ØªØ´ÙŠØ² ÙƒÙŠÙƒ", en:"Cheesecake" },
        desc:{ ar:"ÙƒØ±ÙŠÙ…ÙŠ ÙˆÙ…Ø¸Ø¨ÙˆØ· Ø¹Ù„Ù‰ Ø§Ù„Ø¢Ø®Ø±.", en:"Creamy and perfectly balanced." },
        price:140,
        image:""
      },
      {
        id:uid(),
        type:"both",
        categoryId:"drinks",
        name:{ ar:"Ù…ÙˆÙ‡ÙŠØªÙˆ", en:"Mojito" },
        desc:{ ar:"Ù†Ø¹Ù†Ø§Ø¹ Ø·Ø§Ø²Ø© + Ù„ÙŠÙ…ÙˆÙ†.", en:"Fresh mint + lime." },
        price:110,
        image:""
      }
    ]
  });

  const loadState = () => {
    try{
      const s = JSON.parse(localStorage.getItem(LS_KEY) || "null");
      if(s && s.meta && s.categories && s.items) return s;
    }catch(e){}
    const init = defaultState();
    localStorage.setItem(LS_KEY, JSON.stringify(init));
    return init;
  };

  let state = loadState();

  // ---------- Language & Theme ----------
  let lang = (localStorage.getItem(LANG_KEY) || "ar"); // ar/en
  let theme = (localStorage.getItem(THEME_KEY) || "dark");

  const root = $("#root");
  const applyLang = () => {
    const isAr = lang === "ar";
    document.documentElement.lang = isAr ? "ar" : "en";
    document.documentElement.dir = isAr ? "rtl" : "ltr";
    // Quick text map
    const t = (ar,en) => isAr ? ar : en;

    $("#brandName").textContent = t("LuxeQR Menu", "LuxeQR Menu");
    $("#brandSub").textContent = t("Menu ÙØ§Ø®Ø± + QR + Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… (Ø¨Ø¯ÙˆÙ† Backend)","Luxury menu + QR + dashboard (no backend)");
    $("#onlineTxt").textContent = t("Ø´ØºØ§Ù„", "Live");

    $("#heroTitle").textContent = t("Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ‘‹ Ù…Ù†ÙŠÙˆ Ø§Ù„Ù…ÙƒØ§Ù†", "Welcome ğŸ‘‹ Menu");
    $("#heroSub").textContent = t("Ø§Ù…Ø³Ø­ Ø§Ù„Ù€ QR Ø£Ùˆ Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†ÙÙƒ. Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù…Ø­Ø¯Ø«Ø© Ù…Ù† Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….","Scan the QR or search your item. Prices are updated from the dashboard.");
    $("#badgeLux").textContent = t("ÙØ®Ù…","Luxury");
    $("#badgeMobile").textContent = t("Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„","Mobile-ready");
    $("#badgeFast").textContent = t("Ø³Ø±ÙŠØ¹","Fast");

    $("#searchInput").placeholder = t("Ø§Ø¨Ø­Ø« Ø¹Ù† ØµÙ†Ù...","Search items...");
    $("#typeFilter").options[0].textContent = t("Ø§Ù„ÙƒÙ„","All");
    $("#typeFilter").options[1].textContent = t("Ù…Ø·Ø¹Ù…","Restaurant");
    $("#typeFilter").options[2].textContent = t("ÙƒØ§ÙÙŠÙ‡","Cafe");
    $("#typeFilter").options[3].textContent = t("Ø§Ù„Ø§ØªÙ†ÙŠÙ†","Both");

    $("#sortBy").options[0].textContent = t("ØªØ±ØªÙŠØ¨ Ù…Ù…ÙŠØ²","Featured");
    $("#sortBy").options[1].textContent = t("Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ù‚Ù„","Price: Low");
    $("#sortBy").options[2].textContent = t("Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ø¹Ù„Ù‰","Price: High");
    $("#sortBy").options[3].textContent = t("Ø§Ù„Ø§Ø³Ù…: A-Z","Name: A-Z");

    $("#infoTitle").textContent = t("Ù…Ø¹Ù„ÙˆÙ…Ø§Øª","Info");
    $("#infoSub").textContent = t("ØªÙˆØ§ØµÙ„ / Ø¹Ù†ÙˆØ§Ù† / Ø³Ø§Ø¹Ø§Øª Ø¹Ù…Ù„","Contact / Address / Hours");
    $("#ratingTxt").textContent = state.meta.rating || "â€”";

    $("#restNameLabel").textContent = t("Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†","Place");
    $("#restNameValue").textContent = isAr ? state.meta.name.ar : state.meta.name.en;
    $("#restDescValue").textContent = isAr ? state.meta.desc.ar : state.meta.desc.en;

    $("#contactLabel").textContent = t("ØªÙˆØ§ØµÙ„","Contact");
    $("#contactValue").textContent = t("ğŸ“ ØªÙ„ÙŠÙÙˆÙ†: ","ğŸ“ Phone: ") + (state.meta.phone || "â€”");
    $("#whatsValue").textContent = "ğŸ’¬ WhatsApp: " + (state.meta.whatsapp || "â€”");
    $("#addrValue").textContent = t("ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ","ğŸ“ Address: ") + (state.meta.address || "â€”");
    $("#hoursValue").textContent = t("â° Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯: ","â° Hours: ") + (state.meta.hours || "â€”");

    $("#callBtn").textContent = t("Ø§ØªØµØ§Ù„","Call");
    $("#waBtn").textContent = t("ÙˆØ§ØªØ³Ø§Ø¨","WhatsApp");

    $("#tipsLabel").textContent = t("Ù…Ù„Ø§Ø­Ø¸Ø©","Note");
    $("#tipsValue").textContent = t("Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØºÙŠÙŠØ±. Ù„Ùˆ Ù…Ø´ Ù„Ø§Ù‚ÙŠ ØµÙ†ÙØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ø®ØªØ§Ø± Ù‚Ø³Ù….","Prices may change. Use search or categories to find your item.");
    $("#copyLinkBtn").textContent = t("Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù†ÙŠÙˆ","Copy menu link");

    $("#goAdminBtn").textContent = t("Dashboard","Dashboard");
    $("#themeBtn").textContent = theme === "dark" ? "â˜€ï¸" : "ğŸŒ™";

    // Admin texts
    $("#adminTitle").textContent = t("Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…","Dashboard");
    $("#adminSub").textContent = t("Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ / Ø­Ø°Ù Ø§Ù„Ø£ØµÙ†Ø§Ù ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø± (Ù…Ø­Ù„ÙŠ Ø¨Ø¯ÙˆÙ† Backend)","Add / edit / delete items and prices (local, no backend)");
    $("#backToMenuBtn").textContent = t("Ø§Ù„Ù…Ù†ÙŠÙˆ","Menu");
    $("#lockBtn").textContent = t("Ù‚ÙÙ„","Lock");

    $("#pinInput").placeholder = t("PIN Ù„Ù„Ø¯Ø®ÙˆÙ„ (Ø§ÙØªØ±Ø§Ø¶ÙŠ: 1234)","Enter PIN (default: 1234)");
    $("#unlockBtn").textContent = t("Ø¯Ø®ÙˆÙ„","Unlock");
    $("#changePinBtn").textContent = t("ØªØºÙŠÙŠØ± PIN","Change PIN");
    $("#pinHint").textContent = t(
      "Ù„Ùˆ ÙØªØ­Øª Dashboard Ø¹Ù„Ù‰ Ø¬Ù‡Ø§Ø² Ø¬Ø¯ÙŠØ¯: Ù„Ø§Ø²Ù… ØªØ³ØªÙˆØ±Ø¯ Ù…Ù„Ù JSON Ø£Ùˆ ØªØ³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø² (Ø¹Ø´Ø§Ù† LocalStorage).",
      "If you open the dashboard on a new device: import the JSON file or use the same device (LocalStorage)."
    );

    $("#settingsTitle").textContent = t("Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ÙƒØ§Ù†","Place Settings");
    $("#settingsSub").textContent = t("Ø§Ø³Ù…/ÙˆØµÙ/ØªÙˆØ§ØµÙ„/Ø³Ø§Ø¹Ø§Øª/ØªÙ‚ÙŠÙŠÙ…","Name/Description/Contact/Hours/Rating");
    $("#saveSettingsBtn").textContent = t("Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª","Save settings");
    $("#exportBtn").textContent = t("ØªØµØ¯ÙŠØ± JSON","Export JSON");
    $("#importBtn").textContent = t("Ø§Ø³ØªÙŠØ±Ø§Ø¯ JSON","Import JSON");
    $("#resetAllBtn").textContent = t("Reset ÙƒØ§Ù…Ù„ (Ø®Ø·Ø±)","Full reset (danger)");

    $("#itemsTitle").textContent = t("Ø§Ù„Ø£ØµÙ†Ø§Ù","Items");
    $("#itemsSub").textContent = t("Ø£Ø¶Ù ØµÙ†Ù Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ Ø¹Ø¯Ù„ Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯","Add a new item or edit existing");

    $("#addEditTitle").textContent = t("Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„","Add / Edit");
    $("#itemNameAr").placeholder = t("Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù (AR)","Item name (AR)");
    $("#itemDescAr").placeholder = t("ÙˆØµÙ (AR)","Description (AR)");
    $("#itemNameEn").placeholder = t("Item name (EN)","Item name (EN)");
    $("#itemDescEn").placeholder = t("Description (EN)","Description (EN)");
    $("#itemPrice").placeholder = t("Ø§Ù„Ø³Ø¹Ø± (Ø±Ù‚Ù…)","Price (number)");
    $("#itemImage").placeholder = t("Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)","Image URL (optional)");
    $("#saveItemBtn").textContent = t("Ø­ÙØ¸ Ø§Ù„ØµÙ†Ù","Save item");
    $("#clearFormBtn").textContent = t("ØªÙØ±ÙŠØº","Clear");

    $("#formHint").textContent = t(
      "Ù„Ùˆ Ù…Ø´ Ø¹Ø§ÙŠØ² ØµÙˆØ±ØŒ Ø³ÙŠØ¨ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ÙØ§Ø¶ÙŠ ÙˆÙ‡ÙŠØ¸Ù‡Ø± ÙƒØ§Ø±Øª ÙØ®Ù… Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©.",
      "Leave image URL empty to show a luxury card without image."
    );
    $("#adminSearch").placeholder = t("Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£ØµÙ†Ø§Ù...","Search items...");
  };

  const applyTheme = () => {
    root.setAttribute("data-theme", theme);
    localStorage.setItem(THEME_KEY, theme);
    $("#themeBtn").textContent = theme === "dark" ? "â˜€ï¸" : "ğŸŒ™";
  };

  // ---------- Pages ----------
  const menuPage = $("#menuPage");
  const adminPage = $("#adminPage");
  const showPage = (which) => {
    if(which === "admin"){
      menuPage.style.display = "none";
      adminPage.style.display = "block";
      adminPage.classList.add("pageAdmin");
      menuPage.classList.remove("pageMenu");
      location.hash = "admin";
    } else {
      adminPage.style.display = "none";
      menuPage.style.display = "grid";
      location.hash = "";
    }
  };

  // ---------- QR ----------
  const drawQR = async () => {
    const canvas = $("#qrCanvas");
    const url = location.origin + location.pathname; // current page without hash
    try{
      if(window.QRCode && QRCode.toCanvas){
        await QRCode.toCanvas(canvas, url, {
          margin: 1,
          width: 140,
          color: { dark:"#111827", light:"#ffffff" }
        });
      } else {
        // fallback: simple text
        const ctx = canvas.getContext("2d");
        ctx.fillStyle="#fff"; ctx.fillRect(0,0,140,140);
        ctx.fillStyle="#111"; ctx.font="12px sans-serif";
        ctx.fillText("QR lib not loaded", 18, 70);
      }
    }catch(e){
      // ignore
    }
  };

  // ---------- Menu Rendering ----------
  let activeCat = "all";

  const getVisibleItems = () => {
    const q = ($("#searchInput").value || "").trim().toLowerCase();
    const type = $("#typeFilter").value;
    const sort = $("#sortBy").value;

    const textPick = (obj) => (lang === "ar" ? (obj.ar||"") : (obj.en||""));

    let items = state.items.slice();

    // type filter
    items = items.filter(it => {
      if(type === "all") return true;
      if(type === "both") return it.type === "both";
      return (it.type === type || it.type === "both");
    });

    // category filter
    if(activeCat !== "all"){
      items = items.filter(it => it.categoryId === activeCat);
    }

    // search
    if(q){
      items = items.filter(it => {
        const n = (textPick(it.name) || "").toLowerCase();
        const d = (textPick(it.desc) || "").toLowerCase();
        return n.includes(q) || d.includes(q);
      });
    }

    // sort
    if(sort === "priceAsc") items.sort((a,b)=>Number(a.price)-Number(b.price));
    else if(sort === "priceDesc") items.sort((a,b)=>Number(b.price)-Number(a.price));
    else if(sort === "nameAsc"){
      items.sort((a,b)=>{
        const an = (textPick(a.name) || "").toLowerCase();
        const bn = (textPick(b.name) || "").toLowerCase();
        return an.localeCompare(bn);
      });
    } else {
      // featured: keep as is
    }

    return items;
  };

  const renderCats = () => {
    const catsEl = $("#cats");
    catsEl.innerHTML = "";
    const t = (ar,en)=> (lang==="ar"?ar:en);

    const mk = (id, label) => {
      const b = document.createElement("button");
      b.className = "catBtn" + (activeCat === id ? " active" : "");
      b.textContent = label;
      b.addEventListener("click", () => {
        activeCat = id;
        renderCats();
        renderGrid();
      });
      return b;
    };

    catsEl.appendChild(mk("all", t("Ø§Ù„ÙƒÙ„","All")));
    state.categories.forEach(c=>{
      catsEl.appendChild(mk(c.id, (lang==="ar"?c.name.ar:c.name.en)));
    });
  };

  const renderMeta = () => {
    $("#ratingTxt").textContent = state.meta.rating || "â€”";
    $("#restNameValue").textContent = (lang==="ar"?state.meta.name.ar:state.meta.name.en);
    $("#restDescValue").textContent = (lang==="ar"?state.meta.desc.ar:state.meta.desc.en);

    $("#contactValue").textContent = (lang==="ar"?"ğŸ“ ØªÙ„ÙŠÙÙˆÙ†: ":"ğŸ“ Phone: ") + (state.meta.phone || "â€”");
    $("#whatsValue").textContent = "ğŸ’¬ WhatsApp: " + (state.meta.whatsapp || "â€”");
    $("#addrValue").textContent = (lang==="ar"?"ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ":"ğŸ“ Address: ") + (state.meta.address || "â€”");
    $("#hoursValue").textContent = (lang==="ar"?"â° Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯: ":"â° Hours: ") + (state.meta.hours || "â€”");
  };

  const renderGrid = () => {
    const grid = $("#grid");
    grid.innerHTML = "";
    const items = getVisibleItems();
    const currency = state.meta.currency || "EGP";

    const catName = (catId) => {
      const c = state.categories.find(x=>x.id===catId);
      if(!c) return "";
      return (lang==="ar"?c.name.ar:c.name.en);
    };

    items.forEach(it=>{
      const card = document.createElement("div");
      card.className = "item";

      const hasImg = !!(it.image && it.image.trim());
      const name = (lang==="ar"?it.name.ar:it.name.en) || "";
      const desc = (lang==="ar"?it.desc.ar:it.desc.en) || "";
      const badge = it.type === "both"
        ? (lang==="ar" ? "Ù…Ø·Ø¹Ù… + ÙƒØ§ÙÙŠÙ‡" : "Restaurant + Cafe")
        : it.type === "restaurant"
          ? (lang==="ar" ? "Ù…Ø·Ø¹Ù…" : "Restaurant")
          : (lang==="ar" ? "ÙƒØ§ÙÙŠÙ‡" : "Cafe");

      const imgHtml = hasImg
        ? `<img src="${it.image.replaceAll('"','&quot;')}" alt="">`
        : `<div style="font-size:18px; opacity:.92">LUXE</div>`;

      card.innerHTML = `
        <div class="itemImg">${imgHtml}</div>
        <div class="itemBody">
          <p class="itemName">${escapeHtml(name)}</p>
          <p class="itemDesc">${escapeHtml(desc)}</p>
          <div class="itemFooter">
            <span class="price">${fmtPrice(it.price, currency, lang)}</span>
            <span class="badge">${escapeHtml(catName(it.categoryId))} â€¢ ${escapeHtml(badge)}</span>
          </div>
        </div>
      `;
      grid.appendChild(card);
    });

    if(items.length === 0){
      const empty = document.createElement("div");
      empty.className = "item";
      empty.style.gridColumn = "1 / -1";
      empty.innerHTML = `
        <div class="itemBody">
          <p class="itemName">${lang==="ar" ? "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬" : "No results"}</p>
          <p class="itemDesc">${lang==="ar" ? "Ø¬Ø±Ù‘Ø¨ ØªØºÙŠØ± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„Ù‚Ø³Ù…." : "Try changing your search or category."}</p>
        </div>
      `;
      grid.appendChild(empty);
    }
  };

  function escapeHtml(s){
    return String(s||"")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }

  // ---------- Admin (Lock) ----------
  const getPin = () => localStorage.getItem(PIN_KEY) || "1234";
  const setPin = (p) => localStorage.setItem(PIN_KEY, p);

  let unlocked = false;
  const requireUnlock = () => {
    unlocked = false;
    disableAdmin(true);
  };

  const disableAdmin = (disabled) => {
    const ids = [
      "nameAr","descAr","nameEn","descEn","phone","whatsapp","address","hours","rating","currency",
      "saveSettingsBtn","exportBtn","importBtn","resetAllBtn",
      "itemType","itemCategory","itemNameAr","itemDescAr","itemNameEn","itemDescEn","itemPrice","itemImage",
      "saveItemBtn","clearFormBtn","adminSearch","adminCatFilter"
    ];
    ids.forEach(id=>{
      const el = $("#"+id);
      if(!el) return;
      el.disabled = disabled;
      el.style.opacity = disabled ? .6 : 1;
      el.style.pointerEvents = disabled ? "none" : "auto";
    });
    $("#itemsTable").style.opacity = disabled ? .7 : 1;
  };

  // ---------- Admin Rendering ----------
  let editId = null;

  const fillSettingsForm = () => {
    $("#nameAr").value = state.meta.name.ar || "";
    $("#descAr").value = state.meta.desc.ar || "";
    $("#nameEn").value = state.meta.name.en || "";
    $("#descEn").value = state.meta.desc.en || "";
    $("#phone").value = state.meta.phone || "";
    $("#whatsapp").value = state.meta.whatsapp || "";
    $("#address").value = state.meta.address || "";
    $("#hours").value = state.meta.hours || "";
    $("#rating").value = state.meta.rating || "";
    $("#currency").value = state.meta.currency || "EGP";
  };

  const fillCategorySelects = () => {
    const catSel = $("#itemCategory");
    const adminCat = $("#adminCatFilter");
    catSel.innerHTML = "";
    adminCat.innerHTML = "";

    const optAll = document.createElement("option");
    optAll.value = "all";
    optAll.textContent = (lang==="ar" ? "ÙƒÙ„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…" : "All categories");
    adminCat.appendChild(optAll);

    state.categories.forEach(c=>{
      const o1 = document.createElement("option");
      o1.value = c.id;
      o1.textContent = (lang==="ar" ? c.name.ar : c.name.en);
      catSel.appendChild(o1);

      const o2 = document.createElement("option");
      o2.value = c.id;
      o2.textContent = (lang==="ar" ? c.name.ar : c.name.en);
      adminCat.appendChild(o2);
    });
  };

  const clearItemForm = () => {
    editId = null;
    $("#itemType").value = "both";
    $("#itemCategory").value = state.categories[0]?.id || "starters";
    $("#itemNameAr").value = "";
    $("#itemDescAr").value = "";
    $("#itemNameEn").value = "";
    $("#itemDescEn").value = "";
    $("#itemPrice").value = "";
    $("#itemImage").value = "";
    showToast(lang==="ar" ? "ØªÙ… ØªÙØ±ÙŠØº Ø§Ù„Ù†Ù…ÙˆØ°Ø¬" : "Form cleared");
  };

  const saveState = () => localStorage.setItem(LS_KEY, JSON.stringify(state));

  const saveSettings = () => {
    state.meta.name.ar = $("#nameAr").value.trim();
    state.meta.desc.ar = $("#descAr").value.trim();
    state.meta.name.en = $("#nameEn").value.trim();
    state.meta.desc.en = $("#descEn").value.trim();

    state.meta.phone = $("#phone").value.trim();
    state.meta.whatsapp = $("#whatsapp").value.trim();
    state.meta.address = $("#address").value.trim();
    state.meta.hours = $("#hours").value.trim();
    state.meta.rating = $("#rating").value.trim();
    state.meta.currency = $("#currency").value;

    saveState();
    renderMeta();
    applyLang();
    showToast(lang==="ar" ? "ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª âœ…" : "Settings saved âœ…");
  };

  const saveItem = () => {
    const price = Number($("#itemPrice").value);
    if(!isFinite(price)){
      showToast(lang==="ar" ? "Ø§Ù„Ø³Ø¹Ø± Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø±Ù‚Ù…" : "Price must be a number");
      return;
    }

    const data = {
      type: $("#itemType").value,
      categoryId: $("#itemCategory").value,
      name:{
        ar: $("#itemNameAr").value.trim(),
        en: $("#itemNameEn").value.trim()
      },
      desc:{
        ar: $("#itemDescAr").value.trim(),
        en: $("#itemDescEn").value.trim()
      },
      price: price,
      image: $("#itemImage").value.trim()
    };

    if(!data.name.ar && !data.name.en){
      showToast(lang==="ar" ? "Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù" : "Add item name");
      return;
    }

    if(editId){
      const idx = state.items.findIndex(x=>x.id===editId);
      if(idx >= 0){
        state.items[idx] = { ...state.items[idx], ...data };
      }
      editId = null;
      showToast(lang==="ar" ? "ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âœ…" : "Updated âœ…");
    } else {
      state.items.unshift({ id: uid(), ...data });
      showToast(lang==="ar" ? "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…" : "Added âœ…");
    }

    saveState();
    renderGrid();
    renderAdminTable();
    clearItemForm();
  };

  const renderAdminTable = () => {
    const q = ($("#adminSearch").value || "").trim().toLowerCase();
    const catFilter = $("#adminCatFilter").value || "all";
    const currency = state.meta.currency || "EGP";

    const pickName = (it) => (lang==="ar" ? (it.name.ar||it.name.en||"") : (it.name.en||it.name.ar||""));
    const pickCat = (id) => {
      const c = state.categories.find(x=>x.id===id);
      return c ? (lang==="ar"?c.name.ar:c.name.en) : "";
    };
    const pickType = (type) => {
      if(type==="both") return lang==="ar" ? "Ø§Ù„Ø§ØªÙ†ÙŠÙ†" : "Both";
      if(type==="restaurant") return lang==="ar" ? "Ù…Ø·Ø¹Ù…" : "Restaurant";
      return lang==="ar" ? "ÙƒØ§ÙÙŠÙ‡" : "Cafe";
    };

    let items = state.items.slice();

    if(catFilter !== "all") items = items.filter(it=>it.categoryId===catFilter);

    if(q){
      items = items.filter(it=>{
        const n = pickName(it).toLowerCase();
        const d = (lang==="ar" ? (it.desc.ar||"") : (it.desc.en||"")).toLowerCase();
        return n.includes(q) || d.includes(q);
      });
    }

    const table = $("#itemsTable");
    table.innerHTML = `
      <thead>
        <tr>
          <th>${lang==="ar" ? "Ø§Ù„ØµÙ†Ù" : "Item"}</th>
          <th>${lang==="ar" ? "Ø§Ù„Ù‚Ø³Ù…" : "Category"}</th>
          <th>${lang==="ar" ? "Ø§Ù„Ù†ÙˆØ¹" : "Type"}</th>
          <th>${lang==="ar" ? "Ø§Ù„Ø³Ø¹Ø±" : "Price"}</th>
          <th>${lang==="ar" ? "Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª" : "Actions"}</th>
        </tr>
      </thead>
      <tbody></tbody>
    `;
    const tb = table.querySelector("tbody");

    items.forEach(it=>{
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td><b>${escapeHtml(pickName(it))}</b><div class="small">${escapeHtml(lang==="ar"?(it.desc.ar||""):(it.desc.en||""))}</div></td>
        <td>${escapeHtml(pickCat(it.categoryId))}</td>
        <td>${escapeHtml(pickType(it.type))}</td>
        <td><b style="color:var(--gold)">${fmtPrice(it.price, currency, lang)}</b></td>
        <td>
          <button class="miniBtn" data-act="edit" data-id="${it.id}">${lang==="ar"?"ØªØ¹Ø¯ÙŠÙ„":"Edit"}</button>
          <button class="miniBtn danger" data-act="del" data-id="${it.id}">${lang==="ar"?"Ø­Ø°Ù":"Delete"}</button>
        </td>
      `;
      tb.appendChild(tr);
    });

    tb.querySelectorAll("button").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        const id = btn.dataset.id;
        const act = btn.dataset.act;
        if(act === "edit") startEdit(id);
        else if(act === "del") delItem(id);
      });
    });

    if(items.length === 0){
      const tr = document.createElement("tr");
      tr.innerHTML = `<td colspan="5" style="color:var(--muted)">${lang==="ar"?"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù†Ø§ØµØ±":"No items"}</td>`;
      tb.appendChild(tr);
    }
  };

  const startEdit = (id) => {
    const it = state.items.find(x=>x.id===id);
    if(!it) return;
    editId = id;
    $("#itemType").value = it.type;
    $("#itemCategory").value = it.categoryId;
    $("#itemNameAr").value = it.name.ar || "";
    $("#itemDescAr").value = it.desc.ar || "";
    $("#itemNameEn").value = it.name.en || "";
    $("#itemDescEn").value = it.desc.en || "";
    $("#itemPrice").value = it.price;
    $("#itemImage").value = it.image || "";
    showToast(lang==="ar" ? "ÙˆØ¶Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âœï¸" : "Edit mode âœï¸");
    window.scrollTo({ top: 0, behavior: "smooth" });
  };

  const delItem = (id) => {
    const ok = confirm(lang==="ar" ? "Ù…ØªØ£ÙƒØ¯ Ø­Ø°Ù Ø§Ù„ØµÙ†ÙØŸ" : "Delete this item?");
    if(!ok) return;
    state.items = state.items.filter(x=>x.id!==id);
    saveState();
    renderGrid();
    renderAdminTable();
    showToast(lang==="ar" ? "ØªÙ… Ø§Ù„Ø­Ø°Ù ğŸ—‘ï¸" : "Deleted ğŸ—‘ï¸");
  };

  // ---------- Export/Import ----------
  const exportJSON = () => {
    const payload = {
      exportedAt: new Date().toISOString(),
      state
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "qrmenu-data.json";
    document.body.appendChild(a);
    a.click();
    a.remove();
    showToast(lang==="ar" ? "ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± â¤“" : "Exported â¤“");
  };

  const importJSON = async (file) => {
    try{
      const text = await file.text();
      const obj = JSON.parse(text);
      if(obj && obj.state && obj.state.meta && obj.state.categories && obj.state.items){
        state = obj.state;
        saveState();
        fillSettingsForm();
        fillCategorySelects();
        renderCats();
        renderMeta();
        renderGrid();
        renderAdminTable();
        applyLang();
        showToast(lang==="ar" ? "ØªÙ… Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯ âœ…" : "Imported âœ…");
      } else {
        showToast(lang==="ar" ? "Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­" : "Invalid file");
      }
    }catch(e){
      showToast(lang==="ar" ? "ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯" : "Import failed");
    }
  };

  // ---------- Reset ----------
  const resetAll = () => {
    const ok = confirm(lang==="ar" ? "Ù‡ÙŠÙ…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ© ÙˆÙŠØ±Ø¬Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ. Ù…ØªØ£ÙƒØ¯ØŸ" : "This will wipe local data and restore defaults. Continue?");
    if(!ok) return;
    state = defaultState();
    saveState();
    fillSettingsForm();
    fillCategorySelects();
    activeCat = "all";
    renderCats();
    renderMeta();
    renderGrid();
    renderAdminTable();
    showToast(lang==="ar" ? "ØªÙ… Ø§Ù„Ø±ÙŠØ³Øª âœ…" : "Reset âœ…");
  };

  // ---------- Menu actions (Call/WA/Copy) ----------
  const callAction = () => {
    const p = (state.meta.phone || "").replace(/\s+/g,"");
    if(!p){ showToast(lang==="ar" ? "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù…" : "No phone"); return; }
    location.href = `tel:${p}`;
  };
  const waAction = () => {
    const w = (state.meta.whatsapp || "").replace(/\D/g,"");
    if(!w){ showToast(lang==="ar" ? "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ§ØªØ³Ø§Ø¨" : "No WhatsApp"); return; }
    const msg = encodeURIComponent(lang==="ar" ? "Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø¹Ù†Ø¯ÙŠ Ø§Ø³ØªÙØ³Ø§Ø± Ù…Ù† Ø§Ù„Ù…Ù†ÙŠÙˆ." : "Hello, I have a question from the menu.");
    location.href = `https://wa.me/${w}?text=${msg}`;
  };
  const copyLink = async () => {
    const url = location.origin + location.pathname;
    try{
      await navigator.clipboard.writeText(url);
      showToast(lang==="ar" ? "ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· âœ…" : "Link copied âœ…");
    }catch(e){
      showToast(lang==="ar" ? "Ø§Ù†Ø³Ø® ÙŠØ¯ÙˆÙŠÙ‹Ø§: " + url : "Copy manually: " + url);
    }
  };

  // ---------- Wiring: Menu ----------
  $("#searchInput").addEventListener("input", renderGrid);
  $("#typeFilter").addEventListener("change", renderGrid);
  $("#sortBy").addEventListener("change", renderGrid);

  $("#callBtn").addEventListener("click", callAction);
  $("#waBtn").addEventListener("click", waAction);
  $("#copyLinkBtn").addEventListener("click", copyLink);

  // ---------- Wiring: Top actions ----------
  $("#langBtn").addEventListener("click", ()=>{
    lang = (lang === "ar" ? "en" : "ar");
    localStorage.setItem(LANG_KEY, lang);
    applyLang();
    renderCats();
    renderMeta();
    renderGrid();
    fillCategorySelects();
    renderAdminTable();
    showToast(lang==="ar" ? "ØªÙ… Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ø¹Ø±Ø¨ÙŠØ©" : "Switched to English");
  });

  $("#themeBtn").addEventListener("click", ()=>{
    theme = (theme === "dark" ? "light" : "dark");
    applyTheme();
    showToast(theme === "dark" ? "Dark âœ…" : "Light âœ…");
  });

  $("#goAdminBtn").addEventListener("click", ()=>{
    showPage("admin");
    fillSettingsForm();
    fillCategorySelects();
    renderAdminTable();
    requireUnlock();
    showToast(lang==="ar" ? "Dashboard" : "Dashboard");
  });

  // ---------- Wiring: Admin ----------
  $("#backToMenuBtn").addEventListener("click", ()=>{
    showPage("menu");
  });

  $("#unlockBtn").addEventListener("click", ()=>{
    const pin = ($("#pinInput").value || "").trim();
    if(pin === getPin()){
      unlocked = true;
      disableAdmin(false);
      showToast(lang==="ar" ? "ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…" : "Unlocked âœ…");
    } else {
      showToast(lang==="ar" ? "PIN ØºÙ„Ø·" : "Wrong PIN");
    }
  });

  $("#lockBtn").addEventListener("click", ()=>{
    requireUnlock();
    $("#pinInput").value = "";
    showToast(lang==="ar" ? "ØªÙ… Ø§Ù„Ù‚ÙÙ„ ğŸ”’" : "Locked ğŸ”’");
  });

  $("#changePinBtn").addEventListener("click", ()=>{
    const current = prompt(lang==="ar" ? "Ø§ÙƒØªØ¨ Ø§Ù„Ù€ PIN Ø§Ù„Ø­Ø§Ù„ÙŠ:" : "Enter current PIN:");
    if(current === null) return;
    if(current.trim() !== getPin()){
      showToast(lang==="ar" ? "PIN Ø§Ù„Ø­Ø§Ù„ÙŠ ØºÙ„Ø·" : "Wrong current PIN");
      return;
    }
    const next = prompt(lang==="ar" ? "Ø§ÙƒØªØ¨ PIN Ø¬Ø¯ÙŠØ¯ (4-10 Ø£Ø±Ù‚Ø§Ù…):" : "Enter new PIN (4-10 digits):");
    if(!next) return;
    const cleaned = next.trim();
    if(cleaned.length < 4 || cleaned.length > 10 || !/^\d+$/.test(cleaned)){
      showToast(lang==="ar" ? "PIN ØºÙŠØ± ØµØ§Ù„Ø­" : "Invalid PIN");
      return;
    }
    setPin(cleaned);
    showToast(lang==="ar" ? "ØªÙ… ØªØºÙŠÙŠØ± PIN âœ…" : "PIN changed âœ…");
  });

  $("#saveSettingsBtn").addEventListener("click", saveSettings);
  $("#saveItemBtn").addEventListener("click", saveItem);
  $("#clearFormBtn").addEventListener("click", clearItemForm);

  $("#exportBtn").addEventListener("click", exportJSON);
  $("#importBtn").addEventListener("click", ()=> $("#importFile").click());
  $("#importFile").addEventListener("change", (e)=>{
    const f = e.target.files?.[0];
    if(f) importJSON(f);
    e.target.value = "";
  });

  $("#resetAllBtn").addEventListener("click", resetAll);

  $("#adminSearch").addEventListener("input", renderAdminTable);
  $("#adminCatFilter").addEventListener("change", renderAdminTable);

  // ---------- Initial render ----------
  applyTheme();
  applyLang();
  renderCats();
  renderMeta();
  renderGrid();
  drawQR();

  // Fill admin selects now (so form is ready)
  fillSettingsForm();
  fillCategorySelects();

  // Start page based on hash
  if(location.hash.includes("admin")){
    showPage("admin");
    requireUnlock();
    renderAdminTable();
  } else {
    showPage("menu");
  }

})();
</script>
</body>
</html>
