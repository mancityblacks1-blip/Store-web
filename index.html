<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>LocalStore + Admin (Single File, Hash Router)</title>

    <!-- Tailwind (demo) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 (jsDelivr) -->
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>

    <style>
      body {
        background: radial-gradient(1200px 700px at 70% 0%, rgba(99, 102, 241, 0.25), transparent 60%),
          radial-gradient(900px 600px at 20% 10%, rgba(16, 185, 129, 0.18), transparent 55%),
          #070a14;
      }
      .glass {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(10px);
      }
      .ring-soft {
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.08) inset;
      }
      .shadow-soft {
        box-shadow: 0 20px 80px rgba(0, 0, 0, 0.35);
      }
      .scrollbar-thin::-webkit-scrollbar { height: 8px; width: 8px; }
      .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.12); border-radius: 999px; }
      .scrollbar-thin::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.06); border-radius: 999px; }

      @keyframes popIn {
        from { opacity: 0; transform: translateY(10px) scale(0.98); }
        to { opacity: 1; transform: translateY(0) scale(1); }
      }
      .anim-pop { animation: popIn 220ms ease-out both; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
      .anim-fade { animation: fadeIn 180ms ease-out both; }
    </style>
  </head>

  <body class="text-slate-100">
    <div id="root"></div>

    <script>
      // ===== Safety: error overlay (helps debug if anything happens) =====
      (function () {
        const box = document.createElement("pre");
        box.style.cssText =
          "position:fixed;inset:auto 12px 12px 12px;max-height:45vh;overflow:auto;" +
          "background:rgba(0,0,0,.85);color:#fff;padding:12px;border-radius:12px;" +
          "font:12px/1.4 system-ui;z-index:999999;white-space:pre-wrap;display:none";
        document.addEventListener("DOMContentLoaded", () => document.body.appendChild(box));
        function show(msg) { box.style.display = "block"; box.textContent = msg + "\n\n" + (box.textContent || ""); }
        window.addEventListener("error", (e) => show("JS ERROR: " + (e.message || e.error) + "\n" + (e.filename || "") + ":" + (e.lineno || "")));
        window.addEventListener("unhandledrejection", (e) => show("PROMISE REJECTION: " + (e.reason?.message || e.reason)));
      })();

      const React = window.React;
      const ReactDOM = window.ReactDOM;

      if (!React || !ReactDOM) {
        document.body.innerHTML =
          '<div style="color:white;font-family:system-ui;padding:24px">React CDN load failed. Open Console.</div>';
      }

      const { useEffect, useMemo, useState, useContext, createContext } = React;

      /* =========================
         Mini Hash Router (single-file friendly)
         - supports params: /product/:id
         - supports simple exact matches
      ========================= */
      const RouterCtx = createContext(null);

      const getHashPath = () => {
        const h = (location.hash || "#/").slice(1);
        return h.startsWith("/") ? h : "/" + h;
      };

      function matchPath(pattern, path) {
        // pattern like "/product/:id" or "/admin/products"
        const pSeg = (pattern || "").split("/").filter(Boolean);
        const aSeg = (path || "").split("/").filter(Boolean);
        if (pSeg.length !== aSeg.length) return null;
        const params = {};
        for (let i = 0; i < pSeg.length; i++) {
          const p = pSeg[i], a = aSeg[i];
          if (p.startsWith(":")) params[p.slice(1)] = decodeURIComponent(a);
          else if (p !== a) return null;
        }
        return params;
      }

      function HashRouter({ children }) {
        const [path, setPath] = useState(getHashPath());

        useEffect(() => {
          const onHash = () => setPath(getHashPath());
          window.addEventListener("hashchange", onHash);
          return () => window.removeEventListener("hashchange", onHash);
        }, []);

        const navigate = (to) => {
          const target = String(to || "/");
          location.hash = "#" + (target.startsWith("/") ? target : "/" + target);
        };

        const value = useMemo(() => ({ path, navigate }), [path]);
        return React.createElement(RouterCtx.Provider, { value }, children);
      }

      function useNavigate() {
        const ctx = useContext(RouterCtx);
        return ctx.navigate;
      }
      function useLocation() {
        const ctx = useContext(RouterCtx);
        return { pathname: ctx.path };
      }

      function Link({ to, className, children }) {
        return React.createElement(
          "a",
          {
            href: "#" + (String(to || "/").startsWith("/") ? String(to || "/") : "/" + String(to || "/")),
            className
          },
          children
        );
      }

      function NavLink({ to, end, className, children }) {
        const { pathname } = useLocation();
        const target = String(to || "/");
        const active = end ? pathname === target : pathname === target || pathname.startsWith(target + "/");
        const cls = typeof className === "function" ? className({ isActive: active }) : className;
        return React.createElement(Link, { to: target, className: cls }, children);
      }

      function Navigate({ to, replace }) {
        const nav = useNavigate();
        useEffect(() => { nav(to); }, [to]);
        return null;
      }

      function Routes({ children }) {
        const ctx = useContext(RouterCtx);
        const path = ctx.path;

        const arr = React.Children.toArray(children).filter(Boolean);

        for (const el of arr) {
          if (!el?.props) continue;

          // index route support: <Route index element={...} />
          if (el.props.index) {
            if (path === "/") return React.createElement(RouteCtx.Provider, { value: { params: {} } }, el.props.element);
            continue;
          }

          const params = matchPath(el.props.path, path);
          if (params) {
            return React.createElement(RouteCtx.Provider, { value: { params } }, el.props.element);
          }
        }
        return null;
      }

      function Route(_) { return null; } // for readability only

      const RouteCtx = createContext({ params: {} });
      function useParams() {
        return useContext(RouteCtx).params || {};
      }

      /* =========================
         Helpers + Data
      ========================= */
      const cn = (...xs) => xs.filter(Boolean).join(" ");
      const egp = (n) => new Intl.NumberFormat("ar-EG", { style: "currency", currency: "EGP", maximumFractionDigits: 0 }).format(n || 0);
      const uid = () => Math.random().toString(16).slice(2) + Date.now().toString(16);
      const clamp = (n, min, max) => Math.max(min, Math.min(max, n));

      const LS_KEYS = {
        products: "ls_products_v5",
        cart: "ls_cart_v5",
        orders: "ls_orders_v5",
        admin: "ls_admin_v5"
      };

      const CATEGORIES = ["All", "Electronics", "Fashion", "Home", "Beauty", "Sports"];
      const PRODUCT_CATS = ["Electronics", "Fashion", "Home", "Beauty", "Sports"];

      const seedProducts = [
        { id:"p1", name:"Nova Wireless Headphones", price:2899, category:"Electronics",
          image:"https://images.unsplash.com/photo-1518441902117-f0a0a5b0b3e2?auto=format&fit=crop&w=900&q=80",
          description:"ØµÙˆØª Ù†Ø¶ÙŠÙØŒ Bass Ù…Ø­ØªØ±Ù…ØŒ ÙˆØ±Ø§Ø­Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ¯Ù† Ù„Ø³Ø§Ø¹Ø§Øª." },
        { id:"p2", name:"Aero Smart Watch", price:2199, category:"Electronics",
          image:"https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format&fit=crop&w=900&q=80",
          description:"Ù…ØªØ§Ø¨Ø¹Ø© Ù†Ø´Ø§Ø·ÙƒØŒ Ù†ÙˆÙ…ÙƒØŒ ÙˆÙ†Ø¨Ø¶Ùƒâ€¦ Ø¹Ù„Ù‰ Ù…Ø¹ØµÙ…Ùƒ." },
        { id:"p3", name:"Urban Hoodie", price:799, category:"Fashion",
          image:"https://images.unsplash.com/photo-1520975682031-a05dfb6b4b9d?auto=format&fit=crop&w=900&q=80",
          description:"Ù‡ÙˆØ¯ÙŠ Ù…Ø±ÙŠØ­ ÙˆØ´ÙŠÙƒØŒ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø´ØªØ§ ÙˆØ§Ù„Ø®Ø±ÙˆØ¬." },
        { id:"p4", name:"Minimal Sneakers", price:1299, category:"Fashion",
          image:"https://images.unsplash.com/photo-1528701800489-20be9c3ea2b4?auto=format&fit=crop&w=900&q=80",
          description:"Ø³Ù†ÙŠÙƒØ±Ø² Ø¹Ù…Ù„ÙŠ ÙˆÙ…Ù†Ø§Ø³Ø¨ Ù„Ù„ÙŠÙˆÙ… ÙƒÙ„Ù‡." },
        { id:"p5", name:"Cozy Throw Blanket", price:499, category:"Home",
          image:"https://images.unsplash.com/photo-1519710164239-da123dc03ef4?auto=format&fit=crop&w=900&q=80",
          description:"Ø¨Ø·Ø§Ù†ÙŠØ© Ù†Ø§Ø¹Ù…Ø©â€¦ Ù„Ù„ÙƒÙ†Ø¨Ø© ÙˆØ§Ù„Ù…Ø²Ø§Ø¬." },
        { id:"p6", name:"Aroma Diffuser", price:650, category:"Home",
          image:"https://images.unsplash.com/photo-1611078489935-0cb964de46c9?auto=format&fit=crop&w=900&q=80",
          description:"Ø±ÙŠØ­Ø© Ù‡Ø§Ø¯ÙŠØ© ÙˆØ¥Ø¶Ø§Ø¡Ø© Ù„Ø·ÙŠÙØ© Ù„Ù„ØºØ±ÙØ©." },
        { id:"p7", name:"Skincare Starter Kit", price:950, category:"Beauty",
          image:"https://images.unsplash.com/photo-1556228578-0d85b1a4d571?auto=format&fit=crop&w=900&q=80",
          description:"Ø±ÙˆØªÙŠÙ† Ø¨Ø³ÙŠØ· Ù„Ø¨Ø´Ø±Ø© Ø£Ù†Ø¶Ù." },
        { id:"p8", name:"Matte Lipstick", price:320, category:"Beauty",
          image:"https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?auto=format&fit=crop&w=900&q=80",
          description:"Ø«Ø¨Ø§Øª ÙƒÙˆÙŠØ³ ÙˆÙ„Ù…Ø³Ø© Ù…Ø·ÙÙŠØ© Ø´ÙŠÙƒ." },
        { id:"p9", name:"Training Bottle 1L", price:240, category:"Sports",
          image:"https://images.unsplash.com/photo-1542315192-1f61a1799a03?auto=format&fit=crop&w=900&q=80",
          description:"Ø§Ø´Ø±Ø¨ Ù…ÙŠØ© ÙƒØªÙŠØ±â€¦ Ø¬Ø³Ù…Ùƒ Ù‡ÙŠØ´ÙƒØ±Ù‘Ùƒ." },
        { id:"p10", name:"Resistance Bands Set", price:410, category:"Sports",
          image:"https://images.unsplash.com/photo-1599058917212-d750089bc07b?auto=format&fit=crop&w=900&q=80",
          description:"ØªÙ…Ø§Ø±ÙŠÙ† ÙÙŠ Ø§Ù„Ø¨ÙŠØª Ø¨Ù…Ø±ÙˆÙ†Ø© ÙˆÙ…Ù‚Ø§ÙˆÙ…Ø©." }
      ];

      const LS = {
        get(key, fallback) {
          try {
            const raw = localStorage.getItem(key);
            if (!raw) return fallback;
            return JSON.parse(raw);
          } catch { return fallback; }
        },
        set(key, value) { localStorage.setItem(key, JSON.stringify(value)); }
      };

      /* =========================
         Toast
      ========================= */
      function useToast() {
        const [items, setItems] = useState([]);
        const push = (type, message) => {
          const id = uid();
          setItems((x) => [{ id, type, message }, ...x].slice(0, 4));
          setTimeout(() => setItems((x) => x.filter((t) => t.id !== id)), 2600);
        };
        return { items, push };
      }
      function Toasts({ items }) {
        return React.createElement(
          "div",
          { className: "fixed top-4 left-4 z-[9999] space-y-2 w-[min(380px,calc(100vw-2rem))]" },
          items.map((t) =>
            React.createElement(
              "div",
              { key: t.id, className: "glass ring-soft shadow-soft rounded-2xl px-4 py-3 text-sm flex items-start gap-3 anim-pop" },
              React.createElement("div", {
                className:
                  "mt-0.5 h-2.5 w-2.5 rounded-full " +
                  (t.type === "success" ? "bg-emerald-400" : t.type === "error" ? "bg-rose-400" : "bg-indigo-400")
              }),
              React.createElement("div", null, t.message)
            )
          )
        );
      }

      /* =========================
         Store (LocalStorage)
      ========================= */
      function useAppStore() {
        const [products, setProducts] = useState(() => {
          const existing = LS.get(LS_KEYS.products, null);
          if (existing && Array.isArray(existing) && existing.length) return existing;
          LS.set(LS_KEYS.products, seedProducts);
          return seedProducts;
        });
        const [cart, setCart] = useState(() => LS.get(LS_KEYS.cart, []));
        const [orders, setOrders] = useState(() => LS.get(LS_KEYS.orders, []));
        const [admin, setAdmin] = useState(() => LS.get(LS_KEYS.admin, { authed: false }));

        useEffect(() => LS.set(LS_KEYS.products, products), [products]);
        useEffect(() => LS.set(LS_KEYS.cart, cart), [cart]);
        useEffect(() => LS.set(LS_KEYS.orders, orders), [orders]);
        useEffect(() => LS.set(LS_KEYS.admin, admin), [admin]);

        const cartCount = useMemo(() => cart.reduce((s, i) => s + (i.qty || 0), 0), [cart]);
        const cartTotal = useMemo(() => cart.reduce((s, i) => s + (i.qty || 0) * (i.price || 0), 0), [cart]);

        const addToCart = (p) => {
          setCart((prev) => {
            const hit = prev.find((x) => x.id === p.id);
            if (hit) return prev.map((x) => (x.id === p.id ? { ...x, qty: x.qty + 1 } : x));
            return [...prev, { id: p.id, name: p.name, price: p.price, image: p.image, category: p.category, qty: 1 }];
          });
        };
        const updateQty = (id, qty) => setCart((prev) => prev.map((x) => (x.id === id ? { ...x, qty: clamp(qty, 1, 99) } : x)));
        const removeFromCart = (id) => setCart((prev) => prev.filter((x) => x.id !== id));
        const clearCart = () => setCart([]);

        const createOrder = ({ customer }) => {
          const orderId = "ORD-" + Math.random().toString(10).slice(2, 8);
          const order = { id: orderId, createdAt: new Date().toISOString(), status: "new", customer, items: cart, total: cartTotal };
          setOrders((prev) => [order, ...prev]);
          clearCart();
          return orderId;
        };

        const adminLogin = (password) => {
          if (password === "admin123") { setAdmin({ authed: true }); return true; }
          return false;
        };
        const adminLogout = () => setAdmin({ authed: false });

        const productsCRUD = {
          add(p) { setProducts((prev) => [{ ...p, id: uid() }, ...prev]); },
          update(id, patch) { setProducts((prev) => prev.map((x) => (x.id === id ? { ...x, ...patch } : x))); },
          remove(id) {
            setProducts((prev) => prev.filter((x) => x.id !== id));
            setCart((prev) => prev.filter((x) => x.id !== id));
          }
        };
        const ordersCRUD = {
          setStatus(id, status) { setOrders((prev) => prev.map((o) => (o.id === id ? { ...o, status } : o))); }
        };

        return { products, cart, orders, admin, cartCount, cartTotal, addToCart, updateQty, removeFromCart, clearCart, createOrder, adminLogin, adminLogout, productsCRUD, ordersCRUD };
      }

      /* =========================
         UI components
      ========================= */
      function Card({ className, children }) {
        return React.createElement("div", { className: cn("glass ring-soft rounded-3xl shadow-soft", className) }, children);
      }
      function Button({ className, variant = "primary", ...props }) {
        const base =
          "inline-flex items-center justify-center gap-2 rounded-2xl px-4 py-2 text-sm font-semibold transition active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed";
        const styles =
          variant === "primary" ? "bg-indigo-500/90 hover:bg-indigo-500 text-white"
          : variant === "ghost" ? "bg-white/5 hover:bg-white/10 text-white"
          : variant === "danger" ? "bg-rose-500/90 hover:bg-rose-500 text-white"
          : "bg-emerald-500/90 hover:bg-emerald-500 text-white";
        return React.createElement("button", { className: cn(base, styles, className), ...props });
      }
      function Input({ className, ...props }) {
        return React.createElement("input", {
          className: cn("w-full rounded-2xl bg-white/5 ring-soft px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500/60", className),
          ...props
        });
      }
      function Select({ className, children, ...props }) {
        return React.createElement(
          "select",
          { className: cn("w-full rounded-2xl bg-white/5 ring-soft px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500/60", className), ...props },
          children
        );
      }
      function Badge({ tone = "slate", children }) {
        const map = {
          indigo: "bg-indigo-500/15 text-indigo-200 ring-1 ring-indigo-500/20",
          emerald: "bg-emerald-500/15 text-emerald-200 ring-1 ring-emerald-500/20",
          amber: "bg-amber-500/15 text-amber-200 ring-1 ring-amber-500/20",
          rose: "bg-rose-500/15 text-rose-200 ring-1 ring-rose-500/20",
          slate: "bg-white/8 text-slate-200 ring-1 ring-white/10"
        };
        return React.createElement("span", { className: cn("inline-flex items-center rounded-full px-2.5 py-1 text-xs font-semibold", map[tone] || map.slate) }, children);
      }
      function Shell({ children }) {
        return React.createElement("div", { className: "min-h-screen" }, React.createElement("div", { className: "max-w-6xl mx-auto px-4 py-6" }, children));
      }
      function PageTitle({ title, subtitle, right }) {
        return React.createElement(
          "div",
          { className: "flex flex-col gap-3 sm:flex-row sm:items-end sm:justify-between" },
          React.createElement("div", null,
            React.createElement("div", { className: "text-2xl font-black tracking-tight" }, title),
            subtitle ? React.createElement("div", { className: "mt-1 text-sm text-slate-300" }, subtitle) : null
          ),
          right ? React.createElement("div", null, right) : null
        );
      }
      function Empty({ title, hint, action }) {
        return React.createElement(
          Card,
          { className: "p-8 text-center anim-pop" },
          React.createElement("div", { className: "text-xl font-extrabold" }, title || "Ù…ÙÙŠØ´ Ø¨ÙŠØ§Ù†Ø§Øª"),
          React.createElement("div", { className: "mt-2 text-sm text-slate-300" }, hint || "Ø¬Ø±Ù‘Ø¨ ØªØ§Ù†ÙŠ âœ¨"),
          action ? React.createElement("div", { className: "mt-5" }, action) : null
        );
      }
      function LoadingSkeleton() {
        return React.createElement(
          "div",
          { className: "grid gap-4 sm:grid-cols-2 lg:grid-cols-3" },
          Array.from({ length: 6 }).map((_, i) =>
            React.createElement(
              Card,
              { key: i, className: "p-4 anim-pop" },
              React.createElement("div", { className: "h-40 rounded-2xl bg-white/5 animate-pulse" }),
              React.createElement("div", { className: "mt-4 h-4 w-3/4 rounded bg-white/5 animate-pulse" }),
              React.createElement("div", { className: "mt-2 h-4 w-1/2 rounded bg-white/5 animate-pulse" }),
              React.createElement("div", { className: "mt-4 h-9 rounded-2xl bg-white/5 animate-pulse" })
            )
          )
        );
      }

      function StoreHeader({ cartCount }) {
        return React.createElement(
          Card,
          { className: "p-4 mb-6 anim-pop" },
          React.createElement(
            "div",
            { className: "flex items-center justify-between gap-3 flex-wrap" },
            React.createElement(
              Link,
              { to: "/", className: "flex items-center gap-3" },
              React.createElement("div", { className: "h-10 w-10 rounded-2xl bg-indigo-500/20 ring-1 ring-indigo-500/25 grid place-items-center font-black" }, "LS"),
              React.createElement("div", null,
                React.createElement("div", { className: "font-extrabold" }, "LocalStore"),
                React.createElement("div", { className: "text-xs text-slate-300" }, "Single-file Hash Router")
              )
            ),
            React.createElement("div", { className: "flex items-center gap-2" },
              React.createElement(NavLink, { to: "/", end: true, className: ({ isActive }) => cn("px-3 py-2 rounded-2xl text-sm font-semibold", isActive ? "bg-white/10" : "hover:bg-white/5") }, "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª"),
              React.createElement(NavLink, { to: "/cart", className: ({ isActive }) => cn("px-3 py-2 rounded-2xl text-sm font-semibold flex items-center gap-2", isActive ? "bg-white/10" : "hover:bg-white/5") },
                React.createElement("span", null, "Ø§Ù„Ø³Ù„Ø©"),
                React.createElement(Badge, { tone: "slate" }, cartCount)
              ),
              React.createElement(NavLink, { to: "/admin/login", className: ({ isActive }) => cn("px-3 py-2 rounded-2xl text-sm font-semibold", isActive ? "bg-white/10" : "hover:bg-white/5") }, "Admin")
            )
          )
        );
      }

      function Modal({ open, onClose, title, children }) {
        if (!open) return null;
        return React.createElement(
          "div",
          { className: "fixed inset-0 z-[999] grid place-items-center p-4 anim-fade" },
          React.createElement("div", { className: "absolute inset-0 bg-black/60", onClick: onClose }),
          React.createElement("div", { className: "relative w-full max-w-2xl anim-pop" },
            React.createElement(Card, { className: "p-5" },
              React.createElement("div", { className: "flex items-center justify-between" },
                React.createElement("div", { className: "font-black text-lg" }, title || "Modal"),
                React.createElement("button", { className: "px-3 py-2 rounded-2xl bg-white/5 hover:bg-white/10 text-sm", onClick: onClose }, "âœ•")
              ),
              React.createElement("div", { className: "mt-4" }, children)
            )
          )
        );
      }

      /* =========================
         Pages
      ========================= */
      function Storefront({ store, toast }) {
        const [q, setQ] = useState("");
        const [cat, setCat] = useState("All");
        const [sort, setSort] = useState("none");
        const [loading, setLoading] = useState(true);

        useEffect(() => { const t = setTimeout(() => setLoading(false), 260); return () => clearTimeout(t); }, []);

        const filtered = useMemo(() => {
          let list = store.products.slice();
          if (q.trim()) {
            const s = q.trim().toLowerCase();
            list = list.filter((p) => p.name.toLowerCase().includes(s));
          }
          if (cat !== "All") list = list.filter((p) => p.category === cat);
          if (sort === "price_asc") list.sort((a, b) => a.price - b.price);
          if (sort === "price_desc") list.sort((a, b) => b.price - a.price);
          return list;
        }, [store.products, q, cat, sort]);

        const add = (p) => { store.addToCart(p); toast.push("success", `Ø§ØªØ¶Ø§Ù Ù„Ù„Ø³Ù„Ø©: ${p.name}`); };

        return React.createElement(
          React.Fragment,
          null,
          React.createElement(StoreHeader, { cartCount: store.cartCount }),
          React.createElement(PageTitle, {
            title: "Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª",
            subtitle: "Search + Filter + Sort. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ LocalStorage.",
            right: React.createElement("div", { className: "grid grid-cols-1 sm:grid-cols-3 gap-2 w-full sm:w-[560px]" },
              React.createElement(Input, { value: q, onChange: (e) => setQ(e.target.value), placeholder: "Search Ø¨Ø§Ù„Ø§Ø³Ù…â€¦" }),
              React.createElement(Select, { value: cat, onChange: (e) => setCat(e.target.value) }, CATEGORIES.map((c) => React.createElement("option", { key: c, value: c }, c))),
              React.createElement(Select, { value: sort, onChange: (e) => setSort(e.target.value) },
                React.createElement("option", { value: "none" }, "Sort: Ø¨Ø¯ÙˆÙ†"),
                React.createElement("option", { value: "price_asc" }, "Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰"),
                React.createElement("option", { value: "price_desc" }, "Ø§Ù„Ø³Ø¹Ø±: Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„")
              )
            )
          }),
          React.createElement("div", { className: "mt-4" },
            loading
              ? React.createElement(LoadingSkeleton)
              : filtered.length === 0
              ? React.createElement(Empty, { title: "Ù…ÙÙŠØ´ Ù†ØªØ§Ø¦Ø¬", hint: "Ø¬Ø±Ù‘Ø¨ ØªØºÙŠÙ‘Ø± Ø§Ù„Ø¨Ø­Ø« Ø£Ùˆ Ø§Ù„ÙÙ„ØªØ±." })
              : React.createElement("div", { className: "grid gap-4 sm:grid-cols-2 lg:grid-cols-3" },
                  filtered.map((p) =>
                    React.createElement("div", { key: p.id, className: "anim-pop" },
                      React.createElement(Card, { className: "overflow-hidden" },
                        React.createElement(Link, { to: `/product/${p.id}`, className: "block" },
                          React.createElement("img", { src: p.image, alt: p.name, className: "h-44 w-full object-cover" })
                        ),
                        React.createElement("div", { className: "p-4" },
                          React.createElement("div", { className: "flex items-start justify-between gap-3" },
                            React.createElement("div", null,
                              React.createElement(Link, { to: `/product/${p.id}`, className: "font-extrabold hover:underline" }, p.name),
                              React.createElement("div", { className: "mt-1 text-sm text-slate-300" }, egp(p.price))
                            ),
                            React.createElement(Badge, { tone: "indigo" }, p.category)
                          ),
                          React.createElement("div", { className: "mt-3 flex gap-2" },
                            React.createElement(Button, { className: "flex-1", onClick: () => add(p) }, "Add to Cart"),
                            React.createElement(Button, { variant: "ghost", onClick: () => toast.push("info", "Demo UI âœ¨") }, "â™¡")
                          )
                        )
                      )
                    )
                  )
                )
          )
        );
      }

      function ProductDetails({ store, toast }) {
        const { id } = useParams();
        const nav = useNavigate();
        const p = store.products.find((x) => x.id === id);

        if (!p) {
          return React.createElement(React.Fragment, null,
            React.createElement(StoreHeader, { cartCount: store.cartCount }),
            React.createElement(Empty, { title: "Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", hint: "Ù…Ù…ÙƒÙ† Ø§ØªÙ…Ø³Ø­ Ù…Ù† Ø§Ù„Ø£Ø¯Ù…Ù†.", action: React.createElement(Button, { onClick: () => nav("/") }, "Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±") })
          );
        }

        return React.createElement(React.Fragment, null,
          React.createElement(StoreHeader, { cartCount: store.cartCount }),
          React.createElement(Card, { className: "overflow-hidden anim-pop" },
            React.createElement("div", { className: "grid lg:grid-cols-2" },
              React.createElement("img", { src: p.image, alt: p.name, className: "h-64 lg:h-full w-full object-cover" }),
              React.createElement("div", { className: "p-6" },
                React.createElement("div", { className: "flex items-center justify-between gap-3" },
                  React.createElement("div", null,
                    React.createElement("div", { className: "text-2xl font-black" }, p.name),
                    React.createElement("div", { className: "mt-2 text-slate-300" }, egp(p.price))
                  ),
                  React.createElement(Badge, { tone: "indigo" }, p.category)
                ),
                React.createElement("p", { className: "mt-4 text-sm text-slate-300 leading-6" }, p.description || "ÙˆØµÙ Ù…Ø´ Ù…ØªÙˆÙØ±."),
                React.createElement("div", { className: "mt-6 flex gap-2" },
                  React.createElement(Button, { className: "flex-1", onClick: () => { store.addToCart(p); toast.push("success", "Ø§ØªØ¶Ø§Ù Ù„Ù„Ø³Ù„Ø© âœ…"); } }, "Add to Cart"),
                  React.createElement(Button, { variant: "ghost", onClick: () => nav("/") }, "Ø±Ø¬ÙˆØ¹")
                )
              )
            )
          )
        );
      }

      function CartPage({ store, toast }) {
        const nav = useNavigate();
        const items = store.cart;

        return React.createElement(React.Fragment, null,
          React.createElement(StoreHeader, { cartCount: store.cartCount }),
          React.createElement(PageTitle, { title: "Ø§Ù„Ø³Ù„Ø©", subtitle: "Ø¹Ø¯Ù‘Ù„ Ø§Ù„ÙƒÙ…ÙŠØ§Øª ÙˆØ§Ø­Ø°Ù. Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¨ÙŠØªØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠ." }),
          React.createElement("div", { className: "mt-4 grid gap-4 lg:grid-cols-3" },
            React.createElement("div", { className: "lg:col-span-2 space-y-3" },
              items.length === 0
                ? React.createElement(Empty, { title: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©", hint: "Ø±ÙˆØ­ Ø§Ø®ØªØ§Ø± Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±.", action: React.createElement(Button, { onClick: () => nav("/") }, "ÙØªØ­ Ø§Ù„Ù…ØªØ¬Ø±") })
                : items.map((it) =>
                    React.createElement(Card, { key: it.id, className: "p-4 anim-pop" },
                      React.createElement("div", { className: "flex gap-3 items-center" },
                        React.createElement("img", { src: it.image, alt: it.name, className: "h-16 w-16 rounded-2xl object-cover ring-soft" }),
                        React.createElement("div", { className: "flex-1 min-w-0" },
                          React.createElement("div", { className: "font-extrabold truncate" }, it.name),
                          React.createElement("div", { className: "text-sm text-slate-300 flex items-center gap-2 mt-1" },
                            React.createElement("span", null, egp(it.price)),
                            React.createElement(Badge, { tone: "slate" }, it.category)
                          )
                        ),
                        React.createElement("div", { className: "flex items-center gap-2" },
                          React.createElement(Input, { type: "number", min: 1, max: 99, value: it.qty, onChange: (e) => store.updateQty(it.id, Number(e.target.value || 1)), className: "w-20 text-center" }),
                          React.createElement(Button, { variant: "danger", onClick: () => { store.removeFromCart(it.id); toast.push("success", "Ø§ØªÙ…Ø³Ø­ Ù…Ù† Ø§Ù„Ø³Ù„Ø©"); } }, "Ø­Ø°Ù")
                        )
                      )
                    )
                  )
            ),
            React.createElement(Card, { className: "p-5 h-fit anim-pop" },
              React.createElement("div", { className: "text-lg font-black" }, "Ù…Ù„Ø®Øµ Ø§Ù„Ø·Ù„Ø¨"),
              React.createElement("div", { className: "mt-4 space-y-2 text-sm text-slate-300" },
                React.createElement("div", { className: "flex justify-between" }, React.createElement("span", null, "Ø¹Ø¯Ø¯ Ø§Ù„Ù‚Ø·Ø¹"), React.createElement("span", null, store.cartCount)),
                React.createElement("div", { className: "flex justify-between" }, React.createElement("span", null, "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"), React.createElement("span", { className: "font-extrabold text-slate-100" }, egp(store.cartTotal)))
              ),
              React.createElement("div", { className: "mt-5 space-y-2" },
                React.createElement(Button, { className: "w-full", disabled: items.length === 0, onClick: () => nav("/checkout") }, "Checkout"),
                React.createElement(Button, { className: "w-full", variant: "ghost", disabled: items.length === 0, onClick: () => { store.clearCart(); toast.push("success", "Ø§Ù„Ø³Ù„Ø© Ø§ØªØµÙØ±Øª"); } }, "ØªØµÙÙŠØ± Ø§Ù„Ø³Ù„Ø©")
              )
            )
          )
        );
      }

      function CheckoutPage({ store, toast }) {
        const nav = useNavigate();
        const [name, setName] = useState("");
        const [mobile, setMobile] = useState("");
        const [address, setAddress] = useState("");
        const [placing, setPlacing] = useState(false);
        const [orderId, setOrderId] = useState(null);

        if (store.cart.length === 0 && !orderId) {
          return React.createElement(React.Fragment, null,
            React.createElement(StoreHeader, { cartCount: store.cartCount }),
            React.createElement(Empty, { title: "Ù…ÙÙŠØ´ Ø­Ø§Ø¬Ø© ØªØªØ¹Ù…Ù„ Checkout", hint: "Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©.", action: React.createElement(Button, { onClick: () => nav("/") }, "Ø±ÙˆØ­ Ù„Ù„Ù…ØªØ¬Ø±") })
          );
        }

        const submit = async (e) => {
          e.preventDefault();
          if (!name.trim() || !mobile.trim() || !address.trim()) return toast.push("error", "Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ø§ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„Ù‡Ø§");
          setPlacing(true);
          await new Promise((r) => setTimeout(r, 450));
          const id = store.createOrder({ customer: { name: name.trim(), mobile: mobile.trim(), address: address.trim() } });
          setOrderId(id);
          setPlacing(false);
          toast.push("success", "ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨ âœ…");
        };

        return React.createElement(React.Fragment, null,
          React.createElement(StoreHeader, { cartCount: store.cartCount }),
          React.createElement(PageTitle, { title: "Checkout Demo", subtitle: "Ø¹Ù†Ø¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯: Order ÙŠØªØ³Ø¬Ù„ + Ø§Ù„Ø³Ù„Ø© ØªØªØµÙØ±." }),
          React.createElement("div", { className: "mt-4 grid gap-4 lg:grid-cols-2" },
            React.createElement(Card, { className: "p-6 anim-pop" },
              orderId
                ? React.createElement("div", { className: "text-center" },
                    React.createElement("div", { className: "text-2xl font-black" }, "ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ ðŸŽ‰"),
                    React.createElement("div", { className: "mt-2 text-slate-300" }, "Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨:"),
                    React.createElement("div", { className: "mt-3 text-xl font-extrabold tracking-wide" }, orderId),
                    React.createElement("div", { className: "mt-5 flex gap-2 justify-center" },
                      React.createElement(Button, { onClick: () => nav("/") }, "Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±"),
                      React.createElement(Button, { variant: "ghost", onClick: () => nav("/admin") }, "Ø±ÙˆØ­ Ù„Ù„Ø£Ø¯Ù…Ù†")
                    )
                  )
                : React.createElement("form", { onSubmit: submit, className: "space-y-3" },
                    React.createElement("div", null, React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Ø§Ù„Ø§Ø³Ù…"), React.createElement(Input, { value: name, onChange: (e) => setName(e.target.value) })),
                    React.createElement("div", null, React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„"), React.createElement(Input, { value: mobile, onChange: (e) => setMobile(e.target.value) })),
                    React.createElement("div", null, React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Ø§Ù„Ø¹Ù†ÙˆØ§Ù†"), React.createElement(Input, { value: address, onChange: (e) => setAddress(e.target.value) })),
                    React.createElement(Button, { className: "w-full", type: "submit", disabled: placing }, placing ? "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ£ÙƒÙŠØ¯â€¦" : "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨")
                  )
            ),
            React.createElement(Card, { className: "p-6 h-fit anim-pop" },
              React.createElement("div", { className: "text-lg font-black" }, "Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨"),
              React.createElement("div", { className: "mt-4 space-y-2 max-h-[340px] overflow-auto scrollbar-thin pr-1" },
                store.cart.map((it) =>
                  React.createElement("div", { key: it.id, className: "flex items-center justify-between gap-3 text-sm" },
                    React.createElement("div", { className: "min-w-0" },
                      React.createElement("div", { className: "font-semibold truncate" }, it.name),
                      React.createElement("div", { className: "text-slate-300" }, `${it.qty} Ã— ${egp(it.price)}`)
                    ),
                    React.createElement("div", { className: "font-extrabold" }, egp(it.qty * it.price))
                  )
                )
              ),
              React.createElement("div", { className: "mt-4 pt-4 border-t border-white/10 flex justify-between" },
                React.createElement("span", { className: "text-slate-300 text-sm" }, "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ"),
                React.createElement("span", { className: "font-extrabold" }, egp(store.cartTotal))
              )
            )
          )
        );
      }

      /* =========================
         Admin
      ========================= */
      function RequireAdmin({ store, children }) {
        if (!store.admin.authed) return React.createElement(Navigate, { to: "/admin/login", replace: true });
        return children;
      }

      function AdminLogin({ store, toast }) {
        const nav = useNavigate();
        const [pw, setPw] = useState("");
        const [loading, setLoading] = useState(false);

        const submit = async (e) => {
          e.preventDefault();
          setLoading(true);
          await new Promise((r) => setTimeout(r, 280));
          const ok = store.adminLogin(pw);
          setLoading(false);
          if (!ok) return toast.push("error", "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø· âŒ");
          toast.push("success", "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
          nav("/admin");
        };

        return React.createElement(Shell, null,
          React.createElement(Card, { className: "p-6 max-w-xl mx-auto anim-pop" },
            React.createElement("div", { className: "text-2xl font-black" }, "Admin Login"),
            React.createElement("div", { className: "mt-1 text-sm text-slate-300" }, "Password Ø«Ø§Ø¨Øª: admin123"),
            React.createElement("form", { onSubmit: submit, className: "mt-6 space-y-3" },
              React.createElement("div", null,
                React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Password"),
                React.createElement(Input, { type: "password", value: pw, onChange: (e) => setPw(e.target.value), placeholder: "admin123" })
              ),
              React.createElement(Button, { className: "w-full", type: "submit", disabled: loading }, loading ? "Ø¬Ø§Ø±Ù Ø§Ù„Ø¯Ø®ÙˆÙ„â€¦" : "Login"),
              React.createElement(Button, { className: "w-full", type: "button", variant: "ghost", onClick: () => nav("/") }, "Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…ØªØ¬Ø±")
            )
          )
        );
      }

      function ProductForm({ initial, onSave, onCancel }) {
        const [name, setName] = useState(initial?.name || "");
        const [price, setPrice] = useState(initial?.price || 0);
        const [category, setCategory] = useState(initial?.category || "Electronics");
        const [image, setImage] = useState(initial?.image || seedProducts[0].image);
        const [description, setDescription] = useState(initial?.description || "");

        const submit = (e) => {
          e.preventDefault();
          if (!name.trim()) return alert("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬");
          if (!price || Number(price) < 1) return alert("Ø§Ù„Ø³Ø¹Ø± Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ø£ÙƒØ¨Ø± Ù…Ù† 0");
          onSave({ name: name.trim(), price: Number(price), category, image: image.trim(), description: description.trim() });
        };

        return React.createElement("form", { onSubmit: submit, className: "space-y-3" },
          React.createElement("div", { className: "grid sm:grid-cols-2 gap-3" },
            React.createElement("div", null, React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Name"), React.createElement(Input, { value: name, onChange: (e) => setName(e.target.value) })),
            React.createElement("div", null, React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Price"), React.createElement(Input, { type: "number", value: price, onChange: (e) => setPrice(e.target.value) }))
          ),
          React.createElement("div", { className: "grid sm:grid-cols-2 gap-3" },
            React.createElement("div", null,
              React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Category"),
              React.createElement(Select, { value: category, onChange: (e) => setCategory(e.target.value) }, PRODUCT_CATS.map((c) => React.createElement("option", { key: c, value: c }, c)))
            ),
            React.createElement("div", null, React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Image URL"), React.createElement(Input, { value: image, onChange: (e) => setImage(e.target.value) }))
          ),
          React.createElement("div", null, React.createElement("div", { className: "text-sm text-slate-300 mb-1" }, "Description"), React.createElement(Input, { value: description, onChange: (e) => setDescription(e.target.value), placeholder: "ÙˆØµÙ Ø¨Ø³ÙŠØ·â€¦" })),
          React.createElement("div", { className: "flex gap-2 pt-2" },
            React.createElement(Button, { type: "submit", className: "flex-1" }, "Save"),
            React.createElement(Button, { type: "button", variant: "ghost", className: "flex-1", onClick: onCancel }, "Cancel")
          )
        );
      }

      function AdminProducts({ store, toast }) {
        const [open, setOpen] = useState(false);
        const [editing, setEditing] = useState(null);

        const openAdd = () => { setEditing(null); setOpen(true); };
        const openEdit = (p) => { setEditing(p); setOpen(true); };

        return React.createElement(React.Fragment, null,
          React.createElement(PageTitle, { title: "Products", subtitle: "CRUD Ø¹Ù„Ù‰ LocalStorage", right: React.createElement(Button, { onClick: openAdd }, "Add Product") }),
          React.createElement("div", { className: "mt-4" },
            store.products.length === 0
              ? React.createElement(Empty, { title: "Ù…ÙÙŠØ´ Ù…Ù†ØªØ¬Ø§Øª", hint: "Ø¶ÙŠÙ Ø£ÙˆÙ„ Ù…Ù†ØªØ¬.", action: React.createElement(Button, { onClick: openAdd }, "Add Product") })
              : React.createElement(Card, { className: "p-4 overflow-auto scrollbar-thin anim-pop" },
                  React.createElement("table", { className: "w-full text-sm" },
                    React.createElement("thead", null,
                      React.createElement("tr", { className: "text-slate-300" }, ["Name", "Category", "Price", "Actions"].map((h) => React.createElement("th", { key: h, className: "text-right font-semibold py-2 px-2" }, h)))
                    ),
                    React.createElement("tbody", null,
                      store.products.map((p) =>
                        React.createElement("tr", { key: p.id, className: "border-t border-white/10" },
                          React.createElement("td", { className: "py-3 px-2" },
                            React.createElement("div", { className: "flex items-center gap-3" },
                              React.createElement("img", { src: p.image, className: "h-10 w-10 rounded-2xl object-cover ring-soft" }),
                              React.createElement("div", null,
                                React.createElement("div", { className: "font-extrabold" }, p.name),
                                React.createElement("div", { className: "text-xs text-slate-400" }, p.id)
                              )
                            )
                          ),
                          React.createElement("td", { className: "py-3 px-2" }, React.createElement(Badge, { tone: "indigo" }, p.category)),
                          React.createElement("td", { className: "py-3 px-2 font-extrabold" }, egp(p.price)),
                          React.createElement("td", { className: "py-3 px-2" },
                            React.createElement("div", { className: "flex gap-2" },
                              React.createElement(Button, { variant: "ghost", onClick: () => openEdit(p) }, "Edit"),
                              React.createElement(Button, { variant: "danger", onClick: () => { if (confirm("Ù…ØªØ£ÙƒØ¯ ØªÙ…Ø³Ø­ Ø§Ù„Ù…Ù†ØªØ¬ØŸ")) { store.productsCRUD.remove(p.id); toast.push("success", "Ø§ØªÙ…Ø³Ø­ Ø§Ù„Ù…Ù†ØªØ¬"); } } }, "Delete")
                            )
                          )
                        )
                      )
                    )
                  )
                )
          ),
          React.createElement(Modal, { open, onClose: () => setOpen(false), title: editing ? "Edit Product" : "Add Product" },
            React.createElement(ProductForm, {
              initial: editing,
              onCancel: () => setOpen(false),
              onSave: (data) => {
                if (editing) { store.productsCRUD.update(editing.id, data); toast.push("success", "ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ âœ…"); }
                else { store.productsCRUD.add(data); toast.push("success", "ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© âœ…"); }
                setOpen(false);
              }
            })
          )
        );
      }

      function AdminOrders({ store, toast }) {
        const statuses = ["new", "processing", "shipped", "cancelled"];
        return React.createElement(React.Fragment, null,
          React.createElement(PageTitle, { title: "Orders", subtitle: "Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª + ØªØºÙŠÙŠØ± Ø§Ù„Ø­Ø§Ù„Ø©." }),
          React.createElement("div", { className: "mt-4" },
            store.orders.length === 0
              ? React.createElement(Empty, { title: "Ù…ÙÙŠØ´ Orders", hint: "Ø§Ø¹Ù…Ù„ Checkout Ù…Ù† Ø§Ù„Ù…ØªØ¬Ø±." })
              : React.createElement("div", { className: "space-y-3" },
                  store.orders.map((o) =>
                    React.createElement(Card, { key: o.id, className: "p-5 anim-pop" },
                      React.createElement("div", { className: "flex flex-wrap items-start justify-between gap-3" },
                        React.createElement("div", null,
                          React.createElement("div", { className: "font-black text-lg" }, o.id),
                          React.createElement("div", { className: "text-sm text-slate-300 mt-1" }, new Date(o.createdAt).toLocaleString("ar-EG"), " â€¢ ", (o.customer?.name || "â€”"))
                        ),
                        React.createElement(Select, {
                          value: o.status,
                          onChange: (e) => { store.ordersCRUD.setStatus(o.id, e.target.value); toast.push("success", `Ø§Ù„Ø­Ø§Ù„Ø©: ${e.target.value}`); },
                          className: "w-48"
                        }, statuses.map((s) => React.createElement("option", { key: s, value: s }, s)))
                      ),
                      React.createElement("div", { className: "mt-3 text-sm text-slate-300" }, "Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ", React.createElement("span", { className: "font-extrabold text-slate-100" }, egp(o.total)))
                    )
                  )
                )
          )
        );
      }

      function AdminStats({ store }) {
        const totalSales = useMemo(() => store.orders.reduce((s, o) => s + (o.total || 0), 0), [store.orders]);
        const topCategory = useMemo(() => {
          const map = new Map();
          for (const o of store.orders) for (const it of (o.items || [])) map.set(it.category, (map.get(it.category) || 0) + (it.qty || 0));
          let best = null, bestV = -1;
          for (const [k, v] of map.entries()) if (v > bestV) { bestV = v; best = k; }
          return best ? `${best} (${bestV})` : "â€”";
        }, [store.orders]);

        return React.createElement(React.Fragment, null,
          React.createElement(PageTitle, { title: "Stats", subtitle: "Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª + Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª + Ø£ÙƒØ«Ø± ØªØµÙ†ÙŠÙ." }),
          React.createElement("div", { className: "mt-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3" },
            React.createElement(Card, { className: "p-5 anim-pop" }, React.createElement("div", { className: "text-sm text-slate-300" }, "Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª"), React.createElement("div", { className: "mt-2 text-2xl font-black" }, store.orders.length)),
            React.createElement(Card, { className: "p-5 anim-pop" }, React.createElement("div", { className: "text-sm text-slate-300" }, "Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª"), React.createElement("div", { className: "mt-2 text-2xl font-black" }, egp(totalSales))),
            React.createElement(Card, { className: "p-5 anim-pop" }, React.createElement("div", { className: "text-sm text-slate-300" }, "Ø£ÙƒØ«Ø± ØªØµÙ†ÙŠÙ Ù…Ø¨ÙŠØ¹Ù‹Ø§"), React.createElement("div", { className: "mt-2 text-2xl font-black" }, topCategory))
          )
        );
      }

      function AdminLayout({ store, toast }) {
        const nav = useNavigate();
        const { pathname } = useLocation();
        const [menu, setMenu] = useState(false);

        // Decide which admin page to render based on path
        let content = React.createElement(AdminStats, { store });
        if (pathname === "/admin/products") content = React.createElement(AdminProducts, { store, toast });
        if (pathname === "/admin/orders") content = React.createElement(AdminOrders, { store, toast });

        const linkClass = (to, exact) => {
          const active = exact ? pathname === to : pathname === to || pathname.startsWith(to + "/");
          return cn("px-3 py-2 rounded-2xl text-sm font-semibold block", active ? "bg-white/10" : "hover:bg-white/5");
        };

        return React.createElement(Shell, null,
          React.createElement("div", { className: "grid lg:grid-cols-[280px_1fr] gap-4" },
            React.createElement(Card, { className: "p-4 h-fit lg:sticky lg:top-6 anim-pop" },
              React.createElement("div", { className: "flex items-center justify-between" },
                React.createElement("div", { className: "font-black" }, "Admin"),
                React.createElement("button", { className: "lg:hidden px-3 py-2 rounded-2xl bg-white/5 hover:bg-white/10 text-sm", onClick: () => setMenu(v => !v) }, menu ? "Ø¥Ø®ÙØ§Ø¡" : "Ù‚Ø§Ø¦Ù…Ø©")
              ),
              React.createElement("div", { className: cn("mt-3 space-y-1", menu ? "block" : "hidden lg:block") },
                React.createElement("a", { href:"#/admin", className: linkClass("/admin", true) }, "Stats"),
                React.createElement("a", { href:"#/admin/products", className: linkClass("/admin/products") }, "Products"),
                React.createElement("a", { href:"#/admin/orders", className: linkClass("/admin/orders") }, "Orders"),
                React.createElement("div", { className: "pt-3 mt-3 border-t border-white/10 flex gap-2" },
                  React.createElement(Button, { variant: "ghost", className: "flex-1", onClick: () => nav("/") }, "Store"),
                  React.createElement(Button, { variant: "danger", className: "flex-1", onClick: () => { store.adminLogout(); toast.push("success", "ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬"); nav("/"); } }, "Logout")
                )
              )
            ),
            React.createElement("div", null,
              React.createElement(Card, { className: "p-4 mb-4 anim-pop" },
                React.createElement("div", { className: "flex items-center justify-between gap-3 flex-wrap" },
                  React.createElement("div", null,
                    React.createElement("div", { className: "font-black" }, "Dashboard"),
                    React.createElement("div", { className: "text-sm text-slate-300" }, pathname)
                  ),
                  React.createElement(Badge, { tone: "emerald" }, "UI Only + LocalStorage")
                )
              ),
              content
            )
          )
        );
      }
function ChatWidget({ store, toast, navigate }) {
  const [open, setOpen] = React.useState(false);
  const [text, setText] = React.useState("");
  const [msgs, setMsgs] = React.useState(() => ([
    { role: "bot", content: "Ø£Ù‡Ù„Ù‹Ø§ ðŸ‘‹ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¬Ø±. Ø§Ø³Ø£Ù„Ù†ÙŠ: (ØªØ±Ø´ÙŠØ­Ø§Øª Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª) Ø£Ùˆ (Ø£Ø±Ø®Øµ Ø­Ø§Ø¬Ø©) Ø£Ùˆ (Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø¨ÙŠØª) Ø£Ùˆ (Ø¹Ø§ÙŠØ² Ø­Ø§Ø¬Ø© ØªØ­Øª 500) ðŸ™‚" }
  ]));

  // helpers
  const norm = (s) => (s || "").toLowerCase().trim();
  const hasAny = (s, arr) => arr.some(w => s.includes(w));
  const parseBudget = (s) => {
    // ÙŠÙ„Ù‚Ø· Ø±Ù‚Ù… Ø²ÙŠ 500 / 1500 / 2,000
    const m = s.replace(/,/g, "").match(/(\d{2,6})/);
    return m ? Number(m[1]) : null;
  };

  const suggest = ({ category=null, maxPrice=null, sort="smart" } = {}) => {
    let list = store.products.slice();

    if (category) list = list.filter(p => (p.category || "").toLowerCase() === category.toLowerCase());
    if (maxPrice != null) list = list.filter(p => Number(p.price) <= maxPrice);

    if (sort === "cheap") list.sort((a,b) => a.price - b.price);
    else if (sort === "expensive") list.sort((a,b) => b.price - a.price);
    else {
      // smart: Ø®Ù„ÙŠ Ø§Ù„Ø£Ø±Ø®Øµ/Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§ (Ù…ÙÙŠØ´ ØªÙ‚ÙŠÙŠÙ…) ÙÙ†Ø¹Ù…Ù„ ØªØ±ØªÙŠØ¨ Ù‚Ø±ÙŠØ¨: Ø£Ù‚Ø±Ø¨ Ù„Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆØ³Ø·
      const avg = list.reduce((s,p)=>s+Number(p.price||0),0)/(list.length||1);
      list.sort((a,b)=>Math.abs(a.price-avg)-Math.abs(b.price-avg));
    }

    return list.slice(0, 3);
  };

  const answerFAQ = (s) => {
    if (hasAny(s, ["Ø´Ø­Ù†", "ØªÙˆØµÙŠÙ„", "delivery"])) {
      return "Ø§Ù„ØªÙˆØµÙŠÙ„ Demo ÙÙŠ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹. ØªÙ‚Ø¯Ø± ØªÙƒÙ…Ù„ Checkout ÙˆÙ‡ÙŠØªØ³Ø¬Ù„ Order ÙÙŠ LocalStorage âœ…";
    }
    if (hasAny(s, ["Ù…Ø±ØªØ¬Ø¹", "Ø§Ø³ØªØ±Ø¬Ø§Ø¹", "refund", "return"])) {
      return "Ø­Ø§Ù„ÙŠØ§Ù‹ Demo: Ø§Ø¹ØªØ¨Ø± Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø®Ù„Ø§Ù„ 14 ÙŠÙˆÙ… Ø¨Ø´Ø±Ø· Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬. (ØªÙ‚Ø¯Ø± ØªØºÙŠÙ‘Ø± Ø§Ù„Ù†Øµ Ø¨Ø±Ø§Ø­ØªÙƒ)";
    }
    if (hasAny(s, ["Ø·Ø±Ù‚ Ø¯ÙØ¹", "Ø¯ÙØ¹", "payment"])) {
      return "Demo: Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…/ØªØ­ÙˆÙŠÙ„ (Ø±Ù…Ø²ÙŠ). Ø§Ù„Ù…Ù‡Ù… Ø¥Ù† Ø§Ù„Ø·Ù„Ø¨ Ø¨ÙŠØªØ³Ø¬Ù„ ðŸ‘Œ";
    }
    return null;
  };

  const renderProductCard = (p) => {
    return {
      type: "product",
      id: p.id,
      name: p.name,
      price: p.price,
      category: p.category,
      image: p.image
    };
  };

  const botRespond = (raw) => {
    const s = norm(raw);
    // FAQ
    const faq = answerFAQ(s);
    if (faq) return [{ role:"bot", content: faq }];

    // cart / checkout navigation
    if (hasAny(s, ["Ø§Ù„Ø³Ù„Ø©", "cart"])) {
      return [
        { role:"bot", content:"ØªÙ…Ø§Ù…. Ø®Ù„ÙŠÙƒ Ø±Ø§ÙŠØ­ Ø¹Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© ðŸ›’" },
        { role:"bot", content:{ type:"action", label:"Ø§ÙØªØ­ Ø§Ù„Ø³Ù„Ø©", onClick: () => navigate("/cart") } }
      ];
    }
    if (hasAny(s, ["checkout", "Ø§Ù„Ø¯ÙØ¹", "Ø§ØªÙ…Ø§Ù…", "Ø¥ØªÙ…Ø§Ù…", "Ø·Ù„Ø¨"])) {
      return [
        { role:"bot", content:"Ø­Ø§Ø¶Ø±. Ù‡ÙˆØ¯ÙŠÙƒ Ù„ØµÙØ­Ø© Ø§Ù„Ù€Checkout âœ…" },
        { role:"bot", content:{ type:"action", label:"Ø§ÙØªØ­ Checkout", onClick: () => navigate("/checkout") } }
      ];
    }

    // Budget detection
    const budget = parseBudget(s);

    // Category detection (Arabic + English-ish)
    const catMap = [
      { key:"Electronics", words:["Ø§Ù„ÙƒØªØ±ÙˆÙ†", "Ø¥Ù„ÙƒØªØ±ÙˆÙ†", "Ø³Ù…Ø§Ø¹Ù‡", "Ø³Ù…Ø§Ø¹Ø§Øª", "Ø³Ø§Ø¹Ø©", "watch", "headphone", "electronics"] },
      { key:"Fashion", words:["Ù…Ù„Ø§Ø¨Ø³", "Ù‡ÙˆØ¯ÙŠ", "Ø´ÙˆØ²", "Ø­Ø°Ø§Ø¡", "fashion", "hoodie", "sneaker"] },
      { key:"Home", words:["Ø¨ÙŠØª", "Ù…Ù†Ø²Ù„", "home", "Ø¨Ø·Ø§Ù†ÙŠØ©", "Ù…Ø¹Ø·Ø±", "diffuser"] },
      { key:"Beauty", words:["Ø¨ÙŠÙˆØªÙŠ", "Ù…ÙƒÙŠØ§Ø¬", "Ø¨Ø´Ø±Ø©", "lipstick", "skincare", "beauty"] },
      { key:"Sports", words:["Ø±ÙŠØ§Ø¶Ø©", "Ø¬ÙŠÙ…", "sports", "bands", "Ø²Ø¬Ø§Ø¬Ø©", "bottle"] }
    ];

    let chosenCat = null;
    for (const c of catMap) {
      if (hasAny(s, c.words)) { chosenCat = c.key; break; }
    }

    // Sorting intent
    let sort = "smart";
    if (hasAny(s, ["Ø£Ø±Ø®Øµ", "Ø§Ø±Ø®Øµ", "cheap", "Ø§Ù‚Ù„ Ø³Ø¹Ø±"])) sort = "cheap";
    if (hasAny(s, ["Ø£ØºÙ„Ù‰", "Ø§ØºÙ„Ù‰", "expensive", "Ø§Ø¹Ù„Ù‰ Ø³Ø¹Ø±"])) sort = "expensive";

    // Search by name intent
    if (s.startsWith("Ø§Ø¨Ø­Ø«") || s.startsWith("Ø¨Ø­Ø«") || s.startsWith("search")) {
      const q = s.replace(/^Ø§Ø¨Ø­Ø«|^Ø¨Ø­Ø«|^search/,"").trim();
      const hits = store.products.filter(p => (p.name||"").toLowerCase().includes(q)).slice(0,3);
      if (!hits.length) return [{ role:"bot", content:`Ù…Ø´ Ù„Ø§Ù‚ÙŠ "${q}". Ø¬Ø±Ù‘Ø¨ ÙƒÙ„Ù…Ø© Ø£Ø¨Ø³Ø·.` }];
      return [
        { role:"bot", content:`Ù„Ù‚ÙŠØªÙ„Ùƒ ${hits.length} Ù†ØªÙŠØ¬Ø©:` },
        ...hits.map(p => ({ role:"bot", content: renderProductCard(p) }))
      ];
    }

    // Suggestions default
    const picks = suggest({ category: chosenCat, maxPrice: budget, sort });
    if (!picks.length) {
      return [{ role:"bot", content:"Ù…Ø´ Ù„Ø§Ù‚ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©. Ø¬Ø±Ù‘Ø¨ ØªØµÙ†ÙŠÙ ØªØ§Ù†ÙŠ Ø£Ùˆ Ø²ÙˆÙ‘Ø¯ Ø§Ù„Ù…ÙŠØ²Ø§Ù†ÙŠØ©." }];
    }

    const summaryBits = [];
    if (chosenCat) summaryBits.push(`ØªØµÙ†ÙŠÙ: ${chosenCat}`);
    if (budget != null) summaryBits.push(`ØªØ­Øª: ${budget}`);
    if (sort !== "smart") summaryBits.push(`ØªØ±ØªÙŠØ¨: ${sort === "cheap" ? "Ø§Ù„Ø£Ø±Ø®Øµ" : "Ø§Ù„Ø£ØºÙ„Ù‰"}`);

    return [
      { role:"bot", content: `Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªÙŠ ðŸŽ¯ ${summaryBits.length ? "(" + summaryBits.join(" â€¢ ") + ")" : ""}` },
      ...picks.map(p => ({ role:"bot", content: renderProductCard(p) })),
      { role:"bot", content:"Ø¹Ø§ÙŠØ² ØªØ±Ø´ÙŠØ­Ø§Øª Ø£ÙƒØªØ±ØŸ Ù‚ÙˆÙ„Ù‘ÙŠ: (Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª) Ø£Ùˆ (ØªØ­Øª 1000) Ø£Ùˆ (Ø£Ø±Ø®Øµ Ø­Ø§Ø¬Ø©)" }
    ];
  };

  const send = () => {
    const v = text.trim();
    if (!v) return;
    setMsgs(m => [{ role:"user", content:v }, ...m]);
    setText("");

    // simulate thinking
    setTimeout(() => {
      const replies = botRespond(v);
      setMsgs(m => [...replies, ...m]);
    }, 240);
  };

  return React.createElement(
    React.Fragment,
    null,
    // Floating button
    React.createElement("button", {
      onClick: () => setOpen(o => !o),
      className: "fixed bottom-4 right-4 z-[9999] rounded-2xl px-4 py-3 font-extrabold bg-indigo-500/90 hover:bg-indigo-500 shadow-soft ring-soft"
    }, open ? "âœ•" : "ðŸ’¬ Ø§Ø³Ø£Ù„Ù†ÙŠ"),
    open && React.createElement("div", {
      className: "fixed bottom-20 right-4 z-[9999] w-[min(360px,calc(100vw-2rem))] anim-pop"
    },
      React.createElement("div", { className:"glass ring-soft rounded-3xl overflow-hidden shadow-soft" },
        React.createElement("div", { className:"p-3 border-b border-white/10 flex items-center justify-between" },
          React.createElement("div", { className:"font-black" }, "Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¬Ø±"),
          React.createElement("div", { className:"text-xs text-slate-300" }, "Local bot")
        ),
        React.createElement("div", { className:"p-3 h-80 overflow-auto scrollbar-thin space-y-2 flex flex-col-reverse" },
          msgs.map((m, idx) => {
            const isUser = m.role === "user";
            const bubbleBase = "max-w-[85%] rounded-2xl px-3 py-2 text-sm ring-soft";
            const bubbleCls = isUser ? cn(bubbleBase, "self-start bg-white/10") : cn(bubbleBase, "self-end bg-indigo-500/15");

            // rich content
            if (typeof m.content === "object" && m.content?.type === "action") {
              return React.createElement("div", { key: idx, className: "self-end" },
                React.createElement("button", { className:"px-3 py-2 rounded-2xl bg-emerald-500/90 hover:bg-emerald-500 text-sm font-bold", onClick: m.content.onClick }, m.content.label)
              );
            }

            if (typeof m.content === "object" && m.content?.type === "product") {
              const p = m.content;
              return React.createElement("div", { key: idx, className:"self-end w-full" },
                React.createElement("div", { className:"glass ring-soft rounded-2xl p-3 flex gap-3 items-center" },
                  React.createElement("img", { src:p.image, className:"h-12 w-12 rounded-2xl object-cover ring-soft" }),
                  React.createElement("div", { className:"flex-1 min-w-0" },
                    React.createElement("div", { className:"font-extrabold truncate" }, p.name),
                    React.createElement("div", { className:"text-xs text-slate-300 flex items-center gap-2 mt-1" },
                      React.createElement("span", null, egp(p.price)),
                      React.createElement("span", { className:"px-2 py-1 rounded-full bg-white/8" }, p.category)
                    )
                  ),
                  React.createElement("div", { className:"flex flex-col gap-2" },
                    React.createElement("button", {
                      className:"px-3 py-2 rounded-2xl bg-indigo-500/90 hover:bg-indigo-500 text-xs font-bold",
                      onClick: () => { 
                        const real = store.products.find(x => x.id === p.id);
                        if (real) { store.addToCart(real); toast.push("success", "Ø§ØªØ¶Ø§Ù Ù„Ù„Ø³Ù„Ø© âœ…"); }
                      }
                    }, "Add"),
                    React.createElement("a", {
                      className:"px-3 py-2 rounded-2xl bg-white/5 hover:bg-white/10 text-xs font-bold text-center",
                      href: "#/product/" + p.id
                    }, "Details")
                  )
                )
              );
            }

            return React.createElement("div", { key: idx, className: bubbleCls }, String(m.content));
          })
        ),
        React.createElement("div", { className:"p-3 border-t border-white/10 flex gap-2" },
          React.createElement("input", {
            value: text,
            onChange: (e) => setText(e.target.value),
            onKeyDown: (e) => { if (e.key === "Enter") send(); },
            className:"flex-1 rounded-2xl bg-white/5 ring-soft px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-indigo-500/60",
            placeholder:"Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒâ€¦ Ù…Ø«Ù„: ØªØ­Øª 500 Ø£Ùˆ Ø£Ø±Ø®Øµ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª"
          }),
          React.createElement("button", { className:"px-4 py-2 rounded-2xl bg-indigo-500/90 hover:bg-indigo-500 font-extrabold", onClick: send }, "Ø¥Ø±Ø³Ø§Ù„")
        )
      )
    )
  );
}

      /* =========================
         App
      ========================= */
      function App() {
        const store = useAppStore();
        const toast = useToast();

        return React.createElement(HashRouter, null,
          React.createElement(Toasts, { items: toast.items }),
          React.createElement(Routes, null,
            React.createElement(Route, { index: true, element: React.createElement(Shell, null, React.createElement(Storefront, { store, toast })) }),
            React.createElement(Route, { path: "/product/:id", element: React.createElement(Shell, null, React.createElement(ProductDetails, { store, toast })) }),
            React.createElement(Route, { path: "/cart", element: React.createElement(Shell, null, React.createElement(CartPage, { store, toast })) }),
            React.createElement(Route, { path: "/checkout", element: React.createElement(Shell, null, React.createElement(CheckoutPage, { store, toast })) }),

            React.createElement(Route, { path: "/admin/login", element: React.createElement(AdminLogin, { store, toast }) }),
            React.createElement(Route, { path: "/admin", element: React.createElement(RequireAdmin, { store }, React.createElement(AdminLayout, { store, toast })) }),
            React.createElement(Route, { path: "/admin/products", element: React.createElement(RequireAdmin, { store }, React.createElement(AdminLayout, { store, toast })) }),
            React.createElement(Route, { path: "/admin/orders", element: React.createElement(RequireAdmin, { store }, React.createElement(AdminLayout, { store, toast })) }),

            // fallback
            React.createElement(Route, {
              path: "/404",
              element: React.createElement(Shell, null, React.createElement(Empty, { title: "Ø§Ù„ØµÙØ­Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©", hint: "Ø§Ø±Ø¬Ø¹ Ù„Ù„Ù…ØªØ¬Ø±.", action: React.createElement(Link, { to: "/", className: "inline-flex items-center justify-center rounded-2xl px-4 py-2 text-sm font-semibold bg-indigo-500/90 hover:bg-indigo-500 text-white" }, "Home") }))
            })
          )
        );
      }

      ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
    </script>
    <!-- ============ MINI STORE CHATBOT (FRONT-END ONLY) ============ -->
<style>
  .cb-fab{position:fixed;bottom:18px;right:18px;z-index:9999}
  .cb-btn{width:56px;height:56px;border-radius:16px;background:#111827;color:#fff;display:flex;align-items:center;justify-content:center;box-shadow:0 18px 40px rgba(0,0,0,.22);border:1px solid rgba(255,255,255,.12);cursor:pointer}
  .cb-panel{position:fixed;bottom:86px;right:18px;width:360px;max-width:calc(100vw - 36px);height:520px;max-height:calc(100vh - 140px);background:#fff;border:1px solid #e5e7eb;border-radius:20px;box-shadow:0 24px 60px rgba(0,0,0,.18);overflow:hidden;z-index:9999;display:none}
  .cb-head{background:#111827;color:#fff;padding:14px 14px 12px;display:flex;align-items:center;justify-content:space-between}
  .cb-title{font-weight:800;font-size:14px}
  .cb-sub{font-size:11px;color:#cbd5e1;margin-top:2px}
  .cb-x{width:34px;height:34px;border-radius:12px;background:rgba(255,255,255,.10);display:flex;align-items:center;justify-content:center;cursor:pointer}
  .cb-body{height:calc(100% - 128px);background:#f8fafc;padding:12px;overflow:auto}
  .cb-foot{border-top:1px solid #e5e7eb;background:#fff;padding:10px}
  .cb-row{display:flex;gap:8px}
  .cb-input{flex:1;height:44px;border:1px solid #e5e7eb;border-radius:14px;padding:0 12px;font-size:13px;outline:none}
  .cb-send{height:44px;padding:0 14px;border-radius:14px;background:#059669;color:#fff;border:none;font-weight:800;cursor:pointer}
  .cb-bubble{max-width:85%;padding:10px 12px;border-radius:16px;font-size:13px;line-height:1.35;border:1px solid transparent;margin-bottom:10px}
  .cb-me{margin-left:auto;background:#111827;color:#fff;border-color:rgba(255,255,255,.08)}
  .cb-bot{margin-right:auto;background:#fff;color:#111827;border-color:#e5e7eb}
  .cb-meta{font-size:11px;color:#6b7280;margin-top:6px}
  .cb-chips{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0 12px}
  .cb-chip{border:1px solid #e5e7eb;background:#fff;border-radius:999px;padding:7px 10px;font-size:12px;cursor:pointer}
  .cb-card{border:1px solid #e5e7eb;border-radius:16px;background:#fff;overflow:hidden;margin-top:10px}
  .cb-card .top{display:flex;gap:10px;padding:10px}
  .cb-img{width:56px;height:56px;border-radius:12px;background:#e5e7eb;object-fit:cover}
  .cb-name{font-weight:800;font-size:13px}
  .cb-cat{font-size:11px;color:#6b7280;margin-top:2px}
  .cb-price{font-weight:900;margin-top:6px}
  .cb-actions{display:flex;gap:8px;padding:10px;border-top:1px solid #e5e7eb}
  .cb-a{flex:1;height:36px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;font-weight:800;font-size:12px;cursor:pointer}
  .cb-a.primary{background:#111827;color:#fff;border-color:#111827}
  @media (max-width:420px){.cb-panel{width:calc(100vw - 36px)}}
</style>

<div class="cb-fab">
  <button class="cb-btn" id="cbOpen" aria-label="Open Chat">
    ðŸ’¬
  </button>
</div>

<div class="cb-panel" id="cbPanel" dir="rtl">
  <div class="cb-head">
    <div>
      <div class="cb-title">Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¬Ø±</div>
      <div class="cb-sub">Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§ØªØŒ ÙˆØ§Ù„ØªØµÙ†ÙŠÙØ§Øª</div>
    </div>
    <div class="cb-x" id="cbClose" title="Close">âœ•</div>
  </div>

  <div class="cb-body" id="cbBody">
    <div class="cb-chips">
      <div class="cb-chip" data-q="Ø§ÙŠÙ‡ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¹Ù†Ø¯ÙƒÙ…ØŸ">Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</div>
      <div class="cb-chip" data-q="Ø±Ø´Ø­Ù„ÙŠ Ø­Ø§Ø¬Ù‡ Ø±Ø®ÙŠØµÙ‡">Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø±Ø®ÙŠØµØ©</div>
      <div class="cb-chip" data-q="Ø³Ø¹Ø± Ø³Ù…Ø§Ø¹Ù‡">Ø³Ø¹Ø± Ù…Ù†ØªØ¬</div>
      <div class="cb-chip" data-q="Ø§Ù„Ø´Ø­Ù† Ø¨ÙŠØ§Ø®Ø¯ Ù‚Ø¯ Ø§ÙŠÙ‡ØŸ">Ø§Ù„Ø´Ø­Ù†</div>
      <div class="cb-chip" data-q="Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹">Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</div>
    </div>
  </div>

  <div class="cb-foot">
    <div class="cb-row">
      <input class="cb-input" id="cbInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§â€¦" />
      <button class="cb-send" id="cbSend">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
    <div class="cb-meta">Tip: Ø§ÙƒØªØ¨ â€œØ¨ÙƒØ§Ù… + Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬â€ Ø£Ùˆ â€œØ±Ø´Ø­ + ØªØµÙ†ÙŠÙâ€.</div>
  </div>
</div>

<script>
(function(){
  // ========= 1) PRODUCTS SOURCE =========
  // Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø© ÙƒÙ…ØªØºÙŠØ± global Ø§Ø³Ù…Ù‡ products Ù‡Ù†Ø³ØªØ®Ø¯Ù…Ù‡.
  // Ø£Ùˆ Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ LocalStorage: store_products
  // ÙˆØ¥Ù„Ø§ Ù‡Ù†Ø³ØªØ®Ø¯Ù… demo data.
  function loadProducts(){
    try{
      if (Array.isArray(window.products) && window.products.length) return window.products;
      const ls = localStorage.getItem("store_products");
      if(ls){
        const parsed = JSON.parse(ls);
        if(Array.isArray(parsed) && parsed.length) return parsed;
      }
    }catch(e){}
    // Demo fallback
    return [
      { id:"p1", name:"Ø³Ù…Ø§Ø¹Ø© Ø¨Ù„ÙˆØªÙˆØ«", price:799, category:"Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª", imageUrl:"https://picsum.photos/seed/ear/200/200", stock:12, description:"Ø³Ù…Ø§Ø¹Ø© Ù‚ÙˆÙŠØ© ÙˆØ¨Ø·Ø§Ø±ÙŠØ© Ø·ÙˆÙŠÙ„Ø©" },
      { id:"p2", name:"ÙƒÙŠØ¨ÙˆØ±Ø¯ Ù…ÙŠÙƒØ§Ù†ÙŠÙƒØ§Ù„", price:1299, category:"Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª", imageUrl:"https://picsum.photos/seed/key/200/200", stock:5, description:"Ø³ÙˆÙŠØªØ´Ø§Øª Ù†Ø§Ø¹Ù…Ø© ÙˆØ¥Ø¶Ø§Ø¡Ø© RGB" },
      { id:"p3", name:"ØªÙŠØ´ÙŠØ±Øª Ù‚Ø·Ù†", price:299, category:"Ù…Ù„Ø§Ø¨Ø³", imageUrl:"https://picsum.photos/seed/shirt/200/200", stock:25, description:"Ù‚Ø·Ù† 100% ÙˆÙ…Ø±ÙŠØ­" },
      { id:"p4", name:"Ø´Ù†Ø·Ø© Ø¸Ù‡Ø±", price:649, category:"Ø£ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª", imageUrl:"https://picsum.photos/seed/bag/200/200", stock:8, description:"Ù…Ø³Ø§Ø­Ø© ÙƒØ¨ÙŠØ±Ø© ÙˆØ®Ø§Ù…Ø© Ù…ØªÙŠÙ†Ø©" },
      { id:"p5", name:"Ù…Ø§ÙˆØ³ Ø¬ÙŠÙ…ÙŠÙ†Ø¬", price:499, category:"Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª", imageUrl:"https://picsum.photos/seed/mouse/200/200", stock:0, description:"DPI Ø¹Ø§Ù„ÙŠ ÙˆØ¥Ù…Ø³Ø§Ùƒ Ù…Ù…ØªØ§Ø²" },
      { id:"p6", name:"Ø²Ø¬Ø§Ø¬Ø© Ù…ÙŠØ§Ù‡", price:149, category:"Ù…Ù†Ø²Ù„", imageUrl:"https://picsum.photos/seed/bottle/200/200", stock:30, description:"Ø®ÙÙŠÙØ© ÙˆØ³Ù‡Ù„Ø© Ø§Ù„Ø­Ù…Ù„" },
    ];
  }

  function moneyEGP(n){
    try { return new Intl.NumberFormat("ar-EG",{style:"currency",currency:"EGP"}).format(Number(n)||0); }
    catch(e){ return (Number(n)||0) + " EGP"; }
  }

  // ========= 2) UI ELEMENTS =========
  const panel = document.getElementById("cbPanel");
  const openBtn = document.getElementById("cbOpen");
  const closeBtn = document.getElementById("cbClose");
  const body = document.getElementById("cbBody");
  const input = document.getElementById("cbInput");
  const send = document.getElementById("cbSend");

  const CHAT_KEY = "store_chat_history_v1";

  function scrollDown(){ body.scrollTop = body.scrollHeight; }

  function bubble(text, who="bot"){
    const d = document.createElement("div");
    d.className = "cb-bubble " + (who==="me" ? "cb-me" : "cb-bot");
    d.textContent = text;
    body.appendChild(d);
    scrollDown();
    saveHistory();
  }

  function productCard(p){
    const wrap = document.createElement("div");
    wrap.className = "cb-bot";

    const card = document.createElement("div");
    card.className = "cb-card";

    const top = document.createElement("div");
    top.className = "top";

    const img = document.createElement("img");
    img.className = "cb-img";
    img.src = p.imageUrl || "";
    img.alt = p.name || "product";
    img.onerror = () => { img.style.display="none"; };

    const info = document.createElement("div");
    const name = document.createElement("div");
    name.className = "cb-name";
    name.textContent = p.name;

    const cat = document.createElement("div");
    cat.className = "cb-cat";
    cat.textContent = (p.category || "â€”") + (p.stock === 0 ? " â€¢ ØºÙŠØ± Ù…ØªØ§Ø­" : "");

    const price = document.createElement("div");
    price.className = "cb-price";
    price.textContent = moneyEGP(p.price);

    info.appendChild(name);
    info.appendChild(cat);
    info.appendChild(price);

    top.appendChild(img);
    top.appendChild(info);

    const actions = document.createElement("div");
    actions.className = "cb-actions";

    const btnView = document.createElement("button");
    btnView.className = "cb-a";
    btnView.textContent = "Ø¹Ø±Ø¶";
    btnView.onclick = () => {
      // Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ ØµÙØ­Ø© Ù…Ù†ØªØ¬Ø§Øª: /products/{id}
      // Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù„ÙŠÙ†Ùƒ Ø­Ø³Ø¨ Ù…Ø´Ø±ÙˆØ¹Ùƒ
      const url = (p.id ? (`/products/${p.id}`) : "#");
      window.location.href = url;
    };

    const btnAdd = document.createElement("button");
    btnAdd.className = "cb-a primary";
    btnAdd.textContent = "Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©";
    btnAdd.onclick = () => {
      // Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Ø¯Ø§Ù„Ø© addToCart Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©
      if (typeof window.addToCart === "function") {
        window.addToCart(p.id);
        bubble("âœ… Ø§ØªØ¶Ø§Ù Ù„Ù„Ø³Ù„Ø©.", "bot");
      } else {
        // fallback: LocalStorage cart
        try{
          const key = "cart_items_v1";
          const raw = localStorage.getItem(key);
          const cart = raw ? JSON.parse(raw) : [];
          const existing = cart.find(x => x.id === p.id);
          if(existing) existing.qty += 1;
          else cart.push({ id: p.id, qty: 1, name: p.name, price: p.price, imageUrl: p.imageUrl });
          localStorage.setItem(key, JSON.stringify(cart));
          bubble("âœ… Ø§ØªØ¶Ø§Ù Ù„Ù„Ø³Ù„Ø© (LocalStorage).", "bot");
        }catch(e){
          bubble("Ø­ØµÙ„Øª Ù…Ø´ÙƒÙ„Ø© ÙˆØ¥Ø­Ù†Ø§ Ø¨Ù†Ø¶ÙŠÙ Ù„Ù„Ø³Ù„Ø© ðŸ˜…", "bot");
        }
      }
    };

    actions.appendChild(btnView);
    actions.appendChild(btnAdd);

    card.appendChild(top);
    card.appendChild(actions);

    wrap.appendChild(card);
    body.appendChild(wrap);
    scrollDown();
    saveHistory();
  }

  function saveHistory(){
    try{
      // Ù†Ø­ÙØ¸ Ù†ØµÙˆØµ/ÙƒØ±ÙˆØª Ø¨Ø³ ÙƒÙ€ HTML Ø¨Ø³ÙŠØ·
      localStorage.setItem(CHAT_KEY, body.innerHTML);
    }catch(e){}
  }
  function loadHistory(){
    try{
      const raw = localStorage.getItem(CHAT_KEY);
      if(raw) body.innerHTML = raw;
    }catch(e){}
  }

  // ========= 3) BOT LOGIC (FRONT-END RULES) =========
  function normalize(s){
    return (s||"")
      .toLowerCase()
      .replace(/[^\p{L}\p{N}\s]/gu," ")
      .replace(/\s+/g," ")
      .trim();
  }

  function hasAny(msg, arr){
    return arr.some(w => msg.includes(w));
  }

  function extractKeywords(msg){
    return msg.split(" ").filter(w => w.length >= 3).slice(0, 6);
  }

  function findProducts(products, msg){
    const keys = extractKeywords(msg);
    if(!keys.length) return [];
    return products.filter(p => {
      const hay = normalize((p.name||"") + " " + (p.description||"") + " " + (p.category||""));
      return keys.some(k => hay.includes(k));
    });
  }

  function uniqueCategories(products){
    const set = new Set();
    products.forEach(p => p.category && set.add(p.category));
    return Array.from(set).sort((a,b)=> a.localeCompare(b,"ar"));
  }

  function recommend(products, msg){
    // Ù„Ùˆ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙŠÙ‡Ø§ ØªØµÙ†ÙŠÙ Ù…ÙˆØ¬ÙˆØ¯ØŒ Ù†Ø±Ø´Ø­ Ù…Ù†Ù‡
    const cats = uniqueCategories(products);
    const foundCat = cats.find(c => normalize(c).includes(msg) || msg.includes(normalize(c)));
    let list = products.filter(p => p.stock !== 0);

    if(foundCat){
      list = list.filter(p => p.category === foundCat);
    }

    // Ù„Ùˆ Ù‚Ø§Ù„ Ø±Ø®ÙŠØµ/Ø£Ø±Ø®Øµ: sort by price
    if(hasAny(msg, ["Ø±Ø®ÙŠØµ","Ø§Ø±Ø®Øµ","cheap","Ø§Ù‚ØªØµØ§Ø¯ÙŠ","Ø§Ù‚Ù„"])){
      list = list.sort((a,b)=> (a.price||0) - (b.price||0));
    } else {
      // default: Ø§Ù„Ù…ØªØ§Ø­ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø«Ù… Ø§Ù„Ø£Ø±Ø®Øµ
      list = list.sort((a,b)=> (b.stock||0) - (a.stock||0) || (a.price||0)-(b.price||0));
    }

    return list.slice(0, 4);
  }

  function botReply(raw){
    const products = loadProducts();
    const msg = normalize(raw);

    if(!msg) return { text: "Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„ÙƒØŒ ÙˆØ£Ù†Ø§ Ù‡Ø³Ø§Ø¹Ø¯Ùƒ âœ…" };

    // FAQ
    if(hasAny(msg, ["Ø´Ø­Ù†","ØªÙˆØµÙŠÙ„","delivery","shipping","Ù…Ø¯Ø©","Ø¨ÙŠØ§Ø®Ø¯"])){
      return { text: "ðŸšš Ø§Ù„Ø´Ø­Ù† ØºØ§Ù„Ø¨Ù‹Ø§ 1-3 Ø£ÙŠØ§Ù… Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†. Ø§Ø¨Ø¹ØªÙ„ÙŠ Ù…Ø­Ø§ÙØ¸ØªÙƒ/Ù…Ù†Ø·Ù‚ØªÙƒ Ø£Ù‚ÙˆÙ„Ùƒ ØªÙ‚Ø¯ÙŠØ± Ø£Ø¯Ù‚." };
    }
    if(hasAny(msg, ["Ø§Ø³ØªØ±Ø¬Ø§Ø¹","Ø§Ø³ØªØ¨Ø¯Ø§Ù„","Ø§Ø±Ø¬Ø§Ø¹","refund","return"])){
      return { text: "ðŸ” Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹/Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø®Ù„Ø§Ù„ 14 ÙŠÙˆÙ… Ø¨Ø´Ø±Ø· ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø­Ø§Ù„ØªÙ‡. Ù‚ÙˆÙ„Ù‘ÙŠ Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯." };
    }
    if(hasAny(msg, ["ØªØµÙ†ÙŠÙØ§Øª","Ø§Ù‚Ø³Ø§Ù…","Ù‚Ø³Ù…","category","categories","ÙØ¦Ø§Øª","ÙØ¦Ø©"])){
      const cats = uniqueCategories(products);
      return { text: cats.length ? `ðŸ“¦ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©: ${cats.join("ØŒ ")}` : "Ø­Ø§Ù„ÙŠÙ‹Ø§ Ù…ÙÙŠØ´ ØªØµÙ†ÙŠÙØ§Øª." };
    }

    // Price questions
    if(hasAny(msg, ["Ø³Ø¹Ø±","Ø¨ÙƒØ§Ù…","price","ÙƒØ§Ù…","Ø«Ù…Ù†","cost"])){
      const matches = findProducts(products, msg);
      if(!matches.length){
        return { text: "Ù‚ÙˆÙ„Ù‘ÙŠ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ù…Ù† Ø§Ø³Ù…Ù‡ (Ù…Ø«Ø§Ù„: Ø³Ù…Ø§Ø¹Ø©/Ø´Ù†Ø·Ø©)ØŒ ÙˆØ£Ù†Ø§ Ø£Ø·Ù„Ø¹Ù„Ùƒ Ø§Ù„Ø³Ø¹Ø± ÙÙˆØ±Ù‹Ø§ ðŸ’°" };
      }
      return {
        text: "Ù„Ù‚ÙŠØªÙ„Ùƒ Ø¯ÙˆÙ„ ðŸ‘‡",
        cards: matches.slice(0,4)
      };
    }

    // Recommend
    if(hasAny(msg, ["Ø§Ù‚ØªØ±Ø­","Ø±Ø´Ø­","suggest","recommend","Ø§Ù†ØµØ­","Ø§Ø®ØªØ§Ø±Ù„ÙŠ","Ø¹Ø§ÙŠØ²"])){
      const recs = recommend(products, msg);
      if(!recs.length) return { text: "Ù…Ø´ Ù„Ø§Ù‚ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ù…ØªØ§Ø­Ø© Ø¯Ù„ÙˆÙ‚ØªÙŠ. Ø¬Ø±Ù‘Ø¨ ØªØ³Ø£Ù„ Ø¹Ù† ØªØµÙ†ÙŠÙ Ù…Ø¹ÙŠÙ†." };
      return {
        text: "âœ¨ Ø¯ÙŠ ØªØ±Ø´ÙŠØ­Ø§Øª Ù…Ù†Ø§Ø³Ø¨Ø©:",
        cards: recs
      };
    }

    // Search by name
    const matches = findProducts(products, msg);
    if(matches.length){
      return { text: "Ù„Ù‚ÙŠØª Ù…Ù†ØªØ¬Ø§Øª Ù‚Ø±ÙŠØ¨Ø© Ù…Ù† ÙƒÙ„Ø§Ù…Ùƒ:", cards: matches.slice(0,4) };
    }

    // Fallback help
    return {
      text:
        "Ù…Ù…ÙƒÙ† ØªØ³Ø§Ø¹Ø¯Ù†ÙŠ Ø¨ÙƒÙ„Ù…Ø© Ø£ÙˆØ¶Ø­ØŸ Ø¬Ø±Ù‘Ø¨:\n" +
        "â€¢ â€œØ¨ÙƒØ§Ù… Ø³Ù…Ø§Ø¹Ø©â€\n" +
        "â€¢ â€œØ§Ù‚ØªØ±Ø­ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª Ø±Ø®ÙŠØµØ©â€\n" +
        "â€¢ â€œØ§ÙŠÙ‡ Ø§Ù„ØªØµÙ†ÙŠÙØ§ØªØŸâ€"
    };
  }

  // ========= 4) EVENTS =========
  function open(){
    panel.style.display = "block";
    input.focus();
    scrollDown();
  }
  function close(){ panel.style.display = "none"; }

  openBtn.addEventListener("click", open);
  closeBtn.addEventListener("click", close);

  send.addEventListener("click", () => {
    const v = input.value;
    input.value = "";
    bubble(v, "me");
    const res = botReply(v);
    bubble(res.text, "bot");
    if(res.cards && res.cards.length){
      res.cards.forEach(productCard);
    }
  });

  input.addEventListener("keydown", (e) => {
    if(e.key === "Enter"){
      e.preventDefault();
      send.click();
    }
  });

  document.addEventListener("click", (e) => {
    const chip = e.target.closest && e.target.closest(".cb-chip");
    if(chip){
      const q = chip.getAttribute("data-q");
      input.value = q;
      send.click();
    }
  });

  // Load previous chat and greet
  loadHistory();
  if(!localStorage.getItem("store_chat_greeted_v1")){
    bubble("Ø£Ù‡Ù„Ù‹Ø§ ðŸ‘‹ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ù…ØªØ¬Ø±. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø£Ùˆ Ø®Ù„ÙŠÙ‘Ù†ÙŠ Ø£Ø±Ø´Ø­Ù„Ùƒ Ù…Ù†ØªØ¬Ø§Øª.", "bot");
    localStorage.setItem("store_chat_greeted_v1","1");
  }
})();
</script>
<!-- ============ /MINI STORE CHATBOT ============ -->

  </body>
</html>
