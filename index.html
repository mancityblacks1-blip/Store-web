<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CV Builder - Ù…Ù„Ù ÙˆØ§Ø­Ø¯</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© */
    @media print {
      body { background: #fff !important; }
      .no-print { display: none !important; }
      .print-area { box-shadow: none !important; border: none !important; }
      .print-container { max-width: 100% !important; padding: 0 !important; }
      .cv-page { border: none !important; border-radius: 0 !important; }
    }
    .shadow-soft { box-shadow: 0 18px 40px rgba(0,0,0,.08); }
    .a4 { width: 210mm; min-height: 297mm; }
    @media (max-width: 1024px){ .a4 { width: 100%; } }
  </style>
</head>

<body class="bg-zinc-50 text-zinc-900">
  <header class="no-print border-b border-zinc-200 bg-white">
    <div class="mx-auto max-w-6xl px-4 h-14 flex items-center justify-between">
      <div class="font-semibold">ğŸ§¾ CV Builder</div>
      <div class="flex items-center gap-2">
        <button id="btnSave" class="h-10 px-4 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 text-sm">
          Ø­ÙØ¸
        </button>
        <button id="btnReset" class="h-10 px-4 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 text-sm">
          Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
        </button>
        <button id="btnPdf" class="h-10 px-4 rounded-xl bg-emerald-600 text-white hover:bg-emerald-500 text-sm">
          ğŸ–¨ï¸ PDF
        </button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-6 print-container">
    <div class="grid gap-4 lg:grid-cols-3">
      <!-- Form -->
      <section class="no-print lg:col-span-1 space-y-4">
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-lg font-semibold">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù€ CV</div>
              <div class="text-sm text-zinc-600">Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ´ÙˆÙ Ø§Ù„Ø´ÙƒÙ„ ÙÙˆØ±Ù‹Ø§</div>
            </div>
            <div class="w-40">
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù‚Ø§Ù„Ø¨</label>
              <select id="template" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300">
                <option value="modern">Modern</option>
                <option value="classic">Classic</option>
              </select>
            </div>
          </div>

          <div class="mt-4 grid gap-3">
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø§Ø³Ù…</label>
              <input id="fullName" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="Ù…Ø«Ø§Ù„: Ahmed Mohamed" />
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ</label>
              <input id="title" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="Ù…Ø«Ø§Ù„: Frontend Developer" />
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input id="phone" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="01xxxxxxxxx" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯</label>
                <input id="email" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="name@email.com" />
              </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù…ÙƒØ§Ù†</label>
                <input id="location" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="Cairo, Egypt" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">LinkedIn</label>
                <input id="linkedin" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="linkedin.com/in/..." />
              </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">GitHub</label>
                <input id="github" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="github.com/..." />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Portfolio</label>
                <input id="portfolio" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="your-site.com" />
              </div>
            </div>

            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ù…Ù„Ø®Øµ (Summary)</label>
              <textarea id="summary" class="min-h-[90px] w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-300"
                placeholder="Ø§ÙƒØªØ¨ 3-5 Ø³Ø·ÙˆØ± Ø¹Ù†Ùƒ: Ø®Ø¨Ø±ØªÙƒØŒ Ø£Ù‚ÙˆÙ‰ Ù…Ù‡Ø§Ø±Ø§ØªÙƒØŒ Ù†ÙˆØ¹ Ø§Ù„Ø´ØºÙ„ Ø§Ù„Ù„ÙŠ Ø¨ØªØ³ØªÙ‡Ø¯ÙÙ‡..."></textarea>
            </div>
          </div>
        </div>

        <!-- Experience -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Ø§Ù„Ø®Ø¨Ø±Ø§Øª</div>
            <button id="addExp" class="h-9 px-3 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 text-sm">+ Ø¥Ø¶Ø§ÙØ©</button>
          </div>
          <div id="expList" class="mt-3 space-y-3"></div>
        </div>

        <!-- Education -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
            <button id="addEdu" class="h-9 px-3 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 text-sm">+ Ø¥Ø¶Ø§ÙØ©</button>
          </div>
          <div id="eduList" class="mt-3 space-y-3"></div>
        </div>

        <!-- Projects -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            <button id="addProj" class="h-9 px-3 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 text-sm">+ Ø¥Ø¶Ø§ÙØ©</button>
          </div>
          <div id="projList" class="mt-3 space-y-3"></div>
        </div>

        <!-- Skills -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="font-semibold">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</div>
          <div class="mt-2 text-xs text-zinc-600">Ø§ÙƒØªØ¨Ù‡Ø§ Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„: HTML, CSS, React...</div>
          <input id="skills" class="mt-2 h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300"
            placeholder="React, Next.js, Tailwind, TypeScript..." />
        </div>

        <!-- Languages -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="font-semibold">Ø§Ù„Ù„ØºØ§Øª</div>
          <div class="mt-2 text-xs text-zinc-600">Ù…Ø«Ø§Ù„: Arabic (Native), English (B2)</div>
          <input id="languages" class="mt-2 h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300"
            placeholder="Arabic (Native), English (B2)" />
        </div>
      </section>

      <!-- Preview -->
      <section class="lg:col-span-2">
        <div class="print-area mx-auto a4 rounded-2xl border border-zinc-200 bg-white shadow-soft overflow-hidden cv-page" id="cv">
          <!-- Modern template header -->
          <div id="modernHeader" class="hidden">
            <div class="bg-zinc-900 text-white p-7">
              <div class="flex items-start justify-between gap-6">
                <div class="min-w-0">
                  <div class="text-3xl font-semibold leading-tight" id="pName">â€”</div>
                  <div class="mt-1 text-lg text-zinc-200" id="pTitle">â€”</div>
                  <div class="mt-4 grid gap-1 text-sm text-zinc-200">
                    <div id="pMeta1">â€”</div>
                    <div id="pMeta2">â€”</div>
                  </div>
                </div>
                <div class="w-40 text-right text-sm text-zinc-200">
                  <div class="font-semibold text-white">Contacts</div>
                  <div class="mt-2 space-y-1" id="pLinks">â€”</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Classic template header -->
          <div id="classicHeader" class="hidden p-7 border-b border-zinc-200">
            <div class="flex items-start justify-between gap-6">
              <div class="min-w-0">
                <div class="text-3xl font-semibold leading-tight" id="cName">â€”</div>
                <div class="mt-1 text-lg text-zinc-700" id="cTitle">â€”</div>
                <div class="mt-3 text-sm text-zinc-600" id="cMeta">â€”</div>
              </div>
              <div class="text-right text-sm text-zinc-700">
                <div class="font-semibold">Contacts</div>
                <div class="mt-2 space-y-1" id="cLinks">â€”</div>
              </div>
            </div>
          </div>

          <div class="p-7">
            <!-- Summary -->
            <section>
              <h2 class="text-sm font-semibold tracking-wide text-zinc-900" id="hSummary">SUMMARY</h2>
              <div class="mt-2 text-sm text-zinc-700 whitespace-pre-wrap" id="pSummary">â€”</div>
            </section>

            <div class="mt-6 grid gap-6 lg:grid-cols-2">
              <!-- Left -->
              <div class="space-y-6">
                <section>
                  <h2 class="text-sm font-semibold tracking-wide text-zinc-900">EXPERIENCE</h2>
                  <div class="mt-3 space-y-4" id="pExp">â€”</div>
                </section>

                <section>
                  <h2 class="text-sm font-semibold tracking-wide text-zinc-900">PROJECTS</h2>
                  <div class="mt-3 space-y-3" id="pProj">â€”</div>
                </section>
              </div>

              <!-- Right -->
              <div class="space-y-6">
                <section>
                  <h2 class="text-sm font-semibold tracking-wide text-zinc-900">EDUCATION</h2>
                  <div class="mt-3 space-y-3" id="pEdu">â€”</div>
                </section>

                <section>
                  <h2 class="text-sm font-semibold tracking-wide text-zinc-900">SKILLS</h2>
                  <div class="mt-3 flex flex-wrap gap-2" id="pSkills">â€”</div>
                </section>

                <section>
                  <h2 class="text-sm font-semibold tracking-wide text-zinc-900">LANGUAGES</h2>
                  <div class="mt-2 text-sm text-zinc-700" id="pLang">â€”</div>
                </section>
              </div>
            </div>

            <div class="mt-8 text-[11px] text-zinc-500">
              Tip: Ø§Ø­ÙØ¸Ù‡ ÙƒÙ€ PDF Ù…Ù† Ø²Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©.
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    const LS_KEY = "cv_builder_v1";

    const state = {
      template: "modern",
      fullName: "Ahmed Mohamed",
      title: "Frontend Developer",
      phone: "01000000000",
      email: "ahmed@email.com",
      location: "Cairo, Egypt",
      linkedin: "linkedin.com/in/ahmed",
      github: "github.com/ahmed",
      portfolio: "ahmed.dev",
      summary:
`Frontend Developer with experience building responsive web apps using React and Next.js.
I focus on clean UI, performance, and maintainable code.
Looking for opportunities to deliver modern products and delightful user experiences.`,
      experiences: [
        {
          role: "Frontend Developer",
          company: "Freelance",
          period: "2024 - Present",
          bullets: [
            "Built responsive landing pages and dashboards with React + Tailwind.",
            "Improved performance and Lighthouse scores through optimization.",
            "Collaborated with clients to deliver features quickly and cleanly."
          ]
        }
      ],
      education: [
        {
          degree: "BSc Computer Science",
          school: "Your University",
          period: "2019 - 2023",
          details: "Relevant: Data Structures, Web Development, Databases"
        }
      ],
      projects: [
        {
          name: "E-commerce Store + Admin",
          link: "github.com/yourrepo",
          bullets: [
            "Next.js storefront with cart, checkout demo and admin dashboard.",
            "Prisma + SQLite database with CRUD and stats."
          ]
        }
      ],
      skills: ["React", "Next.js", "Tailwind", "TypeScript", "HTML", "CSS", "Git"],
      languages: "Arabic (Native), English (B2)"
    };

    // DOM
    const el = (id) => document.getElementById(id);
    const inputs = {
      template: el("template"),
      fullName: el("fullName"),
      title: el("title"),
      phone: el("phone"),
      email: el("email"),
      location: el("location"),
      linkedin: el("linkedin"),
      github: el("github"),
      portfolio: el("portfolio"),
      summary: el("summary"),
      skills: el("skills"),
      languages: el("languages")
    };

    // Preview targets
    const modernHeader = el("modernHeader");
    const classicHeader = el("classicHeader");

    const pName = el("pName"), pTitle = el("pTitle"), pMeta1 = el("pMeta1"), pMeta2 = el("pMeta2"), pLinks = el("pLinks");
    const cName = el("cName"), cTitle = el("cTitle"), cMeta = el("cMeta"), cLinks = el("cLinks");

    const pSummary = el("pSummary");
    const pExp = el("pExp");
    const pEdu = el("pEdu");
    const pProj = el("pProj");
    const pSkills = el("pSkills");
    const pLang = el("pLang");

    const expList = el("expList");
    const eduList = el("eduList");
    const projList = el("projList");

    const btnPdf = el("btnPdf");
    const btnSave = el("btnSave");
    const btnReset = el("btnReset");

    const addExp = el("addExp");
    const addEdu = el("addEdu");
    const addProj = el("addProj");

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function toast(msg) {
      const t = document.createElement("div");
      t.className = "fixed left-1/2 top-4 -translate-x-1/2 z-50 rounded-xl bg-zinc-900 text-white px-4 py-2 text-sm shadow-soft";
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1600);
    }

    function setTemplate(template) {
      state.template = template;
      if (template === "modern") {
        modernHeader.classList.remove("hidden");
        classicHeader.classList.add("hidden");
      } else {
        classicHeader.classList.remove("hidden");
        modernHeader.classList.add("hidden");
      }
    }

    function linkLine(label, value) {
      if (!value) return "";
      const safe = escapeHtml(value);
      return `<div class="truncate"><span class="text-zinc-300">${label}:</span> <span class="text-white">${safe}</span></div>`;
    }

    function classicLinkLine(label, value) {
      if (!value) return "";
      const safe = escapeHtml(value);
      return `<div class="truncate"><span class="text-zinc-500">${label}:</span> <span class="text-zinc-900">${safe}</span></div>`;
    }

    function renderChips(arr) {
      if (!arr || arr.length === 0) return `<span class="text-sm text-zinc-500">â€”</span>`;
      return arr.map(s => `<span class="inline-flex items-center rounded-full bg-zinc-100 px-2.5 py-1 text-xs text-zinc-700">${escapeHtml(s)}</span>`).join("");
    }

    function renderBullets(bullets) {
      if (!bullets || bullets.length === 0) return "";
      return `
        <ul class="mt-2 list-disc pr-5 text-sm text-zinc-700 space-y-1">
          ${bullets.map(b => `<li>${escapeHtml(b)}</li>`).join("")}
        </ul>
      `;
    }

    function renderExp() {
      if (!state.experiences.length) return `<div class="text-sm text-zinc-500">â€”</div>`;
      return state.experiences.map((e) => `
        <div>
          <div class="flex items-start justify-between gap-3">
            <div class="font-semibold text-zinc-900">${escapeHtml(e.role)}</div>
            <div class="text-xs text-zinc-500">${escapeHtml(e.period)}</div>
          </div>
          <div class="text-sm text-zinc-700">${escapeHtml(e.company)}</div>
          ${renderBullets(e.bullets)}
        </div>
      `).join("");
    }

    function renderEdu() {
      if (!state.education.length) return `<div class="text-sm text-zinc-500">â€”</div>`;
      return state.education.map((e) => `
        <div>
          <div class="flex items-start justify-between gap-3">
            <div class="font-semibold text-zinc-900">${escapeHtml(e.degree)}</div>
            <div class="text-xs text-zinc-500">${escapeHtml(e.period)}</div>
          </div>
          <div class="text-sm text-zinc-700">${escapeHtml(e.school)}</div>
          ${e.details ? `<div class="mt-1 text-sm text-zinc-600">${escapeHtml(e.details)}</div>` : ""}
        </div>
      `).join("");
    }

    function renderProj() {
      if (!state.projects.length) return `<div class="text-sm text-zinc-500">â€”</div>`;
      return state.projects.map((p) => `
        <div>
          <div class="flex items-start justify-between gap-3">
            <div class="font-semibold text-zinc-900">${escapeHtml(p.name)}</div>
            <div class="text-xs text-zinc-500">${escapeHtml(p.link || "")}</div>
          </div>
          ${renderBullets(p.bullets)}
        </div>
      `).join("");
    }

    function syncInputsFromState() {
      inputs.template.value = state.template;
      inputs.fullName.value = state.fullName;
      inputs.title.value = state.title;
      inputs.phone.value = state.phone;
      inputs.email.value = state.email;
      inputs.location.value = state.location;
      inputs.linkedin.value = state.linkedin;
      inputs.github.value = state.github;
      inputs.portfolio.value = state.portfolio;
      inputs.summary.value = state.summary;
      inputs.skills.value = state.skills.join(", ");
      inputs.languages.value = state.languages;
    }

    function syncStateFromInputs() {
      state.template = inputs.template.value;
      state.fullName = inputs.fullName.value;
      state.title = inputs.title.value;
      state.phone = inputs.phone.value;
      state.email = inputs.email.value;
      state.location = inputs.location.value;
      state.linkedin = inputs.linkedin.value;
      state.github = inputs.github.value;
      state.portfolio = inputs.portfolio.value;
      state.summary = inputs.summary.value;
      state.skills = (inputs.skills.value || "")
        .split(",")
        .map(s => s.trim())
        .filter(Boolean);
      state.languages = inputs.languages.value;
    }

    // Dynamic forms for Experience/Education/Projects
    function expCard(e, idx) {
      const bulletsText = (e.bullets || []).join("\n");
      return `
        <div class="rounded-2xl border border-zinc-200 bg-zinc-50 p-3">
          <div class="flex items-center justify-between">
            <div class="text-sm font-semibold">Ø®Ø¨Ø±Ø© #${idx + 1}</div>
            <button data-exp-del="${idx}" class="h-9 px-3 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 text-sm">Ø­Ø°Ù</button>
          </div>
          <div class="mt-3 grid gap-3">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù…Ø³Ù…Ù‰</label>
                <input data-exp="role" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.role)}" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„ÙØªØ±Ø©</label>
                <input data-exp="period" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.period)}" />
              </div>
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø´Ø±ÙƒØ©</label>
              <input data-exp="company" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.company)}" />
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ù†Ù‚Ø§Ø· (ÙƒÙ„ Ø³Ø·Ø± Ù†Ù‚Ø·Ø©)</label>
              <textarea data-exp="bullets" data-i="${idx}" class="min-h-[90px] w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-300">${escapeHtml(bulletsText)}</textarea>
            </div>
          </div>
        </div>
      `;
    }

    function eduCard(e, idx) {
      return `
        <div class="rounded-2xl border border-zinc-200 bg-zinc-50 p-3">
          <div class="flex items-center justify-between">
            <div class="text-sm font-semibold">ØªØ¹Ù„ÙŠÙ… #${idx + 1}</div>
            <button data-edu-del="${idx}" class="h-9 px-3 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 text-sm">Ø­Ø°Ù</button>
          </div>
          <div class="mt-3 grid gap-3">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø¯Ø±Ø¬Ø©</label>
                <input data-edu="degree" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.degree)}" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„ÙØªØ±Ø©</label>
                <input data-edu="period" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.period)}" />
              </div>
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø¬Ù‡Ø©</label>
              <input data-edu="school" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.school)}" />
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">ØªÙØ§ØµÙŠÙ„</label>
              <input data-edu="details" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.details || "")}" />
            </div>
          </div>
        </div>
      `;
    }

    function projCard(p, idx) {
      const bulletsText = (p.bullets || []).join("\n");
      return `
        <div class="rounded-2xl border border-zinc-200 bg-zinc-50 p-3">
          <div class="flex items-center justify-between">
            <div class="text-sm font-semibold">Ù…Ø´Ø±ÙˆØ¹ #${idx + 1}</div>
            <button data-proj-del="${idx}" class="h-9 px-3 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 text-sm">Ø­Ø°Ù</button>
          </div>
          <div class="mt-3 grid gap-3">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                <input data-proj="name" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(p.name)}" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ù„ÙŠÙ†Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input data-proj="link" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(p.link || "")}" />
              </div>
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ù†Ù‚Ø§Ø· (ÙƒÙ„ Ø³Ø·Ø± Ù†Ù‚Ø·Ø©)</label>
              <textarea data-proj="bullets" data-i="${idx}" class="min-h-[90px] w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-300">${escapeHtml(bulletsText)}</textarea>
            </div>
          </div>
        </div>
      `;
    }

    function renderDynamicForms() {
      expList.innerHTML = state.experiences.map(expCard).join("");
      eduList.innerHTML = state.education.map(eduCard).join("");
      projList.innerHTML = state.projects.map(projCard).join("");
    }

    function renderPreview() {
      setTemplate(state.template);

      const name = (state.fullName || "â€”").trim();
      const title = (state.title || "â€”").trim();

      // meta lines
      const meta1 = [state.location, state.phone].filter(Boolean).join(" â€¢ ") || "â€”";
      const meta2 = [state.email].filter(Boolean).join(" â€¢ ") || "â€”";

      // links
      const linksModern =
        [
          ["LinkedIn", state.linkedin],
          ["GitHub", state.github],
          ["Portfolio", state.portfolio]
        ]
          .filter(([_, v]) => (v || "").trim().length > 0)
          .map(([k, v]) => linkLine(k, v))
          .join("") || `<div class="text-zinc-300">â€”</div>`;

      const linksClassic =
        [
          ["LinkedIn", state.linkedin],
          ["GitHub", state.github],
          ["Portfolio", state.portfolio]
        ]
          .filter(([_, v]) => (v || "").trim().length > 0)
          .map(([k, v]) => classicLinkLine(k, v))
          .join("") || `<div class="text-zinc-500">â€”</div>`;

      // modern
      pName.textContent = name;
      pTitle.textContent = title;
      pMeta1.textContent = meta1;
      pMeta2.textContent = meta2;
      pLinks.innerHTML = linksModern;

      // classic
      cName.textContent = name;
      cTitle.textContent = title;
      cMeta.textContent = [state.location, state.phone, state.email].filter(Boolean).join(" â€¢ ") || "â€”";
      cLinks.innerHTML = linksClassic;

      pSummary.textContent = (state.summary || "").trim() || "â€”";
      pExp.innerHTML = renderExp();
      pEdu.innerHTML = renderEdu();
      pProj.innerHTML = renderProj();
      pSkills.innerHTML = renderChips(state.skills);
      pLang.textContent = (state.languages || "").trim() || "â€”";
    }

    function save() {
      localStorage.setItem(LS_KEY, JSON.stringify(state));
      toast("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸");
    }

    function load() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);
        Object.assign(state, data);
      } catch {}
    }

    function reset() {
      if (!confirm("Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) return;
      localStorage.removeItem(LS_KEY);
      location.reload();
    }

    function syncAll() {
      syncStateFromInputs();
      renderDynamicForms();
      renderPreview();
    }

    // Events (simple)
    Object.values(inputs).forEach(inp => inp.addEventListener("input", syncAll));
    inputs.template.addEventListener("change", syncAll);

    addExp.addEventListener("click", () => {
      state.experiences.push({ role: "Role", company: "Company", period: "2023 - 2024", bullets: ["Achievement 1", "Achievement 2"] });
      renderDynamicForms();
      renderPreview();
    });

    addEdu.addEventListener("click", () => {
      state.education.push({ degree: "Degree", school: "School", period: "2019 - 2023", details: "" });
      renderDynamicForms();
      renderPreview();
    });

    addProj.addEventListener("click", () => {
      state.projects.push({ name: "Project Name", link: "", bullets: ["What you built", "Tech used", "Result/impact"] });
      renderDynamicForms();
      renderPreview();
    });

    // Delegated inputs for dynamic lists
    expList.addEventListener("input", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLInputElement || t instanceof HTMLTextAreaElement)) return;
      const i = Number(t.dataset.i);
      const k = t.dataset.exp;
      if (!Number.isFinite(i) || !k) return;
      const exp = state.experiences[i];
      if (!exp) return;

      if (k === "role") exp.role = t.value;
      if (k === "company") exp.company = t.value;
      if (k === "period") exp.period = t.value;
      if (k === "bullets") exp.bullets = t.value.split("\n").map(s => s.trim()).filter(Boolean);

      renderPreview();
    });
    expList.addEventListener("click", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLElement)) return;
      const del = t.getAttribute("data-exp-del");
      if (del !== null) {
        state.experiences.splice(Number(del), 1);
        renderDynamicForms();
        renderPreview();
      }
    });

    eduList.addEventListener("input", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLInputElement)) return;
      const i = Number(t.dataset.i);
      const k = t.dataset.edu;
      if (!Number.isFinite(i) || !k) return;
      const edu = state.education[i];
      if (!edu) return;

      if (k === "degree") edu.degree = t.value;
      if (k === "school") edu.school = t.value;
      if (k === "period") edu.period = t.value;
      if (k === "details") edu.details = t.value;

      renderPreview();
    });
    eduList.addEventListener("click", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLElement)) return;
      const del = t.getAttribute("data-edu-del");
      if (del !== null) {
        state.education.splice(Number(del), 1);
        renderDynamicForms();
        renderPreview();
      }
    });

    projList.addEventListener("input", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLInputElement || t instanceof HTMLTextAreaElement)) return;
      const i = Number(t.dataset.i);
      const k = t.dataset.proj;
      if (!Number.isFinite(i) || !k) return;
      const proj = state.projects[i];
      if (!proj) return;

      if (k === "name") proj.name = t.value;
      if (k === "link") proj.link = t.value;
      if (k === "bullets") proj.bullets = t.value.split("\n").map(s => s.trim()).filter(Boolean);

      renderPreview();
    });
    projList.addEventListener("click", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLElement)) return;
      const del = t.getAttribute("data-proj-del");
      if (del !== null) {
        state.projects.splice(Number(del), 1);
        renderDynamicForms();
        renderPreview();
      }
    });

    btnPdf.addEventListener("click", () => window.print());
    btnSave.addEventListener("click", save);
    btnReset.addEventListener("click", reset);

    // Init
    (function init() {
      load();
      syncInputsFromState();
      renderDynamicForms();
      renderPreview();
      setTemplate(state.template);
      toast("Ø¬Ø§Ù‡Ø² âœ… Ø§Ù…Ù„Ø£ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ§Ø·Ø¨Ø¹ PDF");
    })();
  </script>
</body>
</html>
