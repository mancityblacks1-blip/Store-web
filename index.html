<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat Frontend Only</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:#101a33;
      --panel2:#0f1830;
      --text:#e9eeff;
      --muted:#9fb0ff;
      --line:rgba(255,255,255,.08);
      --accent:#6b7bff;
      --accent2:#66e3ff;
      --good:#7CFFB2;
      --warn:#FFD36C;
      --bad:#FF6B6B;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
      --msgUser:#6b7bff;
      --msgBot:#1b2a55;
      --msgCard: rgba(255,255,255,.04);
      --focus: 0 0 0 3px rgba(107,123,255,.22);
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Kufi Arabic", "Noto Sans Arabic", sans-serif;
    }
    [data-theme="light"]{
      --bg:#f6f7fb;
      --panel:#ffffff;
      --panel2:#ffffff;
      --text:#101426;
      --muted:#5b678a;
      --line:rgba(16,20,38,.10);
      --accent:#3b5bff;
      --accent2:#00bcd4;
      --shadow: 0 10px 30px rgba(16,20,38,.10);
      --msgBot:#eef2ff;
      --msgCard: rgba(16,20,38,.03);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      background:
        radial-gradient(1100px 700px at 10% 0%, rgba(102,227,255,.12), transparent 55%),
        radial-gradient(900px 650px at 90% 10%, rgba(107,123,255,.16), transparent 55%),
        radial-gradient(850px 650px at 40% 100%, rgba(124,255,178,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:16px;
    }

    .app{
      width:min(1200px, 100%);
      height:min(760px, 92vh);
      display:grid;
      grid-template-columns: 340px 1fr;
      gap:14px;
    }

    /* Sidebar */
    .sidebar{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      backdrop-filter: blur(10px);
    }
    .sideTop{
      padding:16px 16px 12px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      gap:12px;
    }
    .logo{
      width:44px;height:44px;border-radius:14px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 10px 24px rgba(107,123,255,.25);
      position:relative;
      overflow:hidden;
      flex:0 0 auto;
    }
    .logo:before{
      content:"";
      position:absolute;inset:-20%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.45), transparent 45%);
      transform: rotate(12deg);
    }
    .brand{
      display:flex;flex-direction:column;gap:2px;
      min-width:0;
    }
    .brand b{
      font-size:15px;
      letter-spacing:.2px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand span{
      font-size:12px;color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .sideActions{
      margin-inline-start:auto;
      display:flex;gap:8px;
    }
    .iconBtn{
      width:38px;height:38px;border-radius:12px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      display:grid;place-items:center;
      transition:.15s ease;
      user-select:none;
    }
    .iconBtn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.06); }
    .iconBtn:active{ transform: translateY(0px) scale(.98); }
    .iconBtn:focus{ outline:none; box-shadow: var(--focus); }

    .searchWrap{
      padding:12px 16px 14px;
      display:flex;
      gap:10px;
    }
    .input{
      width:100%;
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      padding:12px 12px;
      font-size:13px;
      outline:none;
      transition:.15s ease;
    }
    .input:focus{ box-shadow: var(--focus); border-color: rgba(107,123,255,.35); }
    .pill{
      border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding:10px 12px;
      font-size:12px;
      color:var(--muted);
      display:flex; align-items:center; gap:8px;
      user-select:none;
      white-space:nowrap;
    }
    .pill .dot{
      width:8px;height:8px;border-radius:999px;
      background: var(--good);
      box-shadow: 0 0 0 3px rgba(124,255,178,.18);
    }

    .rooms{
      padding: 0 10px 12px;
      overflow:auto;
      flex:1;
    }
    .room{
      display:flex;
      gap:12px;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid transparent;
      cursor:pointer;
      transition:.15s ease;
      align-items:center;
      margin-top:8px;
      background: transparent;
      user-select:none;
    }
    .room:hover{
      background: rgba(255,255,255,.04);
      border-color: rgba(255,255,255,.06);
    }
    .room.active{
      background: linear-gradient(135deg, rgba(107,123,255,.18), rgba(102,227,255,.10));
      border-color: rgba(107,123,255,.25);
    }
    .avatar{
      width:44px;height:44px;border-radius:16px;
      background: rgba(255,255,255,.06);
      border:1px solid var(--line);
      display:grid;place-items:center;
      flex:0 0 auto;
      position:relative;
      overflow:hidden;
    }
    .avatar:before{
      content:"";
      position:absolute;inset:-30%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.20), transparent 55%);
    }
    .roomMeta{
      min-width:0;
      display:flex; flex-direction:column; gap:3px;
    }
    .roomMeta b{
      font-size:13px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .roomMeta span{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .badge{
      margin-inline-start:auto;
      font-size:11px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--muted);
    }

    .sideFooter{
      padding:12px 16px;
      border-top:1px solid var(--line);
      display:flex;
      gap:10px;
      align-items:center;
    }
    .nameTag{
      flex:1;
      display:flex;
      flex-direction:column;
      min-width:0;
    }
    .nameTag b{ font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
    .nameTag span{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}

    /* Chat panel */
    .chat{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      backdrop-filter: blur(10px);
      position:relative;
    }
    .chatTop{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      gap:12px;
    }
    .chatTop .title{
      display:flex; flex-direction:column; gap:2px;
      min-width:0;
      flex:1;
    }
    .chatTop .title b{
      font-size:14px;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .chatTop .title span{
      font-size:12px; color:var(--muted);
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .chip{
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--muted);
      display:flex; gap:8px; align-items:center;
      user-select:none;
    }
    .chip i{
      width:8px;height:8px;border-radius:999px;
      background: var(--good);
      box-shadow: 0 0 0 3px rgba(124,255,178,.18);
      display:inline-block;
    }

    .messages{
      flex:1;
      overflow:auto;
      padding:18px 16px 8px;
      scroll-behavior:smooth;
    }
    .dayDivider{
      display:flex;
      justify-content:center;
      margin: 10px 0 16px;
      color: var(--muted);
      font-size:12px;
    }
    .dayDivider span{
      padding:8px 12px;
      border:1px solid var(--line);
      border-radius:999px;
      background: rgba(255,255,255,.03);
    }

    .msgRow{
      display:flex;
      margin: 10px 0;
      gap:10px;
      align-items:flex-end;
    }
    .msgRow.user{ justify-content:flex-start; }
    .msgRow.bot{ justify-content:flex-end; }

    .bubble{
      max-width: min(680px, 78%);
      padding: 12px 12px 10px;
      border-radius: 18px;
      border:1px solid var(--line);
      background: var(--msgCard);
      position:relative;
      box-shadow: 0 6px 20px rgba(0,0,0,.12);
      overflow:hidden;
    }
    .user .bubble{
      background: linear-gradient(135deg, rgba(107,123,255,.28), rgba(107,123,255,.16));
      border-color: rgba(107,123,255,.25);
    }
    .bot .bubble{
      background: linear-gradient(135deg, rgba(27,42,85,.86), rgba(27,42,85,.55));
      border-color: rgba(255,255,255,.08);
    }
    [data-theme="light"] .bot .bubble{
      background: linear-gradient(135deg, rgba(238,242,255,.95), rgba(238,242,255,.70));
      border-color: rgba(16,20,38,.08);
    }

    .bubble .text{
      font-size:14px;
      line-height:1.6;
      white-space:pre-wrap;
      word-wrap:break-word;
    }
    .metaRow{
      margin-top:6px;
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      color: rgba(255,255,255,.70);
      font-size:11px;
    }
    [data-theme="light"] .metaRow{ color: rgba(16,20,38,.55); }
    .metaRow .tag{
      padding:5px 9px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-size:11px;
    }
    .user .metaRow .tag{ color: rgba(255,255,255,.85); border-color: rgba(255,255,255,.16); }

    .typing{
      display:inline-flex;
      gap:6px;
      align-items:center;
      font-size:13px;
      color: var(--muted);
      margin: 4px 0 12px;
      padding: 10px 12px;
      border-radius: 14px;
      border:1px dashed rgba(255,255,255,.16);
      width: fit-content;
      background: rgba(255,255,255,.03);
    }
    .dots{
      display:inline-flex; gap:4px;
    }
    .dots span{
      width:6px;height:6px;border-radius:999px;
      background: var(--muted);
      opacity:.55;
      animation: bounce 1.2s infinite ease-in-out;
    }
    .dots span:nth-child(2){ animation-delay:.15s; }
    .dots span:nth-child(3){ animation-delay:.3s; }
    @keyframes bounce{
      0%, 80%, 100%{ transform: translateY(0); opacity:.45; }
      40%{ transform: translateY(-5px); opacity:.9; }
    }

    .composer{
      border-top:1px solid var(--line);
      padding: 12px 14px;
      display:flex;
      gap:10px;
      align-items:flex-end;
      background: rgba(255,255,255,.02);
    }
    .textarea{
      flex:1;
      min-height:48px;
      max-height:140px;
      resize:none;
      padding:12px 12px;
      border-radius:16px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      color:var(--text);
      outline:none;
      font-size:14px;
      line-height:1.5;
      transition:.15s ease;
    }
    .textarea:focus{ box-shadow: var(--focus); border-color: rgba(107,123,255,.35); }
    .btn{
      border:none;
      cursor:pointer;
      padding: 12px 14px;
      border-radius:16px;
      color:white;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 12px 26px rgba(107,123,255,.22);
      font-weight:700;
      transition:.15s ease;
      user-select:none;
      display:flex; gap:10px; align-items:center;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0) scale(.99); }
    .btn:focus{ outline:none; box-shadow: var(--focus); }
    .btn.secondary{
      background: rgba(255,255,255,.04);
      color: var(--text);
      border:1px solid var(--line);
      box-shadow:none;
      font-weight:600;
    }

    .hintBar{
      padding: 0 16px 12px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    .hint{
      font-size:12px;
      color: var(--muted);
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      padding: 8px 10px;
      border-radius: 999px;
      cursor:pointer;
      user-select:none;
      transition:.15s ease;
    }
    .hint:hover{ transform: translateY(-1px); background: rgba(255,255,255,.05); }

    .toast{
      position:absolute;
      left:14px;
      bottom:14px;
      background: rgba(0,0,0,.50);
      color:#fff;
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;
      border-radius: 14px;
      font-size:12px;
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition:.2s ease;
      backdrop-filter: blur(10px);
    }
    [data-theme="light"] .toast{
      background: rgba(16,20,38,.70);
    }
    .toast.show{
      opacity:1;
      transform: translateY(0);
    }

    /* responsive */
    @media (max-width: 980px){
      .app{
        grid-template-columns: 1fr;
        height: 94vh;
      }
      .sidebar{ display:none; }
    }
  </style>
</head>

<body>
  <div class="app" id="app" data-theme="dark">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sideTop">
        <div class="logo" aria-hidden="true"></div>
        <div class="brand">
          <b id="appName">NebulaChat</b>
          <span>Frontend-only ‚Ä¢ Local Storage</span>
        </div>
        <div class="sideActions">
          <button class="iconBtn" id="toggleThemeBtn" title="ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑŸàÿ∂ÿπ">
            ‚òÄÔ∏è
          </button>
          <button class="iconBtn" id="exportBtn" title="ÿ™ÿµÿØŸäÿ± ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©">
            ‚§ì
          </button>
        </div>
      </div>

      <div class="searchWrap">
        <input class="input" id="roomSearch" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ∫ÿ±ŸÅÿ©..." />
        <div class="pill" title="ÿßŸÑÿ≠ÿßŸÑÿ©">
          <span class="dot"></span>
          <span>Online</span>
        </div>
      </div>

      <div class="rooms" id="rooms"></div>

      <div class="sideFooter">
        <div class="avatar" aria-hidden="true">üë§</div>
        <div class="nameTag">
          <b id="userNameLabel">ÿ∂ŸäŸÅ</b>
          <span id="userIdLabel">local-user</span>
        </div>
        <button class="iconBtn" id="editNameBtn" title="ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿßÿ≥ŸÖ">‚úé</button>
      </div>
    </aside>

    <!-- Chat -->
    <main class="chat">
      <div class="chatTop">
        <div class="avatar" id="roomAvatar" aria-hidden="true">üí¨</div>
        <div class="title">
          <b id="roomTitle">ÿπÿßŸÖ</b>
          <span id="roomSubtitle">ÿßŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑŸÉ.. ŸàÿßŸÑÿ±ÿØ ŸáŸäŸÉŸàŸÜ ŸÖÿ≠ŸÑŸä (ÿ®ÿØŸàŸÜ ÿ•ŸÜÿ™ÿ±ŸÜÿ™)</span>
        </div>

        <div class="chip" title="ŸÖÿ≠ŸÑŸä 100%">
          <i></i> Frontend Only
        </div>

        <button class="iconBtn" id="clearBtn" title="ŸÖÿ≥ÿ≠ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©">üóëÔ∏è</button>
      </div>

      <div class="messages" id="messages"></div>

      <div class="hintBar" id="hintBar"></div>

      <div class="composer">
        <textarea class="textarea" id="composer" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ©... (Enter ŸÑŸÑÿ•ÿ±ÿ≥ÿßŸÑÿå Shift+Enter ŸÑÿ≥ÿ∑ÿ± ÿ¨ÿØŸäÿØ)"></textarea>
        <button class="btn" id="sendBtn">ÿ•ÿ±ÿ≥ÿßŸÑ üöÄ</button>
      </div>

      <div class="toast" id="toast">ÿ™ŸÖ ‚úÖ</div>
    </main>
  </div>

<script>
(() => {
  const $ = (s) => document.querySelector(s);
  const elApp = $("#app");
  const elRooms = $("#rooms");
  const elRoomSearch = $("#roomSearch");
  const elMessages = $("#messages");
  const elComposer = $("#composer");
  const elSend = $("#sendBtn");
  const elRoomTitle = $("#roomTitle");
  const elRoomSubtitle = $("#roomSubtitle");
  const elRoomAvatar = $("#roomAvatar");
  const elHintBar = $("#hintBar");
  const elToggleTheme = $("#toggleThemeBtn");
  const elClear = $("#clearBtn");
  const elExport = $("#exportBtn");
  const elEditName = $("#editNameBtn");
  const elUserNameLabel = $("#userNameLabel");
  const elUserIdLabel = $("#userIdLabel");
  const elAppName = $("#appName");
  const elToast = $("#toast");

  const LS_KEY = "nebula_chat_v1";
  const THEME_KEY = "nebula_theme";
  const PROFILE_KEY = "nebula_profile";

  const nowTime = () => {
    const d = new Date();
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return `${hh}:${mm}`;
  };

  const todayLabel = () => {
    const d = new Date();
    const months = ["ŸäŸÜÿßŸäÿ±","ŸÅÿ®ÿ±ÿßŸäÿ±","ŸÖÿßÿ±ÿ≥","ÿ£ÿ®ÿ±ŸäŸÑ","ŸÖÿßŸäŸà","ŸäŸàŸÜŸäŸà","ŸäŸàŸÑŸäŸà","ÿ£ÿ∫ÿ≥ÿ∑ÿ≥","ÿ≥ÿ®ÿ™ŸÖÿ®ÿ±","ÿ£ŸÉÿ™Ÿàÿ®ÿ±","ŸÜŸàŸÅŸÖÿ®ÿ±","ÿØŸäÿ≥ŸÖÿ®ÿ±"];
    return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear()}`;
  };

  const uid = () => "u_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);

  const showToast = (msg="ÿ™ŸÖ ‚úÖ") => {
    elToast.textContent = msg;
    elToast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> elToast.classList.remove("show"), 1400);
  };

  const defaultRooms = [
    { id:"general", name:"ÿπÿßŸÖ", avatar:"üí¨", subtitle:"ÿØÿ±ÿØÿ¥ÿ© ÿπÿßŸÖÿ© ŸàŸÅÿ∂ŸÅÿ∂ÿ© ŸÑÿ∑ŸäŸÅÿ©" },
    { id:"pricing", name:"ÿßŸÑÿ£ÿ≥ÿπÿßÿ±", avatar:"üí∞", subtitle:"ÿßÿ≥ÿ£ŸÑ ÿπŸÜ ÿ£ÿ≥ÿπÿßÿ± ŸàŸáŸÖŸäÿ© (Demo)" },
    { id:"support", name:"ÿßŸÑÿØÿπŸÖ", avatar:"üõ†Ô∏è", subtitle:"ÿ≠ŸÑ ŸÖÿ¥ÿßŸÉŸÑ ÿ®ÿ≥ÿ±ÿπÿ© (Frontend)" },
    { id:"ideas", name:"ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™", avatar:"‚ú®", subtitle:"ÿ£ŸÅŸÉÿßÿ± ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸàŸÖŸÇÿ™ÿ±ÿ≠ÿßÿ™" },
    { id:"cv", name:"CV Builder", avatar:"üìÑ", subtitle:"ŸÜÿµÿßÿ¶ÿ≠ ÿ≥ÿ±Ÿäÿπÿ© ŸÑŸÑÿ≥Ÿäÿ±ÿ© ÿßŸÑÿ∞ÿßÿ™Ÿäÿ©" },
  ];

  const defaultHints = {
    general: ["ÿßŸÇÿ™ÿ±ÿ≠ ÿπŸÑŸä ŸÅŸÉÿ±ÿ© ŸÖÿ¥ÿ±Ÿàÿπ", "ÿπÿßŸäÿ≤ ÿ£ÿ®ÿØÿ£ ÿ£ÿ™ÿπŸÑŸÖ ÿ®ÿ±ŸÖÿ¨ÿ©", "ÿßÿ≤ÿßŸä ÿ£ÿ≠ÿ≥ŸÜ ÿ™ÿµŸÖŸäŸÖ ÿßŸÑŸÖŸàŸÇÿπÿü", "ÿßÿØŸäŸÜŸä ÿÆÿ∑ÿ© ŸäŸàŸÖŸäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ©"],
    pricing: ["ÿ≥ÿπÿ± ÿßŸÑŸÖŸÜÿ™ÿ¨ A ŸÉÿßŸÖÿü", "ŸáŸÑ ŸÅŸä ÿÆÿµŸÖÿü", "ÿ±ÿ¥ÿ≠ŸÑŸä ÿ®ÿßŸÇÿ© ÿßŸÇÿ™ÿµÿßÿØŸäÿ©", "ÿπÿßŸäÿ≤ ŸÖŸÇÿßÿ±ŸÜÿ© ÿ®ŸäŸÜ ÿÆÿ∑ÿ™ŸäŸÜ"],
    support: ["ÿßŸÑŸÖŸàŸÇÿπ ÿ®Ÿäÿ∑ŸÑÿπ ÿ¥ÿßÿ¥ÿ© ÿ≥ŸàÿØÿß", "Uncaught TypeError..", "ÿßÿ≤ÿßŸä ÿ£ÿ∏ÿ®ÿ∑ CORSÿü", "ŸÖÿ¥ ÿπÿßÿ±ŸÅ ÿ£ÿ¥ÿ∫ŸÑ React"],
    ideas: ["ÿßŸÇÿ™ÿ±ÿ≠ ŸÖŸÜÿ™ÿ¨ÿßÿ™ ŸÑŸÑŸÖÿ™ÿ¨ÿ±", "ÿßÿπŸÖŸÑ ÿπÿ±Ÿàÿ∂ ÿ™ÿ≥ŸàŸäŸÇ", "ÿ£ŸÅŸÉÿßÿ± ŸÑŸÖÿ≠ÿ™ŸàŸâ ÿ™ŸäŸÉ ÿ™ŸàŸÉ", "ÿßŸÇÿ™ÿ±ÿßÿ≠ ÿ£ÿ≥ŸÖÿßÿ° ÿ®ÿ±ŸÜÿØ"],
    cv: ["ÿßŸÉÿ™ÿ® ŸÖŸÑÿÆÿµ CV", "ŸÜÿµÿßÿ¶ÿ≠ ŸÑŸÑŸÄ ATS", "ÿµŸäÿ∫ÿ© ÿÆÿ®ÿ±ÿ© ÿ®ÿØŸàŸÜ ŸÖÿ®ÿßŸÑÿ∫ÿ©", "ÿßÿ≤ÿßŸä ÿ£ÿ±ÿ™ÿ® ÿßŸÑŸÖÿ¥ÿßÿ±Ÿäÿπÿü"]
  };

  const loadProfile = () => {
    try{
      const p = JSON.parse(localStorage.getItem(PROFILE_KEY) || "null");
      if(p && p.name && p.id) return p;
    }catch(e){}
    const p = { name:"ÿ∂ŸäŸÅ", id: uid() };
    localStorage.setItem(PROFILE_KEY, JSON.stringify(p));
    return p;
  };

  const saveProfile = (p) => localStorage.setItem(PROFILE_KEY, JSON.stringify(p));

  const loadState = () => {
    try{
      const s = JSON.parse(localStorage.getItem(LS_KEY) || "null");
      if(s && s.rooms && s.messages) return s;
    }catch(e){}
    const init = {
      rooms: defaultRooms,
      activeRoomId: "general",
      messages: {
        general: [
          {
            id: uid(),
            role: "bot",
            text: "ÿ£ŸáŸÑÿßŸã üëã\nÿØŸá ÿ¥ÿßÿ™ Frontend ŸÅŸÇÿ∑. ŸÖŸÅŸäÿ¥ ÿ≥Ÿäÿ±ŸÅÿ± ŸàŸÑÿß API. ŸÉŸÑ ÿ≠ÿßÿ¨ÿ© ŸÖÿ≠ŸÑŸäÿ©.\nÿ¨ÿ±Ÿëÿ® ÿ™ŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑÿå Ÿàÿ£ŸÜÿß Ÿáÿ±ÿØ ÿ®ŸÇŸàÿßÿπÿØ ÿ∞ŸÉŸäÿ© ÿ®ÿ≥Ÿäÿ∑ÿ© + ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ üòâ",
            time: nowTime(),
            tag: "System"
          }
        ],
        pricing: [],
        support: [],
        ideas: [],
        cv: []
      },
      createdAt: Date.now()
    };
    localStorage.setItem(LS_KEY, JSON.stringify(init));
    return init;
  };

  const saveState = () => localStorage.setItem(LS_KEY, JSON.stringify(state));

  const themeInit = () => {
    const t = localStorage.getItem(THEME_KEY) || "dark";
    elApp.setAttribute("data-theme", t);
    elToggleTheme.textContent = t === "dark" ? "‚òÄÔ∏è" : "üåô";
  };

  const toggleTheme = () => {
    const current = elApp.getAttribute("data-theme");
    const next = current === "dark" ? "light" : "dark";
    elApp.setAttribute("data-theme", next);
    localStorage.setItem(THEME_KEY, next);
    elToggleTheme.textContent = next === "dark" ? "‚òÄÔ∏è" : "üåô";
    showToast(next === "dark" ? "Dark ‚úÖ" : "Light ‚úÖ");
  };

  const escapeHtml = (s) => s
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;");

  const renderRooms = () => {
    const q = (elRoomSearch.value || "").trim().toLowerCase();
    elRooms.innerHTML = "";

    state.rooms
      .filter(r => !q || r.name.toLowerCase().includes(q) || r.subtitle.toLowerCase().includes(q))
      .forEach(r => {
        const div = document.createElement("div");
        div.className = "room" + (r.id === state.activeRoomId ? " active" : "");
        div.innerHTML = `
          <div class="avatar" aria-hidden="true">${escapeHtml(r.avatar)}</div>
          <div class="roomMeta">
            <b>${escapeHtml(r.name)}</b>
            <span>${escapeHtml(r.subtitle)}</span>
          </div>
          <span class="badge">${(state.messages[r.id] || []).length}</span>
        `;
        div.addEventListener("click", () => {
          state.activeRoomId = r.id;
          saveState();
          renderAll();
        });
        elRooms.appendChild(div);
      });
  };

  const renderHints = () => {
    const hints = defaultHints[state.activeRoomId] || ["ÿßŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑŸÉ‚Ä¶"];
    elHintBar.innerHTML = "";
    hints.slice(0, 6).forEach(h => {
      const b = document.createElement("div");
      b.className = "hint";
      b.textContent = h;
      b.addEventListener("click", () => {
        elComposer.value = h;
        elComposer.focus();
      });
      elHintBar.appendChild(b);
    });
  };

  const renderHeader = () => {
    const room = state.rooms.find(r => r.id === state.activeRoomId) || state.rooms[0];
    elRoomTitle.textContent = room.name;
    elRoomSubtitle.textContent = room.subtitle + " ‚Ä¢ (ŸÖÿ≠ŸÑŸä)";
    elRoomAvatar.textContent = room.avatar;
  };

  const renderMessages = () => {
    const list = state.messages[state.activeRoomId] || [];
    elMessages.innerHTML = "";

    // Day divider
    const divider = document.createElement("div");
    divider.className = "dayDivider";
    divider.innerHTML = `<span>${todayLabel()}</span>`;
    elMessages.appendChild(divider);

    list.forEach(m => {
      const row = document.createElement("div");
      row.className = "msgRow " + (m.role === "user" ? "user" : "bot");

      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.innerHTML = `
        <div class="text">${escapeHtml(m.text)}</div>
        <div class="metaRow">
          <span>${escapeHtml(m.time || "")}</span>
          <span class="tag">${escapeHtml(m.tag || (m.role === "user" ? profile.name : "Bot"))}</span>
        </div>
      `;
      row.appendChild(bubble);
      elMessages.appendChild(row);
    });

    elMessages.scrollTop = elMessages.scrollHeight;
  };

  const addMessage = (role, text, tag) => {
    const msg = {
      id: uid(),
      role,
      text: String(text || "").trim(),
      time: nowTime(),
      tag: tag || (role === "user" ? profile.name : "Bot")
    };
    if(!state.messages[state.activeRoomId]) state.messages[state.activeRoomId] = [];
    state.messages[state.activeRoomId].push(msg);
    saveState();
    renderAll();
  };

  const renderTyping = (on) => {
    const id = "typingRow";
    const existing = document.getElementById(id);
    if(on){
      if(existing) return;
      const wrap = document.createElement("div");
      wrap.id = id;
      wrap.className = "typing";
      wrap.innerHTML = `
        <span>ŸäŸÉÿ™ÿ® ÿßŸÑÿ¢ŸÜ</span>
        <span class="dots"><span></span><span></span><span></span></span>
      `;
      elMessages.appendChild(wrap);
      elMessages.scrollTop = elMessages.scrollHeight;
    } else {
      existing?.remove();
    }
  };

  // --------- "Smart" local bot (rules + lightweight intent) ----------
  const normalize = (s) => (s || "")
    .toLowerCase()
    .replace(/[ÿ£ÿ•ÿ¢]/g,"ÿß")
    .replace(/Ÿâ/g,"Ÿä")
    .replace(/ÿ©/g,"Ÿá")
    .replace(/[^\p{L}\p{N}\s\?\!]/gu," ")
    .replace(/\s+/g," ")
    .trim();

  const containsAny = (s, arr) => arr.some(w => s.includes(w));
  const pick = (arr) => arr[Math.floor(Math.random()*arr.length)];

  // Demo product catalog (local)
  const catalog = [
    { name:"AirPods Pro (Demo)", price: 1299, cat:"ÿßŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™" },
    { name:"iPhone 15 (Demo)", price: 38999, cat:"ŸÖŸàÿ®ÿßŸäŸÑÿßÿ™" },
    { name:"Samsung A55 (Demo)", price: 16999, cat:"ŸÖŸàÿ®ÿßŸäŸÑÿßÿ™" },
    { name:"Gaming Mouse (Demo)", price: 999, cat:"ÿßŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™" },
    { name:"Mechanical Keyboard (Demo)", price: 2199, cat:"ÿßŸÉÿ≥ÿ≥Ÿàÿßÿ±ÿßÿ™" },
    { name:"Laptop i5 (Demo)", price: 25999, cat:"ŸÑÿßÿ®ÿ™Ÿàÿ®ÿßÿ™" },
  ];

  const formatEGP = (n) => {
    const x = Number(n || 0);
    return x.toLocaleString("ar-EG") + " ÿ¨";
  };

  const buildPricingAnswer = (qNorm) => {
    // Try match product by keyword
    const hit = catalog.find(p => qNorm.includes(normalize(p.name).split(" ")[0])) ||
                catalog.find(p => qNorm.includes(normalize(p.cat)));
    if(hit){
      return `ÿ™ŸÖÿßŸÖ ‚úÖ\nÿßŸÑÿ≥ÿπÿ± ÿßŸÑÿ™ŸÇÿ±Ÿäÿ®Ÿä ŸÑŸÄ "${hit.name}" ŸáŸà: ${formatEGP(hit.price)}\nÿßŸÑÿ™ÿµŸÜŸäŸÅ: ${hit.cat}\n\n(ÿØŸá Demo ŸÖÿ≠ŸÑŸä. ŸÑŸà ÿπÿßŸäÿ≤ÿå ŸÇŸàŸÑŸëŸä ŸÖŸäÿ≤ÿßŸÜŸäÿ™ŸÉ Ÿàÿ£ŸÜÿß ÿ£ÿ±ÿ¥ÿ≠ŸÑŸÉ ÿÆŸäÿßÿ±ŸäŸÜ.)`;
    }
    // Generic
    const cheap = catalog.filter(p => p.price <= 5000);
    const mid = catalog.filter(p => p.price > 5000 && p.price <= 20000);
    const pro = catalog.filter(p => p.price > 20000);
    return `ÿπŸÜÿØŸÉ 3 ÿ®ÿßŸÇÿßÿ™ (Demo) üí°\n- ÿßŸÇÿ™ÿµÿßÿØŸäÿ©: ${pick(cheap).name} ÿ≠ŸàÿßŸÑŸä ${formatEGP(pick(cheap).price)}\n- ŸÖÿ™Ÿàÿ≥ÿ∑ÿ©: ${pick(mid).name} ÿ≠ŸàÿßŸÑŸä ${formatEGP(pick(mid).price)}\n- ŸÇŸàŸäÿ©: ${pick(pro).name} ÿ≠ŸàÿßŸÑŸä ${formatEGP(pick(pro).price)}\n\nŸÇŸàŸÑŸëŸä: (ŸÖŸàÿ®ÿßŸäŸÑ/ŸÑÿßÿ®/ÿßŸÉÿ≥ÿ≥Ÿàÿßÿ±) + ŸÖŸäÿ≤ÿßŸÜŸäÿ™ŸÉÿü`;
  };

  const buildSupportAnswer = (qNorm) => {
    if(containsAny(qNorm, ["ÿ¥ÿßÿ¥Ÿá ÿ≥ŸàÿØÿß","black screen","ÿ¥ÿßÿ¥ÿ© ÿ≥ŸàÿØŸá","routes","typeerror"])){
      return `ÿ™ŸÖÿßŸÖÿå ÿØŸä ÿÆÿ∑Ÿàÿßÿ™ ÿ≥ÿ±Ÿäÿπÿ© ÿ∫ÿßŸÑÿ®Ÿãÿß ÿ®ÿ™ÿµŸÑÿ≠ ŸÖŸàÿ∂Ÿàÿπ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ≥ŸàÿØÿß ŸÅŸä React/Vite ‚úÖ
1) ÿßŸÅÿ™ÿ≠ DevTools Console Ÿàÿ¥ŸàŸÅ ÿ£ŸàŸÑ Error (ŸÖÿ¥ ÿ¢ÿÆÿ± Ÿàÿßÿ≠ÿØ).
2) ÿ™ÿ£ŸÉÿØ ÿ•ŸÜ import ÿ®ÿ™ÿßÿπ Routes ÿµÿ≠:
   - ŸÑŸà React Router v6: ŸÑÿßÿ≤ŸÖ <BrowserRouter> Ÿäÿ∫ŸÑŸÅ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ.
3) ÿ™ÿ£ŸÉÿØ ÿ•ŸÜ react-router-dom ŸÖÿ™ÿ´ÿ®ÿ™:
   npm i react-router-dom
4) ÿ¨ÿ±Ÿëÿ® ÿ™ŸÖÿ≥ÿ≠ ÿßŸÑŸÉÿßÿ¥ + node_modules:
   - ÿßÿ≠ÿ∞ŸÅ node_modules Ÿà package-lock ÿ´ŸÖ:
   npm i
5) ŸÑŸà error ÿ®ŸäŸÇŸàŸÑ Routes undefined: ÿ∫ÿßŸÑÿ®Ÿãÿß ÿ®ÿ™ÿ≥ÿ™Ÿàÿ±ÿØ Routes ŸÖŸÜ ŸÖŸÉÿßŸÜ ÿ∫ŸÑÿ∑ ÿ£Ÿà ŸÜÿ≥ÿÆÿ© router ŸÇÿØŸäŸÖÿ©.

ŸÑŸà ÿ™ÿ≠ÿ® ÿßÿ®ÿπÿ™ŸÑŸä ŸÜÿµ ÿßŸÑŸÄ import ÿßŸÑŸÑŸä ÿπŸÜÿØŸÉ Ÿàÿ£ŸÜÿß ÿ£ŸÇŸàŸÑŸÉ ÿßŸÑÿ≥ÿ∑ÿ± ÿßŸÑŸÑŸä ŸÖÿ≠ÿ™ÿßÿ¨ ÿ™ÿπÿØŸäŸÑ.`;
    }
    if(containsAny(qNorm, ["cors","ŸÉŸàÿ±ÿ≥"])){
      return `CORS ŸÅŸä ÿßŸÑÿπÿßÿØÿ© ŸÖÿ¥ ÿ®Ÿäÿ™ÿ≠ŸÑ ŸÅÿ±ŸàŸÜÿ™ ÿ®ÿ≥‚Ä¶ ŸÑŸÉŸÜ ŸÑŸà ÿ£ŸÜÿ™ ÿ¥ÿ∫ÿßŸÑ Demo:
- ÿßÿ≥ÿ™ÿÆÿØŸÖ Mock Data ÿ®ÿØŸÑ API
- ÿ£Ÿà Proxy ŸÅŸä Vite (ŸÑŸà ŸÅŸäŸá backend)
ŸÑŸà ÿπÿßŸäÿ≤ Front ŸÅŸÇÿ∑: ÿßÿπŸÖŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ŸàŸáŸÖŸäÿ© + ŸÅŸÑÿ™ÿ±ÿ© + ÿ®ÿ≠ÿ´ ŸÖÿ≠ŸÑŸä.`;
    }
    return `ŸÇŸàŸÑŸä ÿßŸÑŸÖÿ¥ŸÉŸÑÿ© ŸÅŸä ÿ≥ÿ∑ÿ± Ÿàÿßÿ≠ÿØ + ÿßÿ≥ŸÖ ÿßŸÑÿ™ŸÇŸÜŸäÿ© (React/Next/Vite/Vanilla) Ÿàÿ£ŸÜÿß ŸáÿØŸäŸÉ ÿÆÿ∑Ÿàÿßÿ™ ÿπŸÖŸÑŸäÿ© ‚úÖ`;
  };

  const buildIdeasAnswer = (qNorm) => {
    if(containsAny(qNorm, ["ÿßÿ≥ŸÖ","names","ÿ®ÿ±ŸÜÿØ","brand"])){
      const names = ["LumaCart","NovaMarket","BlinkBuy","NexaStore","OrbitShop","ZenBasket","PulseMart"];
      return `ÿßŸÇÿ™ÿ±ÿßÿ≠ÿßÿ™ ÿ£ÿ≥ŸÖÿßÿ° ÿ®ÿ±ÿßŸÜÿØ ‚ú®\n${names.map(n=>"‚Ä¢ "+n).join("\n")}\n\nÿ™ÿ≠ÿ® ÿßŸÑÿßÿ≥ŸÖ ŸäŸÉŸàŸÜ ÿπÿ±ÿ®Ÿä ŸàŸÑÿß ÿ•ŸÜÿ¨ŸÑŸäÿ≤Ÿäÿü ŸàÿπÿßŸäÿ≤Ÿá ÿ±ÿ≥ŸÖŸä ŸàŸÑÿß ÿÆŸÅŸäŸÅÿü`;
    }
    if(containsAny(qNorm, ["ÿπÿ±Ÿàÿ∂","ÿ™ÿ≥ŸàŸäŸÇ","marketing","ŸÖÿßÿ±ŸÉÿ™ŸÜÿ¨"])){
      return `3 ÿ£ŸÅŸÉÿßÿ± ÿ™ÿ≥ŸàŸäŸÇ ÿ≥ÿ±Ÿäÿπÿ© üöÄ
1) ÿπÿ±ÿ∂ Bundle: ÿßÿ¥ÿ™ÿ±Ÿê 2 ŸàÿÆÿØ ÿßŸÑÿ´ÿßŸÑÿ´ ÿ®ŸÄ 50%
2) ŸÉŸàÿ®ŸàŸÜ ‚ÄúWELCOME10‚Äù ŸÑÿ£ŸàŸÑ ÿ∑ŸÑÿ®
3) Countdown ŸÑÿπÿ±ÿ∂ 24 ÿ≥ÿßÿπÿ© ŸÅŸä ÿßŸÑŸáŸàŸÖ

ŸÇŸàŸÑŸëŸä ŸÜŸàÿπ ÿßŸÑŸÖŸÜÿ™ÿ¨ÿßÿ™ (ŸÖŸàÿ®ÿßŸäŸÑÿßÿ™ÿü ŸÖŸÑÿßÿ®ÿ≥ÿü) ÿπÿ¥ÿßŸÜ ÿ£ÿ∏ÿ®ÿ∑ ÿßŸÑÿ£ŸÅŸÉÿßÿ±.`;
    }
    return `ÿ£ŸÅŸÉÿßÿ± ÿ¨ÿßŸáÿ≤ÿ© üí°
‚Ä¢ ‚ÄúŸÖÿ™ÿ¨ÿ± ÿ∞ŸÉŸä‚Äù ÿ®ŸÅŸÑÿ™ÿ±ÿ© ŸÇŸàŸäÿ© + ÿ™ŸàÿµŸäÿßÿ™ ŸÖÿ≠ŸÑŸäÿ©
‚Ä¢ ÿµŸÅÿ≠ÿ© ŸÖŸÇÿßÿ±ŸÜÿ© ŸÖŸÜÿ™ÿ¨ÿßÿ™ (A vs B)
‚Ä¢ ŸÜÿ∏ÿßŸÖ ŸÜŸÇÿßÿ∑ ŸàŸÑÿßÿ° ÿ®ÿ≥Ÿäÿ∑ (ŸÉŸÑ ÿ¥ÿ±ÿßÿ° = ŸÜŸÇÿßÿ∑)

ÿπÿßŸäÿ≤ ÿßŸÑŸÅŸÉÿ±ÿ© ÿ™ÿ±ŸÉÿ≤ ÿπŸÑŸâ: ÿ≤ŸäÿßÿØÿ© ÿßŸÑÿ®Ÿäÿπ ŸàŸÑÿß ÿ™ÿ¨ÿ±ÿ®ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖÿü`;
  };

  const buildCVAnswer = (qNorm) => {
    if(containsAny(qNorm, ["ats","ÿßÿ™ÿ≥"])){
      return `ÿπÿ¥ÿßŸÜ ÿßŸÑŸÄ ATS ŸäÿπÿØŸëŸä ÿßŸÑŸÄ CV ‚úÖ
- ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿπŸÜÿßŸàŸäŸÜ Ÿàÿßÿ∂ÿ≠ÿ©: Summary / Experience / Projects / Skills
- ÿ™ÿ¨ŸÜŸëÿ® ÿ¨ÿØÿßŸàŸÑ ŸÖÿπŸÇÿØÿ© ŸàÿµŸàÿ± ŸÉÿ™Ÿäÿ±
- ÿßŸÉÿ™ÿ® ÿ£ÿ±ŸÇÿßŸÖ: ‚ÄúÿÆŸÅÿ∂ÿ™ ÿßŸÑŸàŸÇÿ™ 30%‚Äù ÿ®ÿØŸÑ ŸÉŸÑÿßŸÖ ÿπÿßŸÖ
ŸÑŸà ÿ™ÿ®ÿπÿ™ŸÑŸä ŸÖÿ¨ÿßŸÑŸÉ (Web/Design/Marketing) ÿ£ŸÉÿ™ÿ®ŸÑŸÉ Summary ÿ¨ÿßŸáÿ≤.`;
    }
    if(containsAny(qNorm, ["ŸÖŸÑÿÆÿµ","summary"])){
      return `ÿßŸÉÿ™ÿ®ŸÑŸä 3 ÿ≠ÿßÿ¨ÿßÿ™:
1) ŸÖÿ≥ŸÖŸëŸâ Ÿàÿ∏ŸäŸÅÿ™ŸÉ
2) ÿ≥ŸÜŸäŸÜ ÿßŸÑÿÆÿ®ÿ±ÿ©
3) ÿ£ŸáŸÖ 2 ÿ•ŸÜÿ¨ÿßÿ≤
Ÿàÿ£ÿ∑ŸÑÿπŸÑŸÉ Summary ŸÇŸàŸä ŸÅŸä ÿ≥ÿ∑ÿ±ŸäŸÜ.`;
    }
    return `CV ÿ≥ÿ±Ÿäÿπ: ÿ±ŸÉŸëÿ≤ ÿπŸÑŸâ Projects + ÿ£ÿ±ŸÇÿßŸÖ + Tech Stack. ŸÑŸà ÿπŸÜÿØŸÉ GitHub/Behance ÿ≠ÿ∑ŸáŸÖ ŸÅŸàŸÇ.`;
  };

  const buildGeneralAnswer = (qNorm) => {
    if(containsAny(qNorm, ["ŸÖÿ¥ÿ±Ÿàÿπ","project","ŸÅŸÉÿ±Ÿá","ŸÅŸÉÿ±ÿ©"])){
      const ideas = [
        "ŸÖŸàŸÑŸëÿØ CV ÿ®ŸÇŸàÿßŸÑÿ® ŸÖÿ™ÿπÿØÿØÿ© + ÿ™ÿµÿØŸäÿ± PDF ŸÖŸÜ ÿßŸÑŸÖÿ™ÿµŸÅÿ≠",
        "ŸÖŸàŸÇÿπ ŸÖŸÇÿßÿ±ŸÜÿ© ÿ£ÿ≥ÿπÿßÿ± (Demo) ÿ®ŸÅŸÑÿ™ÿ±ÿ© Ÿàÿ®ÿ≠ÿ´ ŸÖÿ≠ŸÑŸä",
        "Dashboard ŸÖÿµÿ±ŸàŸÅÿßÿ™ ÿ¥ÿÆÿµŸäÿ© (LocalStorage) ŸÖÿπ Charts",
        "ŸÖÿ≥ÿßÿπÿØ ŸÇÿ±ÿßÿ±ÿßÿ™ ÿ≥ÿ±Ÿäÿπ Ÿäÿ≥ÿ£ŸÑ 3 ÿ£ÿ≥ÿ¶ŸÑÿ© ŸàŸäÿ∑ŸÑÿπ ÿ™ŸàÿµŸäÿ©",
      ];
      return `ÿ™ŸÖÿßŸÖ üëå\nÿ•ŸÑŸäŸÉ 4 ÿ£ŸÅŸÉÿßÿ± ŸÇÿßÿ®ŸÑÿ© ŸÑŸÑŸÜÿ¥ÿ± ÿ®ÿ≥ÿ±ÿπÿ©:\n${ideas.map(i=>"‚Ä¢ "+i).join("\n")}\n\nÿπÿßŸäÿ≤Ÿáÿß ŸàŸäÿ® ŸàŸÑÿß ŸÖŸàÿ®ÿßŸäŸÑÿü`;
    }
    if(containsAny(qNorm, ["ÿßÿ≤ÿßŸä","ŸÉŸäŸÅ","ÿßÿ®ÿØÿ£","ÿßÿ®ÿØÿ£"])){
      return `ÿÆŸÑŸëŸäŸÜÿß ŸÜŸÖÿ¥ŸäŸáÿß ÿ®ÿÆÿ∑ÿ© ÿµÿ∫Ÿäÿ±ÿ© üß≠
1) ÿßÿÆÿ™ÿßÿ± ŸáÿØŸÅ ÿ£ÿ≥ÿ®Ÿàÿπ: (ŸÖÿ´ŸÑÿßŸã ÿµŸÅÿ≠ÿ© ŸÖŸÜÿ™ÿ¨ÿßÿ™ + ÿ≥ŸÑÿ©)
2) ŸÉŸÑ ŸäŸàŸÖ 45 ÿØŸÇŸäŸÇÿ©: UI ÿ´ŸÖ Logic
3) ŸÅŸä ÿßŸÑÿ¢ÿÆÿ±: ŸÜÿ¥ÿ± ÿπŸÑŸâ GitHub Pages ÿ£Ÿà Netlify

ŸÇŸàŸÑŸëŸä ÿ£ŸÜÿ™ ÿ¥ÿ∫ÿßŸÑ React ŸàŸÑÿß Vanillaÿü`;
    }
    if(containsAny(qNorm, ["ÿ≥ŸÑÿßŸÖ","ÿßŸáŸÑÿß","ŸáŸÑÿß","hi","hello"])){
      return pick([
        "ÿ£ŸáŸÑÿßŸã Ÿàÿ≥ŸáŸÑÿßŸã üëã ŸÇŸàŸÑŸëŸä ŸÜÿßŸàŸä ÿ™ÿ™ŸÉŸÑŸÖ ÿπŸÜ ÿ•ŸäŸáÿü",
        "Ÿäÿß ŸáŸÑÿß! ÿ¨ÿßŸáÿ≤ ŸÜÿ±ÿ™Ÿëÿ® ÿ£ŸÅŸÉÿßÿ±ŸÉ ŸàŸÑÿß ÿ™ÿ≠ÿ® ŸÅÿ∂ŸÅÿ∂ÿ© ÿÆŸÅŸäŸÅÿ©ÿü üòÑ",
        "ÿ£ŸáŸÑÿßŸã! ÿßŸÉÿ™ÿ® ÿ≥ÿ§ÿßŸÑŸÉ Ÿàÿ£ŸÜÿß ŸÖÿπÿßŸÉ ÿÆÿ∑Ÿàÿ© ÿ®ÿÆÿ∑Ÿàÿ© ‚úÖ"
      ]);
    }
    return `ŸàÿµŸÑÿ™ ‚úÖ\nŸÑŸà ÿπÿßŸäÿ≤ ÿ±ÿØ ÿ£ÿØŸÇ: ŸÇŸàŸÑŸëŸä ‚ÄúŸáÿØŸÅŸÉ‚Äù ŸÖŸÜ ÿßŸÑÿ≥ÿ§ÿßŸÑ ŸÅŸä ÿ≥ÿ∑ÿ± Ÿàÿßÿ≠ÿØ.`;
  };

  const localBot = (userText) => {
    const q = normalize(userText);

    // room-aware responses
    if(state.activeRoomId === "pricing") return buildPricingAnswer(q);
    if(state.activeRoomId === "support") return buildSupportAnswer(q);
    if(state.activeRoomId === "ideas") return buildIdeasAnswer(q);
    if(state.activeRoomId === "cv") return buildCVAnswer(q);

    // general room: detect intents
    if(containsAny(q, ["ÿ≥ÿπÿ±","ÿ®ŸÉÿßŸÖ","price","ÿÆÿµŸÖ","discount"])) return buildPricingAnswer(q);
    if(containsAny(q, ["ÿÆÿ∑ÿß","error","typeerror","routes","ÿ¥ÿßÿ¥Ÿá","ÿ¥ÿßÿ¥ÿ©","vite","react"])) return buildSupportAnswer(q);
    if(containsAny(q, ["ÿ™ÿ≥ŸàŸäŸÇ","ÿßÿ≥ŸÖ","ÿ®ÿ±ŸÜÿØ","marketing","names"])) return buildIdeasAnswer(q);
    if(containsAny(q, ["cv","ÿ≥Ÿäÿ±Ÿá","ÿ≥Ÿäÿ±ÿ©","resume","ats"])) return buildCVAnswer(q);

    return buildGeneralAnswer(q);
  };

  const send = async () => {
    const text = (elComposer.value || "").trim();
    if(!text) return;
    elComposer.value = "";
    addMessage("user", text, profile.name);

    // bot typing
    renderTyping(true);
    const delay = 550 + Math.random()*650;
    await new Promise(r => setTimeout(r, delay));
    renderTyping(false);

    const reply = localBot(text);
    addMessage("bot", reply, "Bot");
  };

  const clearChat = () => {
    const ok = confirm("ÿ™ŸÖÿ≥ÿ≠ ŸÖÿ≠ÿßÿØÿ´ÿ© ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿØŸäÿü");
    if(!ok) return;
    state.messages[state.activeRoomId] = [];
    saveState();
    renderAll();
    showToast("ÿßÿ™ŸÖÿ≥ÿ≠ÿ™ üóëÔ∏è");
  };

  const exportChat = () => {
    const payload = {
      profile,
      roomId: state.activeRoomId,
      room: state.rooms.find(r=>r.id===state.activeRoomId),
      messages: state.messages[state.activeRoomId] || [],
      exportedAt: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `chat_${state.activeRoomId}_${Date.now()}.json`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    showToast("ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ± ‚§ì");
  };

  const editName = () => {
    const name = prompt("ÿßŸÉÿ™ÿ® ÿßÿ≥ŸÖŸÉ:", profile.name || "ÿ∂ŸäŸÅ");
    if(!name) return;
    profile.name = name.trim().slice(0, 24) || "ÿ∂ŸäŸÅ";
    saveProfile(profile);
    renderProfile();
    showToast("ÿßÿ™ÿ≠ÿØÿ´ ‚úÖ");
  };

  const renderProfile = () => {
    elUserNameLabel.textContent = profile.name;
    elUserIdLabel.textContent = profile.id;
  };

  const autosize = () => {
    elComposer.style.height = "auto";
    elComposer.style.height = Math.min(elComposer.scrollHeight, 140) + "px";
  };

  const renderAll = () => {
    renderRooms();
    renderHeader();
    renderMessages();
    renderHints();
  };

  // init
  let state = loadState();
  let profile = loadProfile();

  themeInit();
  renderProfile();
  renderAll();

  // events
  elRoomSearch.addEventListener("input", renderRooms);
  elToggleTheme.addEventListener("click", toggleTheme);
  elClear.addEventListener("click", clearChat);
  elExport.addEventListener("click", exportChat);
  elEditName.addEventListener("click", editName);

  elSend.addEventListener("click", send);
  elComposer.addEventListener("input", autosize);
  elComposer.addEventListener("keydown", (e) => {
    if(e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      send();
    }
  });

  // small UX: set app name by room
  const setDynamicTitle = () => {
    const r = state.rooms.find(x => x.id === state.activeRoomId);
    document.title = `${r?.name || "Chat"} | NebulaChat`;
  };
  const _oldRenderAll = renderAll;
  renderAll = () => { _oldRenderAll(); setDynamicTitle(); };
  renderAll();

})();
</script>
</body>
</html>
