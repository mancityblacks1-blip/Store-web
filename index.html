<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ø¥Ø²Ø§Ù„Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙˆØ± - Frontend Only</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#101a33;
      --text:#e9eeff;
      --muted:#9fb0ff;
      --line:rgba(255,255,255,.10);
      --accent:#6b7bff;
      --accent2:#66e3ff;
      --good:#7CFFB2;
      --warn:#FFD36C;
      --bad:#FF6B6B;
      --shadow: 0 14px 40px rgba(0,0,0,.35);
      --radius:18px;
      --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Kufi Arabic", "Noto Sans Arabic", sans-serif;
    }
    body{
      margin:0; font-family:var(--font); color:var(--text);
      background:
        radial-gradient(1100px 700px at 10% 0%, rgba(102,227,255,.12), transparent 55%),
        radial-gradient(900px 650px at 90% 10%, rgba(107,123,255,.16), transparent 55%),
        radial-gradient(850px 650px at 40% 100%, rgba(124,255,178,.10), transparent 55%),
        var(--bg);
      min-height:100vh; display:flex; align-items:center; justify-content:center;
      padding:18px;
    }
    .app{
      width:min(1150px, 100%);
      display:grid;
      grid-template-columns: 430px 1fr;
      gap:14px;
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    header{
      grid-column: 1 / -1;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px;
    }
    .title{
      display:flex; flex-direction:column; gap:4px;
    }
    .title b{ font-size:16px; }
    .title span{ font-size:12px; color:var(--muted); line-height:1.4; }
    .btn{
      cursor:pointer; border:none;
      padding:10px 12px;
      border-radius:14px;
      color:white;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      font-weight:700;
      box-shadow: 0 12px 26px rgba(107,123,255,.22);
      transition:.15s ease;
      user-select:none;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0) scale(.99); }
    .btn.secondary{
      background: rgba(255,255,255,.05);
      border:1px solid var(--line);
      box-shadow:none;
      color:var(--text);
      font-weight:600;
    }
    .panel{
      padding:16px;
      display:flex;
      flex-direction:column;
      gap:12px;
    }
    .drop{
      border:1px dashed rgba(255,255,255,.20);
      border-radius: 16px;
      padding:14px;
      background: rgba(255,255,255,.03);
      text-align:center;
      transition:.15s ease;
    }
    .drop.drag{ border-color: rgba(107,123,255,.55); box-shadow: 0 0 0 3px rgba(107,123,255,.18); }
    .drop .big{ font-size:14px; margin-bottom:6px; }
    .drop .small{ font-size:12px; color:var(--muted); }
    input[type="file"]{ display:none; }
    .row{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .label{
      font-size:12px; color:var(--muted);
      border:1px solid var(--line);
      padding:8px 10px;
      border-radius:999px;
      background: rgba(255,255,255,.03);
      display:flex; gap:8px; align-items:center;
    }
    .toggle{
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .mode{
      cursor:pointer;
      border:1px solid var(--line);
      background: rgba(255,255,255,.03);
      border-radius: 14px;
      padding:10px 12px;
      font-size:12px;
      color: var(--muted);
      user-select:none;
      transition:.15s ease;
    }
    .mode.active{
      color: var(--text);
      border-color: rgba(107,123,255,.45);
      background: rgba(107,123,255,.14);
    }
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
      padding:16px;
    }
    .previewBox{
      border:1px solid var(--line);
      border-radius: 16px;
      overflow:hidden;
      background: rgba(255,255,255,.03);
      min-height: 340px;
      display:flex; flex-direction:column;
    }
    .boxHead{
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      font-size:12px;
      color: var(--muted);
      display:flex; align-items:center; justify-content:space-between;
    }
    .canvasWrap{
      flex:1; display:flex; align-items:center; justify-content:center;
      padding:10px;
      background:
        linear-gradient(45deg, rgba(255,255,255,.06) 25%, transparent 25%),
        linear-gradient(-45deg, rgba(255,255,255,.06) 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, rgba(255,255,255,.06) 75%),
        linear-gradient(-45deg, transparent 75%, rgba(255,255,255,.06) 75%);
      background-size: 24px 24px;
      background-position: 0 0, 0 12px, 12px -12px, -12px 0px;
    }
    canvas{ max-width:100%; max-height: 420px; border-radius:12px; }
    .status{
      padding:10px 12px;
      border-top:1px solid var(--line);
      color: var(--muted);
      font-size:12px;
      display:flex; align-items:center; gap:10px; justify-content:space-between;
    }
    .bar{
      height:10px; width: 210px;
      border-radius: 999px;
      background: rgba(255,255,255,.06);
      overflow:hidden;
      border:1px solid var(--line);
    }
    .bar > div{
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      transition: width .2s ease;
    }
    .toast{
      position: fixed;
      left: 16px;
      bottom: 16px;
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.12);
      padding:10px 12px;
      border-radius: 14px;
      font-size:12px;
      color:#fff;
      opacity:0;
      transform: translateY(10px);
      pointer-events:none;
      transition:.2s ease;
      backdrop-filter: blur(10px);
    }
    .toast.show{ opacity:1; transform: translateY(0); }
    .hint{
      font-size:12px;
      color: var(--muted);
      line-height:1.6;
    }
    .range{
      width: 240px;
      accent-color: var(--accent);
    }
    @media (max-width: 980px){
      .app{ grid-template-columns: 1fr; }
      .grid2{ grid-template-columns: 1fr; }
      .bar{ width: 180px; }
      .range{ width: 100%; }
    }
  </style>
</head>

<body>
  <div class="app">
    <header class="card">
      <div class="title">
        <b>ğŸ§¼ Ø¥Ø²Ø§Ù„Ø© Ø®Ù„ÙÙŠØ© Ø§Ù„ØµÙˆØ± (Frontend Only)</b>
        <span>AI Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­ (Ø¥Ù† Ø§Ø´ØªØºÙ„) + Ø¨Ø¯ÙŠÙ„ Ø¥Ø²Ø§Ù„Ø© Ø¨Ø§Ù„Ù„ÙˆÙ† Ù„Ù„Ø®Ù„ÙÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¯Ø©. Ø¨Ø¯ÙˆÙ† Backend.</span>
      </div>
      <div class="row">
        <button class="btn secondary" id="demoBtn">ØµÙˆØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©</button>
        <button class="btn" id="downloadBtn" disabled>ØªØ­Ù…ÙŠÙ„ PNG</button>
      </div>
    </header>

    <section class="card">
      <div class="panel">
        <div class="drop" id="drop">
          <div class="big">Ø§Ø³Ø­Ø¨ Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ ğŸ“¥ Ø£Ùˆ <label for="file" style="color:var(--accent2); cursor:pointer; font-weight:700;">Ø§Ø®ØªØ§Ø± Ù…Ù„Ù</label></div>
          <div class="small">PNG / JPG / WEBP</div>
          <input id="file" type="file" accept="image/*" />
        </div>

        <div class="toggle">
          <div class="mode active" data-mode="ai">ğŸ¤– AI Remove BG (Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­)</div>
          <div class="mode" data-mode="color">ğŸ¨ Remove by Color (Ù„Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø³Ø§Ø¯Ø©)</div>
        </div>

        <div class="hint" id="modeHint">
          ÙˆØ¶Ø¹ AI ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ ØªØ­Ù…ÙŠÙ„ Ù…ÙˆØ¯ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­. Ù„Ùˆ Ù…Ø§ Ø§Ø´ØªØºÙ„Ø´ Ø¹Ù†Ø¯ÙƒØŒ Ø§Ø³ØªØ®Ø¯Ù… Remove by Color.
        </div>

        <div class="card" style="border-radius:16px; box-shadow:none;">
          <div class="panel" style="gap:10px">
            <div class="row" style="justify-content:space-between;">
              <span class="label">âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Remove by Color</span>
              <span class="label">Target: <input type="color" id="keyColor" value="#ffffff" style="width:36px;height:24px;border:0;background:transparent;"/></span>
            </div>

            <div class="row" style="justify-content:space-between;">
              <span class="label">Tolerance</span>
              <input class="range" id="tolerance" type="range" min="0" max="140" value="35" />
              <span class="label" id="tolVal">35</span>
            </div>

            <div class="row" style="justify-content:space-between;">
              <span class="label">Soft Edge</span>
              <input class="range" id="softness" type="range" min="0" max="40" value="10" />
              <span class="label" id="softVal">10</span>
            </div>

            <div class="row">
              <button class="btn secondary" id="applyColorBtn">ØªØ·Ø¨ÙŠÙ‚ Remove by Color</button>
              <button class="btn secondary" id="resetBtn">Reset</button>
            </div>

            <div class="hint">Ù†ØµÙŠØ­Ø©: Ù„Ùˆ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ØŒ Ø®Ù„ÙŠ Target Ø£Ø¨ÙŠØ¶ ÙˆØ§Ø±ÙØ¹ Tolerance ØªØ¯Ø±ÙŠØ¬ÙŠÙ‹Ø§ Ù„Ø­Ø¯ Ù…Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© ØªØ®ØªÙÙŠ Ù…Ù† ØºÙŠØ± Ù…Ø§ ØªÙ‚Ø·Ø¹ Ø§Ù„Ø´Ø®Øµ.</div>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="grid2">
        <div class="previewBox">
          <div class="boxHead">
            <span>Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©</span>
            <span class="label" id="origInfo">â€”</span>
          </div>
          <div class="canvasWrap">
            <canvas id="origCanvas"></canvas>
          </div>
          <div class="status">
            <span id="statusLeft">Ø¬Ø§Ù‡Ø²</span>
            <div class="bar"><div id="progressBar"></div></div>
          </div>
        </div>

        <div class="previewBox">
          <div class="boxHead">
            <span>Ø§Ù„Ù†ØªÙŠØ¬Ø© (Ø´ÙØ§ÙÙŠØ©)</span>
            <span class="label" id="outInfo">PNG</span>
          </div>
          <div class="canvasWrap">
            <canvas id="outCanvas"></canvas>
          </div>
          <div class="status">
            <span id="statusRight">Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØµÙˆØ±Ø©â€¦</span>
            <span class="label">ğŸ’¡ Ø§Ø¶ØºØ· ØªØ­Ù…ÙŠÙ„ Ù„Ø­ÙØ¸ PNG</span>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast">ØªÙ… âœ…</div>

  <!-- AI MODE: RMBG (if available via CDN) -->
  <!-- This may fail on some environments; we handle gracefully. -->
  <script type="module">
    const $ = (s)=>document.querySelector(s);
    const drop = $("#drop");
    const fileInput = $("#file");
    const downloadBtn = $("#downloadBtn");
    const demoBtn = $("#demoBtn");
    const resetBtn = $("#resetBtn");
    const applyColorBtn = $("#applyColorBtn");
    const keyColor = $("#keyColor");
    const tolerance = $("#tolerance");
    const softness = $("#softness");
    const tolVal = $("#tolVal");
    const softVal = $("#softVal");

    const origCanvas = $("#origCanvas");
    const outCanvas  = $("#outCanvas");
    const origCtx = origCanvas.getContext("2d");
    const outCtx  = outCanvas.getContext("2d");

    const statusLeft = $("#statusLeft");
    const statusRight = $("#statusRight");
    const progressBar = $("#progressBar");
    const toast = $("#toast");
    const origInfo = $("#origInfo");
    const modeHint = $("#modeHint");

    let mode = "ai";
    let imgBitmap = null;
    let origImageData = null;

    const showToast = (msg) => {
      toast.textContent = msg;
      toast.classList.add("show");
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>toast.classList.remove("show"), 1400);
    };

    const setProgress = (p) => {
      progressBar.style.width = Math.max(0, Math.min(100, p)) + "%";
    };

    const setMode = (m) => {
      mode = m;
      document.querySelectorAll(".mode").forEach(x => x.classList.toggle("active", x.dataset.mode === m));
      if(m === "ai"){
        modeHint.textContent = "ÙˆØ¶Ø¹ AI: ÙŠØ­Ø§ÙˆÙ„ Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¨Ù…ÙˆØ¯ÙŠÙ„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­. Ù„Ùˆ ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ø³ØªØ®Ø¯Ù… Remove by Color.";
      } else {
        modeHint.textContent = "ÙˆØ¶Ø¹ Remove by Color: Ù…Ù…ØªØ§Ø² Ù„Ùˆ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„ÙˆÙ† ÙˆØ§Ø­Ø¯ (Ø£Ø¨ÙŠØ¶/Ø£Ø®Ø¶Ø±/Ø£Ø²Ø±Ù‚). Ø§Ø®ØªØ± Ø§Ù„Ù„ÙˆÙ† Ø«Ù… Ø§Ø¶Ø¨Ø· Tolerance.";
      }
      showToast(m === "ai" ? "AI Mode ğŸ¤–" : "Color Mode ğŸ¨");
    };

    document.querySelectorAll(".mode").forEach(btn=>{
      btn.addEventListener("click", ()=> setMode(btn.dataset.mode));
    });

    const fitCanvas = (c, w, h) => { c.width = w; c.height = h; };

    const drawOriginal = async (fileOrUrl) => {
      statusLeft.textContent = "ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©â€¦";
      statusRight.textContent = "Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©â€¦";
      setProgress(15);

      let blob;
      if(typeof fileOrUrl === "string"){
        const res = await fetch(fileOrUrl);
        blob = await res.blob();
      } else {
        blob = fileOrUrl;
      }

      imgBitmap = await createImageBitmap(blob);
      fitCanvas(origCanvas, imgBitmap.width, imgBitmap.height);
      fitCanvas(outCanvas, imgBitmap.width, imgBitmap.height);

      origCtx.clearRect(0,0,origCanvas.width, origCanvas.height);
      origCtx.drawImage(imgBitmap, 0, 0);

      origImageData = origCtx.getImageData(0,0,origCanvas.width, origCanvas.height);

      outCtx.clearRect(0,0,outCanvas.width,outCanvas.height);
      outCtx.drawImage(imgBitmap, 0, 0);

      origInfo.textContent = `${imgBitmap.width}Ã—${imgBitmap.height}`;
      setProgress(25);
      downloadBtn.disabled = false;
      statusLeft.textContent = "Ø¬Ø§Ù‡Ø²";
      statusRight.textContent = "Ø§Ø®ØªØ± ÙˆØ¶Ø¹ Ø«Ù… Ø§Ø¶ØºØ· ØªØ·Ø¨ÙŠÙ‚/Ø¥Ø²Ø§Ù„Ø©";
      showToast("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© âœ…");
    };

    // ---------- AI remove background (try) ----------
    let aiReady = false;
    let aiRemove = null;

    async function initAI(){
      // Try to load an in-browser background removal library from CDN.
      // If it fails, we keep color mode as fallback.
      try{
        statusLeft.textContent = "ØªØ­Ù…ÙŠÙ„ AIâ€¦";
        setProgress(5);

        // Attempt: @imgly/background-removal (WASM) from jsdelivr
        // Some browsers/envs may block WASM or CORS; handled in catch.
        const mod = await import("https://cdn.jsdelivr.net/npm/@imgly/background-removal@1.2.5/+esm");
        // mod.removeBackground(imageBlob|ImageData) -> Blob
        aiRemove = mod.removeBackground;
        aiReady = true;
        statusLeft.textContent = "AI Ø¬Ø§Ù‡Ø² âœ…";
        setProgress(0);
      }catch(e){
        aiReady = false;
        statusLeft.textContent = "AI ØºÙŠØ± Ù…ØªØ§Ø­ Ù‡Ù†Ø§";
        setProgress(0);
      }
    }

    async function applyAI(){
      if(!imgBitmap) return;
      statusRight.textContent = "AI Ø¨ÙŠØ´ÙŠÙ„ Ø§Ù„Ø®Ù„ÙÙŠØ©â€¦";
      setProgress(35);

      if(!aiReady || typeof aiRemove !== "function"){
        statusRight.textContent = "AI ÙØ´Ù„â€¦ Ø§Ø³ØªØ®Ø¯Ù… Remove by Color";
        showToast("AI ØºÙŠØ± Ù…ØªØ§Ø­ âŒ");
        setMode("color");
        setProgress(0);
        return;
      }

      try{
        // Convert current original canvas to blob
        const blob = await new Promise(res => origCanvas.toBlob(res, "image/png"));
        setProgress(55);

        const outBlob = await aiRemove(blob);
        setProgress(80);

        const outBmp = await createImageBitmap(outBlob);
        outCtx.clearRect(0,0,outCanvas.width,outCanvas.height);
        outCtx.drawImage(outBmp, 0, 0);

        statusRight.textContent = "ØªÙ…Øª Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ù„ÙÙŠØ© âœ…";
        showToast("Ø®Ù„ØµÙ†Ø§ ğŸ§¼");
        setProgress(0);
      }catch(err){
        statusRight.textContent = "AI Ø¹Ù…Ù„ Ù…Ø´ÙƒÙ„Ø©â€¦ Ø¬Ø±Ù‘Ø¨ Remove by Color";
        showToast("AI Error âŒ");
        setMode("color");
        setProgress(0);
      }
    }

    // ---------- Color key (chroma) fallback ----------
    function hexToRgb(hex){
      const v = hex.replace("#","");
      const bigint = parseInt(v, 16);
      return { r: (bigint>>16)&255, g:(bigint>>8)&255, b: bigint&255 };
    }

    function clamp(x, a, b){ return Math.max(a, Math.min(b, x)); }

    function applyColorKey(){
      if(!origImageData) return;

      const {r:kr, g:kg, b:kb} = hexToRgb(keyColor.value);
      const tol = parseInt(tolerance.value, 10);
      const soft = parseInt(softness.value, 10);

      statusRight.textContent = "Ø¥Ø²Ø§Ù„Ø© Ø¨Ø§Ù„Ø®Ù„ÙÙŠØ© (Color)â€¦";
      setProgress(35);

      const src = origImageData.data;
      const out = new ImageData(origImageData.width, origImageData.height);
      const dst = out.data;

      // Distance in RGB space; alpha fades within [tol - soft, tol + soft]
      const t0 = Math.max(0, tol - soft);
      const t1 = tol + soft;

      for(let i=0; i<src.length; i+=4){
        const r = src[i], g = src[i+1], b = src[i+2], a = src[i+3];

        const dr = r-kr, dg = g-kg, db = b-kb;
        const dist = Math.sqrt(dr*dr + dg*dg + db*db);

        let alpha = a;

        if(dist <= t0){
          alpha = 0; // remove
        } else if(dist < t1){
          // soft edge: fade alpha
          const k = (dist - t0) / (t1 - t0); // 0..1
          alpha = Math.round(a * k);
        }

        dst[i] = r;
        dst[i+1] = g;
        dst[i+2] = b;
        dst[i+3] = clamp(alpha, 0, 255);
      }

      outCtx.putImageData(out, 0, 0);
      setProgress(0);
      statusRight.textContent = "ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© (Color) âœ…";
      showToast("Ø§ØªØ´Ø§Ù„Øª ğŸ¨");
    }

    // ---------- Download ----------
    function downloadPNG(){
      if(!imgBitmap) return;
      outCanvas.toBlob((blob)=>{
        const a = document.createElement("a");
        a.href = URL.createObjectURL(blob);
        a.download = "no-bg.png";
        document.body.appendChild(a);
        a.click();
        a.remove();
        showToast("ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ â¤“");
      }, "image/png");
    }

    function resetAll(){
      imgBitmap = null;
      origImageData = null;
      origCtx.clearRect(0,0,origCanvas.width,origCanvas.height);
      outCtx.clearRect(0,0,outCanvas.width,outCanvas.height);
      origInfo.textContent = "â€”";
      statusRight.textContent = "Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØµÙˆØ±Ø©â€¦";
      downloadBtn.disabled = true;
      setProgress(0);
      showToast("Reset âœ…");
    }

    // ---------- UI events ----------
    drop.addEventListener("click", ()=> fileInput.click());
    fileInput.addEventListener("change", async (e)=>{
      const f = e.target.files?.[0];
      if(!f) return;
      await drawOriginal(f);
      // auto process based on mode
      if(mode === "ai") await applyAI();
    });

    // drag & drop
    drop.addEventListener("dragover", (e)=>{ e.preventDefault(); drop.classList.add("drag"); });
    drop.addEventListener("dragleave", ()=> drop.classList.remove("drag"));
    drop.addEventListener("drop", async (e)=>{
      e.preventDefault();
      drop.classList.remove("drag");
      const f = e.dataTransfer.files?.[0];
      if(!f) return;
      await drawOriginal(f);
      if(mode === "ai") await applyAI();
    });

    demoBtn.addEventListener("click", async ()=>{
      // Cute demo: a public image with a clear subject. If blocked, user can upload.
      const url = "https://images.unsplash.com/photo-1520975916090-3105956dac38?auto=format&fit=crop&w=900&q=80";
      try{
        await drawOriginal(url);
        if(mode === "ai") await applyAI();
      }catch(e){
        showToast("Ø§Ù„Ø¯ÙŠÙ…Ùˆ Ø§ØªÙ…Ù†Ø¹â€¦ Ø§Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ");
      }
    });

    downloadBtn.addEventListener("click", downloadPNG);
    resetBtn.addEventListener("click", resetAll);

    tolVal.textContent = tolerance.value;
    softVal.textContent = softness.value;
    tolerance.addEventListener("input", ()=> tolVal.textContent = tolerance.value);
    softness.addEventListener("input", ()=> softVal.textContent = softness.value);

    applyColorBtn.addEventListener("click", ()=>{
      setMode("color");
      applyColorKey();
    });

    // If user switches to AI and image loaded, run AI
    document.querySelector('[data-mode="ai"]').addEventListener("click", async ()=>{
      if(imgBitmap) await applyAI();
    });

    // Init AI at startup
    await initAI();
  </script>
</body>
</html>
