<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CV Builder - Ù‚ÙˆØ§Ù„Ø¨ Ù…ØªØ¹Ø¯Ø¯Ø© - ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root { --a4w: 210mm; --a4h: 297mm; }

    /* A4 canvas */
    .a4 {
      width: var(--a4w);
      min-height: var(--a4h);
      background: #fff;
    }
    @media (max-width: 1024px) {
      .a4 { width: 100%; min-height: auto; }
    }

    /* Smooth shadow */
    .shadow-soft { box-shadow: 0 18px 40px rgba(0,0,0,.08); }

    /* Print: single page + no extra margins */
    @page { size: A4; margin: 0; }
    @media print {
      html, body { background: #fff !important; }
      body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
      .no-print { display: none !important; }
      .print-shell { padding: 0 !important; max-width: 100% !important; }
      .print-area { box-shadow: none !important; border: none !important; border-radius: 0 !important; }
      /* Prevent any accidental page breaks */
      .print-area, .print-area * { page-break-inside: avoid; break-inside: avoid; }
    }

    /* Scale wrapper used only for print-fit */
    #printScaleWrap { transform-origin: top right; }

    /* Tiny helpers */
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>

<body class="bg-zinc-50 text-zinc-900">
  <header class="no-print border-b border-zinc-200 bg-white">
    <div class="mx-auto max-w-6xl px-4 h-14 flex items-center justify-between">
      <div class="font-semibold">ğŸ§¾ CV Builder (Ù…Ù„Ù ÙˆØ§Ø­Ø¯)</div>
      <div class="flex items-center gap-2">
        <button id="btnSave" class="h-10 px-4 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 text-sm">
          Ø­ÙØ¸
        </button>
        <button id="btnReset" class="h-10 px-4 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 text-sm">
          Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·
        </button>
        <button id="btnPdf" class="h-10 px-4 rounded-xl bg-emerald-600 text-white hover:bg-emerald-500 text-sm">
          ğŸ–¨ï¸ PDF
        </button>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-6xl px-4 py-6 print-shell">
    <div class="grid gap-4 lg:grid-cols-3">
      <!-- Form -->
      <section class="no-print lg:col-span-1 space-y-4">
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="text-lg font-semibold">Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù€ CV</div>
              <div class="text-sm text-zinc-600">Ù‚ÙˆØ§Ù„Ø¨ Ù…ØªØ¹Ø¯Ø¯Ø© + Ø·Ø¨Ø§Ø¹Ø© ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</div>
            </div>
            <div class="w-44">
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù‚Ø§Ù„Ø¨</label>
              <select id="template" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300">
                <option value="modern">Modern</option>
                <option value="minimal">Minimal</option>
                <option value="sidebar">Sidebar</option>
              </select>
            </div>
          </div>

          <div class="mt-4 grid gap-3">
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø§Ø³Ù…</label>
              <input id="fullName" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="Ù…Ø«Ø§Ù„: Ahmed Mohamed" />
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù…Ø³Ù…Ù‰</label>
                <input id="title" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="Ù…Ø«Ø§Ù„: Frontend Developer" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù…ÙƒØ§Ù†</label>
                <input id="location" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="Cairo, Egypt" />
              </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù‡Ø§ØªÙ</label>
                <input id="phone" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="01xxxxxxxxx" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø¨Ø±ÙŠØ¯</label>
                <input id="email" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="name@email.com" />
              </div>
            </div>

            <div class="grid grid-cols-3 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">LinkedIn</label>
                <input id="linkedin" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="linkedin.com/in/..." />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">GitHub</label>
                <input id="github" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="github.com/..." />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Portfolio</label>
                <input id="portfolio" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" placeholder="your-site.com" />
              </div>
            </div>

            <div>
              <label class="block text-xs text-zinc-600 mb-1">Summary</label>
              <textarea id="summary" class="min-h-[90px] w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-300"
                placeholder="3-5 Ø³Ø·ÙˆØ± Ù‚ÙˆÙŠØ© Ø¹Ù†ÙƒØŒ Ø®Ø¨Ø±ØªÙƒØŒ ÙˆØ£Ù‡Ù… Ø¥Ù†Ø¬Ø§Ø²Ø§ØªÙƒ..."></textarea>
            </div>
          </div>
        </div>

        <!-- Experience -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Ø§Ù„Ø®Ø¨Ø±Ø§Øª</div>
            <button id="addExp" class="h-9 px-3 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 text-sm">+ Ø¥Ø¶Ø§ÙØ©</button>
          </div>
          <div id="expList" class="mt-3 space-y-3"></div>
        </div>

        <!-- Education -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
            <button id="addEdu" class="h-9 px-3 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 text-sm">+ Ø¥Ø¶Ø§ÙØ©</button>
          </div>
          <div id="eduList" class="mt-3 space-y-3"></div>
        </div>

        <!-- Projects -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Ù…Ø´Ø§Ø±ÙŠØ¹</div>
            <button id="addProj" class="h-9 px-3 rounded-xl bg-zinc-900 text-white hover:bg-zinc-800 text-sm">+ Ø¥Ø¶Ø§ÙØ©</button>
          </div>
          <div id="projList" class="mt-3 space-y-3"></div>
        </div>

        <!-- Skills -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="font-semibold">Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª</div>
          <div class="mt-2 text-xs text-zinc-600">Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„: React, Next.js, ...</div>
          <input id="skills" class="mt-2 h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300"
            placeholder="React, Next.js, Tailwind, TypeScript..." />
        </div>

        <!-- Languages -->
        <div class="rounded-2xl border border-zinc-200 bg-white p-4 shadow-soft">
          <div class="font-semibold">Ø§Ù„Ù„ØºØ§Øª</div>
          <div class="mt-2 text-xs text-zinc-600">Ù…Ø«Ø§Ù„: Arabic (Native), English (B2)</div>
          <input id="languages" class="mt-2 h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300"
            placeholder="Arabic (Native), English (B2)" />
        </div>

        <div class="rounded-2xl border border-zinc-200 bg-zinc-900 text-white p-4 shadow-soft">
          <div class="text-sm font-semibold">Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©</div>
          <div class="mt-1 text-xs text-zinc-200">
            Ù„Ùˆ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù€ CV ÙƒØ¨ÙŠØ± Ø¬Ø¯Ù‹Ø§ØŒ Ù‚Ø¨Ù„ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© Ù‡ÙŠØªÙ… ØªØµØºÙŠØ±Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ø¹Ø´Ø§Ù† ÙŠØ·Ù„Ø¹ ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©.
          </div>
        </div>
      </section>

      <!-- Preview -->
      <section class="lg:col-span-2">
        <div class="mx-auto a4 rounded-2xl border border-zinc-200 bg-white shadow-soft overflow-hidden print-area cv-page" id="cv">
          <!-- Print scale wrapper -->
          <div id="printScaleWrap">
            <!-- Template containers -->
            <div id="tplModern" class="hidden">
              <div class="bg-zinc-900 text-white p-8">
                <div class="flex items-start justify-between gap-6">
                  <div class="min-w-0">
                    <div class="text-3xl font-semibold leading-tight" id="mName">â€”</div>
                    <div class="mt-1 text-lg text-zinc-200" id="mTitle">â€”</div>
                    <div class="mt-4 text-sm text-zinc-200 space-y-1">
                      <div id="mMeta1">â€”</div>
                      <div id="mMeta2">â€”</div>
                    </div>
                  </div>
                  <div class="w-52 text-right text-sm text-zinc-200">
                    <div class="font-semibold text-white">Contacts</div>
                    <div class="mt-2 space-y-1" id="mLinks">â€”</div>
                  </div>
                </div>
              </div>

              <div class="p-8">
                <div class="grid gap-7 lg:grid-cols-2">
                  <div class="space-y-6">
                    <section>
                      <h2 class="text-xs font-semibold tracking-widest text-zinc-500">SUMMARY</h2>
                      <div class="mt-2 text-sm text-zinc-700 whitespace-pre-wrap" id="mSummary">â€”</div>
                    </section>

                    <section>
                      <h2 class="text-xs font-semibold tracking-widest text-zinc-500">EXPERIENCE</h2>
                      <div class="mt-3 space-y-4" id="mExp">â€”</div>
                    </section>

                    <section>
                      <h2 class="text-xs font-semibold tracking-widest text-zinc-500">PROJECTS</h2>
                      <div class="mt-3 space-y-3" id="mProj">â€”</div>
                    </section>
                  </div>

                  <div class="space-y-6">
                    <section>
                      <h2 class="text-xs font-semibold tracking-widest text-zinc-500">EDUCATION</h2>
                      <div class="mt-3 space-y-3" id="mEdu">â€”</div>
                    </section>

                    <section>
                      <h2 class="text-xs font-semibold tracking-widest text-zinc-500">SKILLS</h2>
                      <div class="mt-3 flex flex-wrap gap-2" id="mSkills">â€”</div>
                    </section>

                    <section>
                      <h2 class="text-xs font-semibold tracking-widest text-zinc-500">LANGUAGES</h2>
                      <div class="mt-2 text-sm text-zinc-700" id="mLang">â€”</div>
                    </section>
                  </div>
                </div>
              </div>
            </div>

            <div id="tplMinimal" class="hidden p-8">
              <div class="flex items-start justify-between gap-6 border-b border-zinc-200 pb-5">
                <div class="min-w-0">
                  <div class="text-3xl font-semibold leading-tight" id="nName">â€”</div>
                  <div class="mt-1 text-lg text-zinc-700" id="nTitle">â€”</div>
                  <div class="mt-3 text-sm text-zinc-600" id="nMeta">â€”</div>
                </div>
                <div class="text-right text-sm text-zinc-700">
                  <div class="font-semibold">Contacts</div>
                  <div class="mt-2 space-y-1" id="nLinks">â€”</div>
                </div>
              </div>

              <div class="mt-6 grid gap-7 lg:grid-cols-3">
                <div class="lg:col-span-2 space-y-6">
                  <section>
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">SUMMARY</h2>
                    <div class="mt-2 text-sm text-zinc-700 whitespace-pre-wrap" id="nSummary">â€”</div>
                  </section>
                  <section>
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">EXPERIENCE</h2>
                    <div class="mt-3 space-y-4" id="nExp">â€”</div>
                  </section>
                  <section>
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">PROJECTS</h2>
                    <div class="mt-3 space-y-3" id="nProj">â€”</div>
                  </section>
                </div>

                <div class="space-y-6">
                  <section>
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">EDUCATION</h2>
                    <div class="mt-3 space-y-3" id="nEdu">â€”</div>
                  </section>
                  <section>
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">SKILLS</h2>
                    <div class="mt-3 flex flex-wrap gap-2" id="nSkills">â€”</div>
                  </section>
                  <section>
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">LANGUAGES</h2>
                    <div class="mt-2 text-sm text-zinc-700" id="nLang">â€”</div>
                  </section>
                </div>
              </div>
            </div>

            <div id="tplSidebar" class="hidden">
              <div class="grid grid-cols-12 min-h-[297mm]">
                <aside class="col-span-4 bg-zinc-900 text-white p-8">
                  <div class="text-2xl font-semibold leading-tight" id="sName">â€”</div>
                  <div class="mt-1 text-sm text-zinc-200" id="sTitle">â€”</div>

                  <div class="mt-5">
                    <div class="text-xs font-semibold tracking-widest text-zinc-300">CONTACT</div>
                    <div class="mt-2 text-sm text-zinc-200 space-y-1" id="sContact">â€”</div>
                  </div>

                  <div class="mt-6">
                    <div class="text-xs font-semibold tracking-widest text-zinc-300">SKILLS</div>
                    <div class="mt-3 flex flex-wrap gap-2" id="sSkills">â€”</div>
                  </div>

                  <div class="mt-6">
                    <div class="text-xs font-semibold tracking-widest text-zinc-300">LANGUAGES</div>
                    <div class="mt-2 text-sm text-zinc-200" id="sLang">â€”</div>
                  </div>
                </aside>

                <section class="col-span-8 p-8">
                  <section>
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">SUMMARY</h2>
                    <div class="mt-2 text-sm text-zinc-700 whitespace-pre-wrap" id="sSummary">â€”</div>
                  </section>

                  <section class="mt-6">
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">EXPERIENCE</h2>
                    <div class="mt-3 space-y-4" id="sExp">â€”</div>
                  </section>

                  <section class="mt-6">
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">PROJECTS</h2>
                    <div class="mt-3 space-y-3" id="sProj">â€”</div>
                  </section>

                  <section class="mt-6">
                    <h2 class="text-xs font-semibold tracking-widest text-zinc-500">EDUCATION</h2>
                    <div class="mt-3 space-y-3" id="sEdu">â€”</div>
                  </section>
                </section>
              </div>
            </div>
          </div><!-- /printScaleWrap -->
        </div>
      </section>
    </div>
  </main>

  <script>
    const LS_KEY = "cv_builder_onepage_v2";

    // -------- State --------
    const state = {
      template: "modern",
      fullName: "Ahmed Mohamed",
      title: "Frontend Developer",
      phone: "01000000000",
      email: "ahmed@email.com",
      location: "Cairo, Egypt",
      linkedin: "linkedin.com/in/ahmed",
      github: "github.com/ahmed",
      portfolio: "ahmed.dev",
      summary:
`Frontend Developer with experience building responsive web apps using React and Next.js.
I focus on clean UI, performance, and maintainable code.
Seeking opportunities to ship modern products and delightful user experiences.`,
      experiences: [
        {
          role: "Frontend Developer",
          company: "Freelance",
          period: "2024 - Present",
          bullets: [
            "Built responsive landing pages and dashboards with React + Tailwind.",
            "Improved performance and Lighthouse scores through optimization.",
            "Collaborated with clients to deliver features quickly and cleanly."
          ]
        }
      ],
      education: [
        {
          degree: "BSc Computer Science",
          school: "Your University",
          period: "2019 - 2023",
          details: "Relevant: Data Structures, Web Development, Databases"
        }
      ],
      projects: [
        {
          name: "E-commerce Store + Admin Dashboard",
          link: "github.com/yourrepo",
          bullets: [
            "Next.js storefront with cart, checkout demo and admin dashboard.",
            "Prisma + SQLite database with CRUD and stats."
          ]
        }
      ],
      skills: ["React", "Next.js", "Tailwind", "TypeScript", "HTML", "CSS", "Git"],
      languages: "Arabic (Native), English (B2)"
    };

    // -------- DOM helpers --------
    const el = (id) => document.getElementById(id);

    const inputs = {
      template: el("template"),
      fullName: el("fullName"),
      title: el("title"),
      phone: el("phone"),
      email: el("email"),
      location: el("location"),
      linkedin: el("linkedin"),
      github: el("github"),
      portfolio: el("portfolio"),
      summary: el("summary"),
      skills: el("skills"),
      languages: el("languages")
    };

    const expList = el("expList");
    const eduList = el("eduList");
    const projList = el("projList");

    const addExp = el("addExp");
    const addEdu = el("addEdu");
    const addProj = el("addProj");

    const btnPdf = el("btnPdf");
    const btnSave = el("btnSave");
    const btnReset = el("btnReset");

    const printScaleWrap = el("printScaleWrap");
    const cv = el("cv");

    const tplModern = el("tplModern");
    const tplMinimal = el("tplMinimal");
    const tplSidebar = el("tplSidebar");

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function toast(msg) {
      const t = document.createElement("div");
      t.className = "fixed left-1/2 top-4 -translate-x-1/2 z-50 rounded-xl bg-zinc-900 text-white px-4 py-2 text-sm shadow-soft";
      t.textContent = msg;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 1400);
    }

    // -------- Rendering bits --------
    function renderChips(arr, tone = "light") {
      if (!arr || arr.length === 0) return `<span class="text-sm text-zinc-500">â€”</span>`;
      if (tone === "dark") {
        return arr.map(s => `<span class="inline-flex items-center rounded-full bg-white/10 px-2.5 py-1 text-[11px] text-white">${escapeHtml(s)}</span>`).join("");
      }
      return arr.map(s => `<span class="inline-flex items-center rounded-full bg-zinc-100 px-2.5 py-1 text-[11px] text-zinc-700">${escapeHtml(s)}</span>`).join("");
    }

    function renderBullets(bullets, compact = true) {
      if (!bullets || bullets.length === 0) return "";
      const cls = compact ? "text-[12px]" : "text-sm";
      return `
        <ul class="mt-2 list-disc pr-5 ${cls} text-zinc-700 space-y-1">
          ${bullets.map(b => `<li>${escapeHtml(b)}</li>`).join("")}
        </ul>
      `;
    }

    function expBlock(e) {
      return `
        <div>
          <div class="flex items-start justify-between gap-3">
            <div class="font-semibold text-zinc-900 text-[13px]">${escapeHtml(e.role)}</div>
            <div class="text-[11px] text-zinc-500 mono">${escapeHtml(e.period || "")}</div>
          </div>
          <div class="text-[12px] text-zinc-700">${escapeHtml(e.company || "")}</div>
          ${renderBullets(e.bullets, true)}
        </div>
      `;
    }

    function eduBlock(e) {
      return `
        <div>
          <div class="flex items-start justify-between gap-3">
            <div class="font-semibold text-zinc-900 text-[13px]">${escapeHtml(e.degree)}</div>
            <div class="text-[11px] text-zinc-500 mono">${escapeHtml(e.period || "")}</div>
          </div>
          <div class="text-[12px] text-zinc-700">${escapeHtml(e.school || "")}</div>
          ${e.details ? `<div class="mt-1 text-[12px] text-zinc-600">${escapeHtml(e.details)}</div>` : ""}
        </div>
      `;
    }

    function projBlock(p) {
      return `
        <div>
          <div class="flex items-start justify-between gap-3">
            <div class="font-semibold text-zinc-900 text-[13px]">${escapeHtml(p.name)}</div>
            <div class="text-[11px] text-zinc-500 mono">${escapeHtml(p.link || "")}</div>
          </div>
          ${renderBullets(p.bullets, true)}
        </div>
      `;
    }

    function linksModern() {
      const parts = [
        ["LinkedIn", state.linkedin],
        ["GitHub", state.github],
        ["Portfolio", state.portfolio]
      ].filter(([,v]) => (v||"").trim());

      if (!parts.length) return `<div class="text-zinc-300">â€”</div>`;
      return parts.map(([k,v]) =>
        `<div class="truncate"><span class="text-zinc-300">${k}:</span> <span class="text-white">${escapeHtml(v)}</span></div>`
      ).join("");
    }

    function linksLight() {
      const parts = [
        ["LinkedIn", state.linkedin],
        ["GitHub", state.github],
        ["Portfolio", state.portfolio]
      ].filter(([,v]) => (v||"").trim());

      if (!parts.length) return `<div class="text-zinc-500">â€”</div>`;
      return parts.map(([k,v]) =>
        `<div class="truncate"><span class="text-zinc-500">${k}:</span> <span class="text-zinc-900">${escapeHtml(v)}</span></div>`
      ).join("");
    }

    function contactDark() {
      const lines = [
        state.location && `ğŸ“ ${state.location}`,
        state.phone && `ğŸ“ ${state.phone}`,
        state.email && `âœ‰ï¸ ${state.email}`,
        state.linkedin && `in: ${state.linkedin}`,
        state.github && `gh: ${state.github}`,
        state.portfolio && `web: ${state.portfolio}`
      ].filter(Boolean);

      return lines.length ? lines.map(x => `<div class="truncate">${escapeHtml(x)}</div>`).join("") : `<div class="text-zinc-300">â€”</div>`;
    }

    function setTemplate(t) {
      state.template = t;

      tplModern.classList.toggle("hidden", t !== "modern");
      tplMinimal.classList.toggle("hidden", t !== "minimal");
      tplSidebar.classList.toggle("hidden", t !== "sidebar");
    }

    function renderPreview() {
      setTemplate(state.template);

      const name = (state.fullName || "â€”").trim();
      const title = (state.title || "â€”").trim();
      const meta1 = [state.location, state.phone].filter(Boolean).join(" â€¢ ") || "â€”";
      const meta2 = [state.email].filter(Boolean).join(" â€¢ ") || "â€”";

      // modern IDs
      const mName = el("mName"), mTitle = el("mTitle"), mMeta1 = el("mMeta1"), mMeta2 = el("mMeta2"), mLinks = el("mLinks");
      const mSummary = el("mSummary"), mExp = el("mExp"), mProj = el("mProj"), mEdu = el("mEdu"), mSkills = el("mSkills"), mLang = el("mLang");

      // minimal IDs
      const nName = el("nName"), nTitle = el("nTitle"), nMeta = el("nMeta"), nLinks = el("nLinks");
      const nSummary = el("nSummary"), nExp = el("nExp"), nProj = el("nProj"), nEdu = el("nEdu"), nSkills = el("nSkills"), nLang = el("nLang");

      // sidebar IDs
      const sName = el("sName"), sTitle = el("sTitle"), sContact = el("sContact"), sSkills = el("sSkills"), sLang = el("sLang");
      const sSummary = el("sSummary"), sExp = el("sExp"), sProj = el("sProj"), sEdu = el("sEdu");

      // content blocks
      const expHtml = state.experiences.length ? state.experiences.map(expBlock).join("") : `<div class="text-[12px] text-zinc-500">â€”</div>`;
      const eduHtml = state.education.length ? state.education.map(eduBlock).join("") : `<div class="text-[12px] text-zinc-500">â€”</div>`;
      const projHtml = state.projects.length ? state.projects.map(projBlock).join("") : `<div class="text-[12px] text-zinc-500">â€”</div>`;

      const sum = (state.summary || "").trim() || "â€”";
      const lang = (state.languages || "").trim() || "â€”";

      // modern
      if (mName) {
        mName.textContent = name;
        mTitle.textContent = title;
        mMeta1.textContent = meta1;
        mMeta2.textContent = meta2;
        mLinks.innerHTML = linksModern();
        mSummary.textContent = sum;
        mExp.innerHTML = expHtml;
        mEdu.innerHTML = eduHtml;
        mProj.innerHTML = projHtml;
        mSkills.innerHTML = renderChips(state.skills, "light");
        mLang.textContent = lang;
      }

      // minimal
      if (nName) {
        nName.textContent = name;
        nTitle.textContent = title;
        nMeta.textContent = [state.location, state.phone, state.email].filter(Boolean).join(" â€¢ ") || "â€”";
        nLinks.innerHTML = linksLight();
        nSummary.textContent = sum;
        nExp.innerHTML = expHtml;
        nEdu.innerHTML = eduHtml;
        nProj.innerHTML = projHtml;
        nSkills.innerHTML = renderChips(state.skills, "light");
        nLang.textContent = lang;
      }

      // sidebar
      if (sName) {
        sName.textContent = name;
        sTitle.textContent = title;
        sContact.innerHTML = contactDark();
        sSkills.innerHTML = renderChips(state.skills, "dark");
        sLang.textContent = lang;
        sSummary.textContent = sum;
        sExp.innerHTML = expHtml;
        sProj.innerHTML = projHtml;
        sEdu.innerHTML = eduHtml;
      }

      // reset print scale (screen)
      printScaleWrap.style.transform = "scale(1)";
    }

    // -------- Dynamic Forms --------
    function expCard(e, idx) {
      const bulletsText = (e.bullets || []).join("\n");
      return `
        <div class="rounded-2xl border border-zinc-200 bg-zinc-50 p-3">
          <div class="flex items-center justify-between">
            <div class="text-sm font-semibold">Ø®Ø¨Ø±Ø© #${idx + 1}</div>
            <button data-exp-del="${idx}" class="h-9 px-3 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 text-sm">Ø­Ø°Ù</button>
          </div>
          <div class="mt-3 grid gap-3">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ù…Ø³Ù…Ù‰</label>
                <input data-exp="role" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.role)}" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„ÙØªØ±Ø©</label>
                <input data-exp="period" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.period)}" />
              </div>
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø´Ø±ÙƒØ©</label>
              <input data-exp="company" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.company)}" />
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ù†Ù‚Ø§Ø· (ÙƒÙ„ Ø³Ø·Ø± Ù†Ù‚Ø·Ø©)</label>
              <textarea data-exp="bullets" data-i="${idx}" class="min-h-[90px] w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-300">${escapeHtml(bulletsText)}</textarea>
            </div>
          </div>
        </div>
      `;
    }

    function eduCard(e, idx) {
      return `
        <div class="rounded-2xl border border-zinc-200 bg-zinc-50 p-3">
          <div class="flex items-center justify-between">
            <div class="text-sm font-semibold">ØªØ¹Ù„ÙŠÙ… #${idx + 1}</div>
            <button data-edu-del="${idx}" class="h-9 px-3 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 text-sm">Ø­Ø°Ù</button>
          </div>
          <div class="mt-3 grid gap-3">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø¯Ø±Ø¬Ø©</label>
                <input data-edu="degree" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.degree)}" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„ÙØªØ±Ø©</label>
                <input data-edu="period" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.period)}" />
              </div>
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ø§Ù„Ø¬Ù‡Ø©</label>
              <input data-edu="school" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.school)}" />
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">ØªÙØ§ØµÙŠÙ„</label>
              <input data-edu="details" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(e.details || "")}" />
            </div>
          </div>
        </div>
      `;
    }

    function projCard(p, idx) {
      const bulletsText = (p.bullets || []).join("\n");
      return `
        <div class="rounded-2xl border border-zinc-200 bg-zinc-50 p-3">
          <div class="flex items-center justify-between">
            <div class="text-sm font-semibold">Ù…Ø´Ø±ÙˆØ¹ #${idx + 1}</div>
            <button data-proj-del="${idx}" class="h-9 px-3 rounded-xl border border-zinc-200 bg-white hover:bg-zinc-50 text-sm">Ø­Ø°Ù</button>
          </div>
          <div class="mt-3 grid gap-3">
            <div class="grid grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹</label>
                <input data-proj="name" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(p.name)}" />
              </div>
              <div>
                <label class="block text-xs text-zinc-600 mb-1">Ù„ÙŠÙ†Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <input data-proj="link" data-i="${idx}" class="h-10 w-full rounded-xl border border-zinc-200 bg-white px-3 text-sm outline-none focus:ring-2 focus:ring-zinc-300" value="${escapeHtml(p.link || "")}" />
              </div>
            </div>
            <div>
              <label class="block text-xs text-zinc-600 mb-1">Ù†Ù‚Ø§Ø· (ÙƒÙ„ Ø³Ø·Ø± Ù†Ù‚Ø·Ø©)</label>
              <textarea data-proj="bullets" data-i="${idx}" class="min-h-[90px] w-full rounded-xl border border-zinc-200 bg-white px-3 py-2 text-sm outline-none focus:ring-2 focus:ring-zinc-300">${escapeHtml(bulletsText)}</textarea>
            </div>
          </div>
        </div>
      `;
    }

    function renderDynamicForms() {
      expList.innerHTML = state.experiences.map(expCard).join("");
      eduList.innerHTML = state.education.map(eduCard).join("");
      projList.innerHTML = state.projects.map(projCard).join("");
    }

    // -------- Sync --------
    function syncInputsFromState() {
      inputs.template.value = state.template;
      inputs.fullName.value = state.fullName;
      inputs.title.value = state.title;
      inputs.phone.value = state.phone;
      inputs.email.value = state.email;
      inputs.location.value = state.location;
      inputs.linkedin.value = state.linkedin;
      inputs.github.value = state.github;
      inputs.portfolio.value = state.portfolio;
      inputs.summary.value = state.summary;
      inputs.skills.value = state.skills.join(", ");
      inputs.languages.value = state.languages;
    }

    function syncStateFromInputs() {
      state.template = inputs.template.value;
      state.fullName = inputs.fullName.value;
      state.title = inputs.title.value;
      state.phone = inputs.phone.value;
      state.email = inputs.email.value;
      state.location = inputs.location.value;
      state.linkedin = inputs.linkedin.value;
      state.github = inputs.github.value;
      state.portfolio = inputs.portfolio.value;
      state.summary = inputs.summary.value;
      state.skills = (inputs.skills.value || "")
        .split(",").map(s => s.trim()).filter(Boolean);
      state.languages = inputs.languages.value;
    }

    function syncAll() {
      syncStateFromInputs();
      renderDynamicForms();
      renderPreview();
    }

    // -------- Save/Load --------
    function save() {
      localStorage.setItem(LS_KEY, JSON.stringify(state));
      toast("âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸");
    }
    function load() {
      try {
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);
        Object.assign(state, data);
      } catch {}
    }
    function reset() {
      if (!confirm("Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) return;
      localStorage.removeItem(LS_KEY);
      location.reload();
    }

    // -------- One-page print fit --------
    function fitToSinglePage() {
      // Reset
      printScaleWrap.style.transform = "scale(1)";

      // Only fit when A4 is active (desktop/print)
      const wrap = printScaleWrap;
      const maxH = cv.clientHeight; // should approximate A4 height in px in current render
      const contentH = wrap.scrollHeight;

      if (!maxH || !contentH) return;

      // If content exceeds, scale down; cap to avoid too tiny
      if (contentH > maxH) {
        let scale = maxH / contentH;
        scale = Math.max(0.72, Math.min(1, scale)); // don't go below 0.72
        wrap.style.transform = `scale(${scale})`;
      } else {
        wrap.style.transform = "scale(1)";
      }
    }

    // Ensure fit before print
    window.addEventListener("beforeprint", fitToSinglePage);
    window.addEventListener("afterprint", () => {
      printScaleWrap.style.transform = "scale(1)";
    });

    // -------- Events --------
    Object.values(inputs).forEach(inp => inp.addEventListener("input", syncAll));
    inputs.template.addEventListener("change", syncAll);

    addExp.addEventListener("click", () => {
      state.experiences.push({
        role: "Role",
        company: "Company",
        period: "2023 - 2024",
        bullets: ["Achievement 1", "Achievement 2"]
      });
      renderDynamicForms(); renderPreview();
    });

    addEdu.addEventListener("click", () => {
      state.education.push({
        degree: "Degree",
        school: "School",
        period: "2019 - 2023",
        details: ""
      });
      renderDynamicForms(); renderPreview();
    });

    addProj.addEventListener("click", () => {
      state.projects.push({
        name: "Project Name",
        link: "",
        bullets: ["What you built", "Tech used", "Result/impact"]
      });
      renderDynamicForms(); renderPreview();
    });

    // Delegated updates
    expList.addEventListener("input", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLInputElement || t instanceof HTMLTextAreaElement)) return;
      const i = Number(t.dataset.i);
      const k = t.dataset.exp;
      if (!Number.isFinite(i) || !k) return;
      const exp = state.experiences[i]; if (!exp) return;

      if (k === "role") exp.role = t.value;
      if (k === "company") exp.company = t.value;
      if (k === "period") exp.period = t.value;
      if (k === "bullets") exp.bullets = t.value.split("\n").map(s => s.trim()).filter(Boolean);

      renderPreview();
    });
    expList.addEventListener("click", (e) => {
      const t = e.target; if (!(t instanceof HTMLElement)) return;
      const del = t.getAttribute("data-exp-del");
      if (del !== null) {
        state.experiences.splice(Number(del), 1);
        renderDynamicForms(); renderPreview();
      }
    });

    eduList.addEventListener("input", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLInputElement)) return;
      const i = Number(t.dataset.i);
      const k = t.dataset.edu;
      if (!Number.isFinite(i) || !k) return;
      const edu = state.education[i]; if (!edu) return;

      if (k === "degree") edu.degree = t.value;
      if (k === "school") edu.school = t.value;
      if (k === "period") edu.period = t.value;
      if (k === "details") edu.details = t.value;

      renderPreview();
    });
    eduList.addEventListener("click", (e) => {
      const t = e.target; if (!(t instanceof HTMLElement)) return;
      const del = t.getAttribute("data-edu-del");
      if (del !== null) {
        state.education.splice(Number(del), 1);
        renderDynamicForms(); renderPreview();
      }
    });

    projList.addEventListener("input", (e) => {
      const t = e.target;
      if (!(t instanceof HTMLInputElement || t instanceof HTMLTextAreaElement)) return;
      const i = Number(t.dataset.i);
      const k = t.dataset.proj;
      if (!Number.isFinite(i) || !k) return;
      const proj = state.projects[i]; if (!proj) return;

      if (k === "name") proj.name = t.value;
      if (k === "link") proj.link = t.value;
      if (k === "bullets") proj.bullets = t.value.split("\n").map(s => s.trim()).filter(Boolean);

      renderPreview();
    });
    projList.addEventListener("click", (e) => {
      const t = e.target; if (!(t instanceof HTMLElement)) return;
      const del = t.getAttribute("data-proj-del");
      if (del !== null) {
        state.projects.splice(Number(del), 1);
        renderDynamicForms(); renderPreview();
      }
    });

    btnPdf.addEventListener("click", () => {
      // Ensure last sync + fit before print dialog
      syncAll();
      fitToSinglePage();
      window.print();
    });

    btnSave.addEventListener("click", save);
    btnReset.addEventListener("click", reset);

    // -------- Init --------
    (function init() {
      load();
      syncInputsFromState();
      renderDynamicForms();
      renderPreview();
      toast("Ø¬Ø§Ù‡Ø² âœ… Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨ ÙˆØ§Ø·Ø¨Ø¹ PDF");
    })();
  </script>
</body>
</html>
